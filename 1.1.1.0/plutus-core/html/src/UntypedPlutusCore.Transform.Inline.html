<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- editorconfig-checker-disable-file</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE ConstraintKinds  #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE GADTs            #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase       #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell  #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies     #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators    #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns     #-}</span><span>
</span><span id="line-10"></span><span class="hs-comment">{- |
An inlining pass.

This pass is essentially a copy of the PIR inliner, and should be KEPT IN SYNC with it.
It's hard to do this with true abstraction, so we just have to keep two copies reasonably
similar.

However, there are some differences. In the interests of making it easier to keep
things in sync, these are explicitly listed in Note [Differences from PIR inliner].
If you add another difference, please note it there! Obviously fewer differences is
better.

See Note [The problem of inlining destructors].
-}</span><span>
</span><span id="line-24"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">UntypedPlutusCore.Transform.Inline</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#inline"><span class="hs-identifier">inline</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.InlineUtils.html#InlineHints"><span class="hs-identifier">InlineHints</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Rename.html"><span class="hs-identifier">PlutusCore.Rename</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Rename.Internal.html#Dupable"><span class="hs-identifier">Dupable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Rename.html#dupable"><span class="hs-identifier">dupable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Rename.html#liftDupable"><span class="hs-identifier">liftDupable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusPrelude.html"><span class="hs-identifier">PlutusPrelude</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Analysis.Usages.html"><span class="hs-identifier">UntypedPlutusCore.Analysis.Usages</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Usages</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Plated.html"><span class="hs-identifier">UntypedPlutusCore.Core.Plated</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html"><span class="hs-identifier">UntypedPlutusCore.Core.Type</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="UntypedPlutusCore.MkUPlc.html"><span class="hs-identifier">UntypedPlutusCore.MkUPlc</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Rename.html"><span class="hs-identifier">UntypedPlutusCore.Rename</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.html"><span class="hs-identifier">PlutusCore</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PLC</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.html"><span class="hs-identifier">PlutusCore.Builtin</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PLC</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.InlineUtils.html"><span class="hs-identifier">PlutusCore.InlineUtils</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Name.html"><span class="hs-identifier">PlutusCore.Name</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Quote.html"><span class="hs-identifier">PlutusCore.Quote</span></a></span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../lens/html/src"><span class="hs-identifier">Control.Lens</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../lens/html/src"><span class="hs-identifier">Strict</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-identifier">Control.Monad.Reader</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../mtl/html/src"><span class="hs-identifier">Control.Monad.State</span></a></span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../semigroups/html/src"><span class="hs-identifier">Data.Semigroup.Generic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../semigroups/html/src"><span class="hs-identifier">GenericSemigroupMonoid</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../witherable/html/src"><span class="hs-identifier">Witherable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../witherable/html/src"><span class="hs-identifier">wither</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="hs-comment">{- Note [Differences from PIR inliner]

1. No types (obviously).
2. No strictness information (we only have lambda arguments, which are always strict).
3. Handling of multiple beta-reductions in one go, this is handled in PIR by a dedicated pass.
4. Don't inline lambdas with small bodies. We do this in PIR but we *probably* shouldn't really. But doing it here
is actively harmful, so we don't include it.
5. Simplistic purity analysis, in particular we don't try to be clever about builtins (should mostly be handled in PIR).
-}</span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="hs-keyword">newtype</span><span> </span><span id="InlineTerm"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineTerm"><span class="hs-identifier hs-var">InlineTerm</span></a></span></span><span> </span><span id="local-6989586621681137594"><span class="annot"><a href="#local-6989586621681137594"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span id="local-6989586621681137593"><span class="annot"><a href="#local-6989586621681137593"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681137592"><span class="annot"><a href="#local-6989586621681137592"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621681137591"><span class="annot"><a href="#local-6989586621681137591"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Done"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#Done"><span class="hs-identifier hs-var">Done</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Rename.Internal.html#Dupable"><span class="hs-identifier hs-type">Dupable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137594"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137593"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137592"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137591"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="hs-keyword">newtype</span><span> </span><span id="TermEnv"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#TermEnv"><span class="hs-identifier hs-var">TermEnv</span></a></span></span><span> </span><span id="local-6989586621681137929"><span class="annot"><a href="#local-6989586621681137929"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span id="local-6989586621681137928"><span class="annot"><a href="#local-6989586621681137928"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681137927"><span class="annot"><a href="#local-6989586621681137927"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621681137926"><span class="annot"><a href="#local-6989586621681137926"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TermEnv"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#TermEnv"><span class="hs-identifier hs-var">TermEnv</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="_unTermEnv"><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun a.
TermEnv name uni fun a
-&gt; UniqueMap TermUnique (InlineTerm name uni fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#_unTermEnv"><span class="hs-identifier hs-var hs-var">_unTermEnv</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusCore.Name.html#UniqueMap"><span class="hs-identifier hs-type">PLC.UniqueMap</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TermUnique"><span class="hs-identifier hs-type">TermUnique</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineTerm"><span class="hs-identifier hs-type">InlineTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137929"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137928"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137927"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137926"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681137536"><span id="local-6989586621681137542"><span id="local-6989586621681137547"><span class="annot"><span class="annottext">NonEmpty (TermEnv name uni fun a) -&gt; TermEnv name uni fun a
TermEnv name uni fun a
-&gt; TermEnv name uni fun a -&gt; TermEnv name uni fun a
forall b.
Integral b =&gt;
b -&gt; TermEnv name uni fun a -&gt; TermEnv name uni fun a
forall a.
(a -&gt; a -&gt; a)
-&gt; (NonEmpty a -&gt; a)
-&gt; (forall b. Integral b =&gt; b -&gt; a -&gt; a)
-&gt; Semigroup a
forall name (uni :: * -&gt; *) fun a.
NonEmpty (TermEnv name uni fun a) -&gt; TermEnv name uni fun a
forall name (uni :: * -&gt; *) fun a.
TermEnv name uni fun a
-&gt; TermEnv name uni fun a -&gt; TermEnv name uni fun a
forall name (uni :: * -&gt; *) fun a b.
Integral b =&gt;
b -&gt; TermEnv name uni fun a -&gt; TermEnv name uni fun a
stimes :: forall b.
Integral b =&gt;
b -&gt; TermEnv name uni fun a -&gt; TermEnv name uni fun a
$cstimes :: forall name (uni :: * -&gt; *) fun a b.
Integral b =&gt;
b -&gt; TermEnv name uni fun a -&gt; TermEnv name uni fun a
sconcat :: NonEmpty (TermEnv name uni fun a) -&gt; TermEnv name uni fun a
$csconcat :: forall name (uni :: * -&gt; *) fun a.
NonEmpty (TermEnv name uni fun a) -&gt; TermEnv name uni fun a
&lt;&gt; :: TermEnv name uni fun a
-&gt; TermEnv name uni fun a -&gt; TermEnv name uni fun a
$c&lt;&gt; :: forall name (uni :: * -&gt; *) fun a.
TermEnv name uni fun a
-&gt; TermEnv name uni fun a -&gt; TermEnv name uni fun a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Semigroup</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681137517"><span id="local-6989586621681137521"><span id="local-6989586621681137526"><span class="annot"><span class="annottext">TermEnv name uni fun a
[TermEnv name uni fun a] -&gt; TermEnv name uni fun a
TermEnv name uni fun a
-&gt; TermEnv name uni fun a -&gt; TermEnv name uni fun a
forall a.
Semigroup a -&gt; a -&gt; (a -&gt; a -&gt; a) -&gt; ([a] -&gt; a) -&gt; Monoid a
forall name (uni :: * -&gt; *) fun a.
Semigroup (TermEnv name uni fun a)
forall name (uni :: * -&gt; *) fun a. TermEnv name uni fun a
forall name (uni :: * -&gt; *) fun a.
[TermEnv name uni fun a] -&gt; TermEnv name uni fun a
forall name (uni :: * -&gt; *) fun a.
TermEnv name uni fun a
-&gt; TermEnv name uni fun a -&gt; TermEnv name uni fun a
mconcat :: [TermEnv name uni fun a] -&gt; TermEnv name uni fun a
$cmconcat :: forall name (uni :: * -&gt; *) fun a.
[TermEnv name uni fun a] -&gt; TermEnv name uni fun a
mappend :: TermEnv name uni fun a
-&gt; TermEnv name uni fun a -&gt; TermEnv name uni fun a
$cmappend :: forall name (uni :: * -&gt; *) fun a.
TermEnv name uni fun a
-&gt; TermEnv name uni fun a -&gt; TermEnv name uni fun a
mempty :: TermEnv name uni fun a
$cmempty :: forall name (uni :: * -&gt; *) fun a. TermEnv name uni fun a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monoid</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="hs-comment">-- See Note [Differences from PIR inliner] 1</span><span>
</span><span id="line-63"></span><span id="local-6989586621681137511"><span id="local-6989586621681137512"></span></span><span class="hs-keyword">newtype</span><span> </span><span id="Subst"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#Subst"><span class="hs-identifier hs-var">Subst</span></a></span></span><span> </span><span id="local-6989586621681137893"><span class="annot"><a href="#local-6989586621681137893"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span id="local-6989586621681137892"><span class="annot"><a href="#local-6989586621681137892"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681137891"><span class="annot"><a href="#local-6989586621681137891"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621681137890"><span class="annot"><a href="#local-6989586621681137890"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Subst"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#Subst"><span class="hs-identifier hs-var">Subst</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="_termEnv"><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun a.
Subst name uni fun a -&gt; TermEnv name uni fun a
</span><a href="UntypedPlutusCore.Transform.Inline.html#_termEnv"><span class="hs-identifier hs-var hs-var">_termEnv</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#TermEnv"><span class="hs-identifier hs-type">TermEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137893"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137892"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137891"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137890"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall name (uni :: * -&gt; *) fun a x.
Rep (Subst name uni fun a) x -&gt; Subst name uni fun a
forall name (uni :: * -&gt; *) fun a x.
Subst name uni fun a -&gt; Rep (Subst name uni fun a) x
$cto :: forall name (uni :: * -&gt; *) fun a x.
Rep (Subst name uni fun a) x -&gt; Subst name uni fun a
$cfrom :: forall name (uni :: * -&gt; *) fun a x.
Subst name uni fun a -&gt; Rep (Subst name uni fun a) x
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681137488"><span id="local-6989586621681137496"><span id="local-6989586621681137503"><span class="annot"><span class="annottext">NonEmpty (Subst name uni fun a) -&gt; Subst name uni fun a
Subst name uni fun a
-&gt; Subst name uni fun a -&gt; Subst name uni fun a
forall b.
Integral b =&gt;
b -&gt; Subst name uni fun a -&gt; Subst name uni fun a
forall a.
(a -&gt; a -&gt; a)
-&gt; (NonEmpty a -&gt; a)
-&gt; (forall b. Integral b =&gt; b -&gt; a -&gt; a)
-&gt; Semigroup a
forall name (uni :: * -&gt; *) fun a.
NonEmpty (Subst name uni fun a) -&gt; Subst name uni fun a
forall name (uni :: * -&gt; *) fun a.
Subst name uni fun a
-&gt; Subst name uni fun a -&gt; Subst name uni fun a
forall name (uni :: * -&gt; *) fun a b.
Integral b =&gt;
b -&gt; Subst name uni fun a -&gt; Subst name uni fun a
stimes :: forall b.
Integral b =&gt;
b -&gt; Subst name uni fun a -&gt; Subst name uni fun a
$cstimes :: forall name (uni :: * -&gt; *) fun a b.
Integral b =&gt;
b -&gt; Subst name uni fun a -&gt; Subst name uni fun a
sconcat :: NonEmpty (Subst name uni fun a) -&gt; Subst name uni fun a
$csconcat :: forall name (uni :: * -&gt; *) fun a.
NonEmpty (Subst name uni fun a) -&gt; Subst name uni fun a
&lt;&gt; :: Subst name uni fun a
-&gt; Subst name uni fun a -&gt; Subst name uni fun a
$c&lt;&gt; :: forall name (uni :: * -&gt; *) fun a.
Subst name uni fun a
-&gt; Subst name uni fun a -&gt; Subst name uni fun a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Semigroup</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681137447"><span id="local-6989586621681137453"><span id="local-6989586621681137460"><span class="annot"><span class="annottext">Subst name uni fun a
[Subst name uni fun a] -&gt; Subst name uni fun a
Subst name uni fun a
-&gt; Subst name uni fun a -&gt; Subst name uni fun a
forall a.
Semigroup a -&gt; a -&gt; (a -&gt; a -&gt; a) -&gt; ([a] -&gt; a) -&gt; Monoid a
forall name (uni :: * -&gt; *) fun a. Semigroup (Subst name uni fun a)
forall name (uni :: * -&gt; *) fun a. Subst name uni fun a
forall name (uni :: * -&gt; *) fun a.
[Subst name uni fun a] -&gt; Subst name uni fun a
forall name (uni :: * -&gt; *) fun a.
Subst name uni fun a
-&gt; Subst name uni fun a -&gt; Subst name uni fun a
mconcat :: [Subst name uni fun a] -&gt; Subst name uni fun a
$cmconcat :: forall name (uni :: * -&gt; *) fun a.
[Subst name uni fun a] -&gt; Subst name uni fun a
mappend :: Subst name uni fun a
-&gt; Subst name uni fun a -&gt; Subst name uni fun a
$cmappend :: forall name (uni :: * -&gt; *) fun a.
Subst name uni fun a
-&gt; Subst name uni fun a -&gt; Subst name uni fun a
mempty :: Subst name uni fun a
$cmempty :: forall name (uni :: * -&gt; *) fun a. Subst name uni fun a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monoid</span></a></span></span></span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../semigroups/html/src"><span class="hs-identifier hs-type">GenericSemigroupMonoid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137893"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137892"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137891"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137890"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span id="unTermEnv"><span id="local-6989586621681137855"><span id="local-6989586621681137856"><span id="local-6989586621681137857"><span id="local-6989586621681137858"><span id="local-6989586621681137926"><span id="local-6989586621681137927"><span id="local-6989586621681137928"><span id="local-6989586621681137929"><span class="hs-identifier">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">TermEnv</span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-68"></span><span id="termEnv"><span id="local-6989586621681137839"><span id="local-6989586621681137840"><span id="local-6989586621681137841"><span id="local-6989586621681137842"><span id="local-6989586621681137890"><span id="local-6989586621681137891"><span id="local-6989586621681137892"><span id="local-6989586621681137893"><span class="hs-identifier">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Subst</span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-keyword">type</span><span> </span><span id="ExternalConstraints"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#ExternalConstraints"><span class="hs-identifier hs-var">ExternalConstraints</span></a></span></span><span> </span><span id="local-6989586621681137408"><span class="annot"><a href="#local-6989586621681137408"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span id="local-6989586621681137407"><span class="annot"><a href="#local-6989586621681137407"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681137406"><span class="annot"><a href="#local-6989586621681137406"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621681137405"><span class="annot"><a href="#local-6989586621681137405"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-71"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="PlutusCore.Name.html#HasUnique"><span class="hs-identifier hs-type">HasUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137408"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TermUnique"><span class="hs-identifier hs-type">TermUnique</span></a></span><span>
</span><span id="line-72"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Eq</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137408"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-73"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Meaning.html#ToBuiltinMeaning"><span class="hs-identifier hs-type">PLC.ToBuiltinMeaning</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137407"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137406"><span class="hs-identifier hs-type">fun</span></a></span><span>
</span><span id="line-74"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Quote.html#MonadQuote"><span class="hs-identifier hs-type">MonadQuote</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137405"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-75"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="hs-keyword">type</span><span> </span><span id="InliningConstraints"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InliningConstraints"><span class="hs-identifier hs-var">InliningConstraints</span></a></span></span><span> </span><span id="local-6989586621681137404"><span class="annot"><a href="#local-6989586621681137404"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span id="local-6989586621681137403"><span class="annot"><a href="#local-6989586621681137403"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681137402"><span class="annot"><a href="#local-6989586621681137402"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="PlutusCore.Name.html#HasUnique"><span class="hs-identifier hs-type">HasUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137404"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TermUnique"><span class="hs-identifier hs-type">TermUnique</span></a></span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Eq</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137404"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Meaning.html#ToBuiltinMeaning"><span class="hs-identifier hs-type">PLC.ToBuiltinMeaning</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137403"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137402"><span class="hs-identifier hs-type">fun</span></a></span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="hs-comment">-- See Note [Differences from PIR inliner] 2</span><span>
</span><span id="line-84"></span><span class="hs-keyword">data</span><span> </span><span id="InlineInfo"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineInfo"><span class="hs-identifier hs-var">InlineInfo</span></a></span></span><span> </span><span id="local-6989586621681137832"><span class="annot"><a href="#local-6989586621681137832"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span id="local-6989586621681137831"><span class="annot"><a href="#local-6989586621681137831"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="InlineInfo"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineInfo"><span class="hs-identifier hs-var">InlineInfo</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="_usages"><span class="annot"><span class="annottext">forall name a. InlineInfo name a -&gt; Usages
</span><a href="UntypedPlutusCore.Transform.Inline.html#_usages"><span class="hs-identifier hs-var hs-var">_usages</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Analysis.Usages.html#Usages"><span class="hs-identifier hs-type">Usages.Usages</span></a></span><span class="hs-special">,</span><span> </span><span id="_hints"><span class="annot"><span class="annottext">forall name a. InlineInfo name a -&gt; InlineHints name a
</span><a href="UntypedPlutusCore.Transform.Inline.html#_hints"><span class="hs-identifier hs-var hs-var">_hints</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusCore.InlineUtils.html#InlineHints"><span class="hs-identifier hs-type">InlineHints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137832"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137831"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span class="hs-comment">-- Using a concrete monad makes a very large difference to the performance of this module (determined from profiling)</span><span>
</span><span id="line-87"></span><span class="hs-keyword">type</span><span> </span><span id="InlineM"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineM"><span class="hs-identifier hs-var">InlineM</span></a></span></span><span> </span><span id="local-6989586621681137398"><span class="annot"><a href="#local-6989586621681137398"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span id="local-6989586621681137397"><span class="annot"><a href="#local-6989586621681137397"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681137396"><span class="annot"><a href="#local-6989586621681137396"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621681137395"><span class="annot"><a href="#local-6989586621681137395"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">ReaderT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineInfo"><span class="hs-identifier hs-type">InlineInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137398"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137395"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">StateT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137398"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137397"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137396"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137395"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="PlutusCore.Quote.html#Quote"><span class="hs-identifier hs-type">Quote</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span id="local-6989586621681137819"><span id="local-6989586621681137820"><span id="local-6989586621681137821"><span id="local-6989586621681137823"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#lookupTerm"><span class="hs-identifier hs-type">lookupTerm</span></a></span><span>
</span><span id="line-90"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Name.html#HasUnique"><span class="hs-identifier hs-type">HasUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137823"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TermUnique"><span class="hs-identifier hs-type">TermUnique</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681137823"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-92"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137823"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137821"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137820"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137819"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-93"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineTerm"><span class="hs-identifier hs-type">InlineTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137823"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137821"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137820"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137819"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-94"></span><span id="lookupTerm"><span class="annot"><span class="annottext">lookupTerm :: forall name (uni :: * -&gt; *) fun a.
HasUnique name TermUnique =&gt;
name -&gt; Subst name uni fun a -&gt; Maybe (InlineTerm name uni fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#lookupTerm"><span class="hs-identifier hs-var hs-var">lookupTerm</span></a></span></span><span> </span><span id="local-6989586621681137385"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681137385"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681137384"><span class="annot"><span class="annottext">Subst name uni fun a
</span><a href="#local-6989586621681137384"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall name unique a.
HasUnique name unique =&gt;
name -&gt; UniqueMap unique a -&gt; Maybe a
</span><a href="PlutusCore.Name.html#lookupName"><span class="hs-identifier hs-var">lookupName</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681137385"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Subst name uni fun a
</span><a href="#local-6989586621681137384"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../../../../lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun a name (uni :: * -&gt; *) fun a.
Iso
  (Subst name uni fun a)
  (Subst name uni fun a)
  (TermEnv name uni fun a)
  (TermEnv name uni fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#termEnv"><span class="hs-identifier hs-var">termEnv</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun a name (uni :: * -&gt; *) fun a.
Iso
  (TermEnv name uni fun a)
  (TermEnv name uni fun a)
  (UniqueMap TermUnique (InlineTerm name uni fun a))
  (UniqueMap TermUnique (InlineTerm name uni fun a))
</span><a href="UntypedPlutusCore.Transform.Inline.html#unTermEnv"><span class="hs-identifier hs-var">unTermEnv</span></a></span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span id="local-6989586621681137797"><span id="local-6989586621681137798"><span id="local-6989586621681137799"><span id="local-6989586621681137800"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#extendTerm"><span class="hs-identifier hs-type">extendTerm</span></a></span><span>
</span><span id="line-97"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Name.html#HasUnique"><span class="hs-identifier hs-type">HasUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137800"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TermUnique"><span class="hs-identifier hs-type">TermUnique</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681137800"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-99"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineTerm"><span class="hs-identifier hs-type">InlineTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137800"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137799"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137798"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137797"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-100"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137800"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137799"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137798"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137797"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-101"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#Subst"><span class="hs-identifier hs-type">Subst</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137800"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137799"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137798"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137797"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span><span>
</span><span id="line-102"></span><span id="extendTerm"><span class="annot"><span class="annottext">extendTerm :: forall name (uni :: * -&gt; *) fun a.
HasUnique name TermUnique =&gt;
name
-&gt; InlineTerm name uni fun a
-&gt; Subst name uni fun a
-&gt; Subst name uni fun a
</span><a href="UntypedPlutusCore.Transform.Inline.html#extendTerm"><span class="hs-identifier hs-var hs-var">extendTerm</span></a></span></span><span> </span><span id="local-6989586621681137372"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681137372"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681137371"><span class="annot"><span class="annottext">InlineTerm name uni fun a
</span><a href="#local-6989586621681137371"><span class="hs-identifier hs-var">clos</span></a></span></span><span> </span><span id="local-6989586621681137370"><span class="annot"><span class="annottext">Subst name uni fun a
</span><a href="#local-6989586621681137370"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Subst name uni fun a
</span><a href="#local-6989586621681137370"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun a name (uni :: * -&gt; *) fun a.
Iso
  (Subst name uni fun a)
  (Subst name uni fun a)
  (TermEnv name uni fun a)
  (TermEnv name uni fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#termEnv"><span class="hs-identifier hs-var">termEnv</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun a name (uni :: * -&gt; *) fun a.
Iso
  (TermEnv name uni fun a)
  (TermEnv name uni fun a)
  (UniqueMap TermUnique (InlineTerm name uni fun a))
  (UniqueMap TermUnique (InlineTerm name uni fun a))
</span><a href="UntypedPlutusCore.Transform.Inline.html#unTermEnv"><span class="hs-identifier hs-var">unTermEnv</span></a></span><span> </span><span class="annot"><span class="annottext">forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="../../../../lens/html/src"><span class="hs-operator hs-var">%~</span></a></span><span> </span><span class="annot"><span class="annottext">forall name unique a.
HasUnique name unique =&gt;
name -&gt; a -&gt; UniqueMap unique a -&gt; UniqueMap unique a
</span><a href="PlutusCore.Name.html#insertByName"><span class="hs-identifier hs-var">insertByName</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681137372"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">InlineTerm name uni fun a
</span><a href="#local-6989586621681137371"><span class="hs-identifier hs-var">clos</span></a></span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="hs-comment">-- | Inline simple bindings. Relies on global uniqueness, and preserves it.</span><span>
</span><span id="line-105"></span><span class="hs-comment">-- See Note [Inlining and global uniqueness]</span><span>
</span><span id="line-106"></span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#inline"><span class="hs-identifier hs-type">inline</span></a></span><span>
</span><span id="line-107"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681137781"><span class="annot"><a href="#local-6989586621681137781"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span id="local-6989586621681137780"><span class="annot"><a href="#local-6989586621681137780"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681137779"><span class="annot"><a href="#local-6989586621681137779"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621681137778"><span class="annot"><a href="#local-6989586621681137778"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621681137776"><span class="annot"><a href="#local-6989586621681137776"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-108"></span><span>    </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#ExternalConstraints"><span class="hs-identifier hs-type">ExternalConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137781"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137780"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137779"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137778"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-109"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.InlineUtils.html#InlineHints"><span class="hs-identifier hs-type">InlineHints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137781"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137776"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-110"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137781"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137780"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137779"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137776"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-111"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681137778"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137781"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137780"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137779"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137776"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span id="inline"><span class="annot"><span class="annottext">inline :: forall name (uni :: * -&gt; *) fun (m :: * -&gt; *) a.
ExternalConstraints name uni fun m =&gt;
InlineHints name a
-&gt; Term name uni fun a -&gt; m (Term name uni fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#inline"><span class="hs-identifier hs-var hs-var">inline</span></a></span></span><span> </span><span id="local-6989586621681137353"><span class="annot"><span class="annottext">InlineHints name a
</span><a href="#local-6989586621681137353"><span class="hs-identifier hs-var">hints</span></a></span></span><span> </span><span id="local-6989586621681137352"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681137352"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span>
</span><span id="line-113"></span><span>        </span><span class="annot"><a href="#local-6989586621681137351"><span class="hs-identifier hs-type">inlineInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineInfo"><span class="hs-identifier hs-type">InlineInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137781"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137776"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-114"></span><span>        </span><span id="local-6989586621681137351"><span class="annot"><span class="annottext">inlineInfo :: InlineInfo name a
</span><a href="#local-6989586621681137351"><span class="hs-identifier hs-var hs-var">inlineInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall name a. Usages -&gt; InlineHints name a -&gt; InlineInfo name a
</span><a href="UntypedPlutusCore.Transform.Inline.html#InlineInfo"><span class="hs-identifier hs-var">InlineInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Usages
</span><a href="#local-6989586621681137350"><span class="hs-identifier hs-var">usgs</span></a></span><span> </span><span class="annot"><span class="annottext">InlineHints name a
</span><a href="#local-6989586621681137353"><span class="hs-identifier hs-var">hints</span></a></span><span>
</span><span id="line-115"></span><span>        </span><span class="annot"><a href="#local-6989586621681137350"><span class="hs-identifier hs-type">usgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Analysis.Usages.html#Usages"><span class="hs-identifier hs-type">Usages.Usages</span></a></span><span>
</span><span id="line-116"></span><span>        </span><span id="local-6989586621681137350"><span class="annot"><span class="annottext">usgs :: Usages
</span><a href="#local-6989586621681137350"><span class="hs-identifier hs-var hs-var">usgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun a.
HasUnique name TermUnique =&gt;
Term name uni fun a -&gt; Usages
</span><a href="UntypedPlutusCore.Analysis.Usages.html#termUsages"><span class="hs-identifier hs-var">Usages.termUsages</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681137352"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadQuote m =&gt; Quote a -&gt; m a
</span><a href="PlutusCore.Quote.html#liftQuote"><span class="hs-identifier hs-var">liftQuote</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) s a. Monad m =&gt; StateT s m a -&gt; s -&gt; m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">evalStateT</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">runReaderT</span></a></span><span> </span><span class="annot"><span class="annottext">InlineInfo name a
</span><a href="#local-6989586621681137351"><span class="hs-identifier hs-var">inlineInfo</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun a.
InliningConstraints name uni fun =&gt;
Term name uni fun a -&gt; InlineM name uni fun a (Term name uni fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#processTerm"><span class="hs-identifier hs-var">processTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681137352"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span class="hs-comment">-- See Note [Differences from PIR inliner] 3</span><span>
</span><span id="line-120"></span><span class="hs-comment">{-| Extract the list of applications from a term, a bit like a &quot;multi-beta&quot; reduction.

Some examples will help:
[(\x . t) a] -&gt; Just ([(x, a)], t)

[[[(\x . (\y . (\z . t))) a] b] c] -&gt; Just ([(x, a), (y, b), (z, c)]) t)

[[(\x . t) a] b] -&gt; Nothing
-}</span><span>
</span><span id="line-129"></span><span id="local-6989586621681137734"><span id="local-6989586621681137735"><span id="local-6989586621681137736"><span id="local-6989586621681137737"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#extractApps"><span class="hs-identifier hs-type">extractApps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137737"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137736"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137735"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137734"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="UntypedPlutusCore.MkUPlc.html#UTermDef"><span class="hs-identifier hs-type">UTermDef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137737"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137736"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137735"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137734"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137737"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137736"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137735"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137734"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-130"></span><span id="extractApps"><span class="annot"><span class="annottext">extractApps :: forall name (uni :: * -&gt; *) fun a.
Term name uni fun a
-&gt; Maybe ([UTermDef name uni fun a], Term name uni fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#extractApps"><span class="hs-identifier hs-var hs-var">extractApps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {name} {uni :: * -&gt; *} {fun} {ann}.
[Term name uni fun ann]
-&gt; Term name uni fun ann
-&gt; Maybe
     ([Def (UVarDecl name ann) (Term name uni fun ann)],
      Term name uni fun ann)
</span><a href="#local-6989586621681137342"><span class="hs-identifier hs-var">collectArgs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-131"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-132"></span><span>      </span><span id="local-6989586621681137342"><span class="annot"><span class="annottext">collectArgs :: [Term name uni fun ann]
-&gt; Term name uni fun ann
-&gt; Maybe
     ([Def (UVarDecl name ann) (Term name uni fun ann)],
      Term name uni fun ann)
</span><a href="#local-6989586621681137342"><span class="hs-identifier hs-var hs-var">collectArgs</span></a></span></span><span> </span><span id="local-6989586621681137341"><span class="annot"><span class="annottext">[Term name uni fun ann]
</span><a href="#local-6989586621681137341"><span class="hs-identifier hs-var">argStack</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681137339"><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681137339"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681137338"><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681137338"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Term name uni fun ann]
-&gt; Term name uni fun ann
-&gt; Maybe
     ([Def (UVarDecl name ann) (Term name uni fun ann)],
      Term name uni fun ann)
</span><a href="#local-6989586621681137342"><span class="hs-identifier hs-var">collectArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681137338"><span class="hs-identifier hs-var">arg</span></a></span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-glyph hs-var">:</span></a></span><span class="annot"><span class="annottext">[Term name uni fun ann]
</span><a href="#local-6989586621681137341"><span class="hs-identifier hs-var">argStack</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681137339"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-133"></span><span>      </span><span class="annot"><a href="#local-6989586621681137342"><span class="hs-identifier hs-var">collectArgs</span></a></span><span> </span><span id="local-6989586621681137337"><span class="annot"><span class="annottext">[Term name uni fun ann]
</span><a href="#local-6989586621681137337"><span class="hs-identifier hs-var">argStack</span></a></span></span><span> </span><span id="local-6989586621681137336"><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681137336"><span class="hs-identifier hs-var">t</span></a></span></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {val} {name} {ann} {uni :: * -&gt; *} {fun}.
[val]
-&gt; [Def (UVarDecl name ann) val]
-&gt; Term name uni fun ann
-&gt; Maybe ([Def (UVarDecl name ann) val], Term name uni fun ann)
</span><a href="#local-6989586621681137335"><span class="hs-identifier hs-var">matchArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[Term name uni fun ann]
</span><a href="#local-6989586621681137337"><span class="hs-identifier hs-var">argStack</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681137336"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-134"></span><span>      </span><span id="local-6989586621681137335"><span class="annot"><span class="annottext">matchArgs :: [val]
-&gt; [Def (UVarDecl name ann) val]
-&gt; Term name uni fun ann
-&gt; Maybe ([Def (UVarDecl name ann) val], Term name uni fun ann)
</span><a href="#local-6989586621681137335"><span class="hs-identifier hs-var hs-var">matchArgs</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681137332"><span class="annot"><span class="annottext">val
</span><a href="#local-6989586621681137332"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621681137331"><span class="annot"><span class="annottext">[val]
</span><a href="#local-6989586621681137331"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681137330"><span class="annot"><span class="annottext">[Def (UVarDecl name ann) val]
</span><a href="#local-6989586621681137330"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#LamAbs"><span class="hs-identifier hs-type">LamAbs</span></a></span><span> </span><span id="local-6989586621681137328"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681137328"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681137327"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681137327"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681137326"><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681137326"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[val]
-&gt; [Def (UVarDecl name ann) val]
-&gt; Term name uni fun ann
-&gt; Maybe ([Def (UVarDecl name ann) val], Term name uni fun ann)
</span><a href="#local-6989586621681137335"><span class="hs-identifier hs-var">matchArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[val]
</span><a href="#local-6989586621681137331"><span class="hs-identifier hs-var">rest</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall var val. var -&gt; val -&gt; Def var val
</span><a href="PlutusCore.MkPlc.html#Def"><span class="hs-identifier hs-var">Def</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall name ann. ann -&gt; name -&gt; UVarDecl name ann
</span><a href="UntypedPlutusCore.Core.Type.html#UVarDecl"><span class="hs-identifier hs-var">UVarDecl</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681137328"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681137327"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">val
</span><a href="#local-6989586621681137332"><span class="hs-identifier hs-var">arg</span></a></span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-glyph hs-var">:</span></a></span><span class="annot"><span class="annottext">[Def (UVarDecl name ann) val]
</span><a href="#local-6989586621681137330"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681137326"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-135"></span><span>      </span><span class="annot"><a href="#local-6989586621681137335"><span class="hs-identifier hs-var">matchArgs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>         </span><span id="local-6989586621681137323"><span class="annot"><span class="annottext">[Def (UVarDecl name ann) val]
</span><a href="#local-6989586621681137323"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621681137322"><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681137322"><span class="hs-identifier hs-var">t</span></a></span></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Def (UVarDecl name ann) val]
</span><a href="#local-6989586621681137323"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">[Def (UVarDecl name ann) val]
</span><a href="#local-6989586621681137323"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681137322"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>      </span><span class="annot"><a href="#local-6989586621681137335"><span class="hs-identifier hs-var">matchArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">val
</span><span class="hs-identifier">_</span></span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-glyph hs-type">:</span></a></span><span class="annot"><span class="annottext">[val]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>      </span><span class="annot"><span class="annottext">[Def (UVarDecl name ann) val]
</span><span class="hs-identifier">_</span></span><span>   </span><span class="annot"><span class="annottext">Term name uni fun ann
</span><span class="hs-identifier">_</span></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="hs-comment">-- | The inverse of 'extractApps'.</span><span>
</span><span id="line-139"></span><span id="local-6989586621681137711"><span id="local-6989586621681137712"><span id="local-6989586621681137713"><span id="local-6989586621681137714"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#restoreApps"><span class="hs-identifier hs-type">restoreApps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="UntypedPlutusCore.MkUPlc.html#UTermDef"><span class="hs-identifier hs-type">UTermDef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137714"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137713"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137712"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137711"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137714"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137713"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137712"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137711"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137714"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137713"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137712"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137711"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span><span>
</span><span id="line-140"></span><span id="restoreApps"><span class="annot"><span class="annottext">restoreApps :: forall name (uni :: * -&gt; *) fun a.
[UTermDef name uni fun a]
-&gt; Term name uni fun a -&gt; Term name uni fun a
</span><a href="UntypedPlutusCore.Transform.Inline.html#restoreApps"><span class="hs-identifier hs-var hs-var">restoreApps</span></a></span></span><span> </span><span id="local-6989586621681137318"><span class="annot"><span class="annottext">[UTermDef name uni fun a]
</span><a href="#local-6989586621681137318"><span class="hs-identifier hs-var">defs</span></a></span></span><span> </span><span id="local-6989586621681137317"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681137317"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {name} {uni :: * -&gt; *} {fun} {ann}.
[Term name uni fun ann]
-&gt; Term name uni fun ann
-&gt; [Def (UVarDecl name ann) (Term name uni fun ann)]
-&gt; Term name uni fun ann
</span><a href="#local-6989586621681137316"><span class="hs-identifier hs-var">makeLams</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681137317"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">[UTermDef name uni fun a]
</span><a href="#local-6989586621681137318"><span class="hs-identifier hs-var">defs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-142"></span><span>      </span><span id="local-6989586621681137316"><span class="annot"><span class="annottext">makeLams :: [Term name uni fun ann]
-&gt; Term name uni fun ann
-&gt; [Def (UVarDecl name ann) (Term name uni fun ann)]
-&gt; Term name uni fun ann
</span><a href="#local-6989586621681137316"><span class="hs-identifier hs-var hs-var">makeLams</span></a></span></span><span> </span><span id="local-6989586621681137315"><span class="annot"><span class="annottext">[Term name uni fun ann]
</span><a href="#local-6989586621681137315"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621681137314"><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681137314"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.MkPlc.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#UVarDecl"><span class="hs-identifier hs-type">UVarDecl</span></a></span><span> </span><span id="local-6989586621681137313"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681137313"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681137312"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681137312"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681137311"><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681137311"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621681137310"><span class="annot"><span class="annottext">[Def (UVarDecl name ann) (Term name uni fun ann)]
</span><a href="#local-6989586621681137310"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Term name uni fun ann]
-&gt; Term name uni fun ann
-&gt; [Def (UVarDecl name ann) (Term name uni fun ann)]
-&gt; Term name uni fun ann
</span><a href="#local-6989586621681137316"><span class="hs-identifier hs-var">makeLams</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681137311"><span class="hs-identifier hs-var">rhs</span></a></span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-glyph hs-var">:</span></a></span><span class="annot"><span class="annottext">[Term name uni fun ann]
</span><a href="#local-6989586621681137315"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun ann.
ann -&gt; name -&gt; Term name uni fun ann -&gt; Term name uni fun ann
</span><a href="UntypedPlutusCore.Core.Type.html#LamAbs"><span class="hs-identifier hs-var">LamAbs</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681137313"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681137312"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681137314"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Def (UVarDecl name ann) (Term name uni fun ann)]
</span><a href="#local-6989586621681137310"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-143"></span><span>      </span><span class="annot"><a href="#local-6989586621681137316"><span class="hs-identifier hs-var">makeLams</span></a></span><span> </span><span id="local-6989586621681137309"><span class="annot"><span class="annottext">[Term name uni fun ann]
</span><a href="#local-6989586621681137309"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621681137308"><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681137308"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>                            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {name} {uni :: * -&gt; *} {fun} {ann}.
[Term name uni fun ann]
-&gt; Term name uni fun ann -&gt; Term name uni fun ann
</span><a href="#local-6989586621681137307"><span class="hs-identifier hs-var">makeApps</span></a></span><span> </span><span class="annot"><span class="annottext">[Term name uni fun ann]
</span><a href="#local-6989586621681137309"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681137308"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-144"></span><span>      </span><span class="hs-comment">-- This isn't the best annotation, but it will do</span><span>
</span><span id="line-145"></span><span>      </span><span id="local-6989586621681137307"><span class="annot"><span class="annottext">makeApps :: [Term name uni fun ann]
-&gt; Term name uni fun ann -&gt; Term name uni fun ann
</span><a href="#local-6989586621681137307"><span class="hs-identifier hs-var hs-var">makeApps</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681137306"><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681137306"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621681137305"><span class="annot"><span class="annottext">[Term name uni fun ann]
</span><a href="#local-6989586621681137305"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681137304"><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681137304"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Term name uni fun ann]
-&gt; Term name uni fun ann -&gt; Term name uni fun ann
</span><a href="#local-6989586621681137307"><span class="hs-identifier hs-var">makeApps</span></a></span><span> </span><span class="annot"><span class="annottext">[Term name uni fun ann]
</span><a href="#local-6989586621681137305"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun ann.
ann
-&gt; Term name uni fun ann
-&gt; Term name uni fun ann
-&gt; Term name uni fun ann
</span><a href="UntypedPlutusCore.Core.Type.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun ann. Term name uni fun ann -&gt; ann
</span><a href="UntypedPlutusCore.Core.Type.html#termAnn"><span class="hs-identifier hs-var">termAnn</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681137304"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681137304"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681137306"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span>      </span><span class="annot"><a href="#local-6989586621681137307"><span class="hs-identifier hs-var">makeApps</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621681137302"><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681137302"><span class="hs-identifier hs-var">acc</span></a></span></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681137302"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#processTerm"><span class="hs-identifier hs-type">processTerm</span></a></span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681137742"><span class="annot"><a href="#local-6989586621681137742"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span id="local-6989586621681137741"><span class="annot"><a href="#local-6989586621681137741"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681137740"><span class="annot"><a href="#local-6989586621681137740"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621681137739"><span class="annot"><a href="#local-6989586621681137739"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InliningConstraints"><span class="hs-identifier hs-type">InliningConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137742"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137741"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137740"><span class="hs-identifier hs-type">fun</span></a></span><span>
</span><span id="line-150"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137742"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137741"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137740"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137739"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-151"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineM"><span class="hs-identifier hs-type">InlineM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137742"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137741"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137740"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137739"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137742"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137741"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137740"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137739"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span id="processTerm"><span class="annot"><span class="annottext">processTerm :: forall name (uni :: * -&gt; *) fun a.
InliningConstraints name uni fun =&gt;
Term name uni fun a -&gt; InlineM name uni fun a (Term name uni fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#processTerm"><span class="hs-identifier hs-var hs-var">processTerm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term name uni fun a -&gt; InlineM name uni fun a (Term name uni fun a)
</span><a href="#local-6989586621681137255"><span class="hs-identifier hs-var">handleTerm</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-153"></span><span>    </span><span class="annot"><a href="#local-6989586621681137255"><span class="hs-identifier hs-type">handleTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137742"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137741"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137740"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137739"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineM"><span class="hs-identifier hs-type">InlineM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137742"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137741"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137740"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137739"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137742"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137741"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137740"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137739"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span>    </span><span id="local-6989586621681137255"><span class="annot"><span class="annottext">handleTerm :: Term name uni fun a -&gt; InlineM name uni fun a (Term name uni fun a)
</span><a href="#local-6989586621681137255"><span class="hs-identifier hs-var hs-var">handleTerm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-155"></span><span>        </span><span id="local-6989586621681137254"><span class="annot"><span class="annottext">v :: Term name uni fun a
</span><a href="#local-6989586621681137254"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681137252"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681137252"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681137254"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">name -&gt; InlineM name uni fun a (Maybe (Term name uni fun a))
</span><a href="#local-6989586621681137249"><span class="hs-identifier hs-var">substName</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681137252"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-156"></span><span>        </span><span class="hs-comment">-- See Note [Differences from PIR inliner] 3</span><span>
</span><span id="line-157"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun a.
Term name uni fun a
-&gt; Maybe ([UTermDef name uni fun a], Term name uni fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#extractApps"><span class="hs-identifier hs-var">extractApps</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681137248"><span class="annot"><span class="annottext">[UTermDef name uni fun a]
</span><a href="#local-6989586621681137248"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681137247"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681137247"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-158"></span><span>            </span><span id="local-6989586621681137246"><span class="annot"><span class="annottext">[UTermDef name uni fun a]
</span><a href="#local-6989586621681137246"><span class="hs-identifier hs-var">bs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Witherable t, Applicative f) =&gt;
(a -&gt; f (Maybe b)) -&gt; t a -&gt; f (t b)
</span><a href="../../../../witherable/html/src"><span class="hs-identifier hs-var">wither</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun a.
InliningConstraints name uni fun =&gt;
Term name uni fun a
-&gt; UTermDef name uni fun a
-&gt; InlineM name uni fun a (Maybe (UTermDef name uni fun a))
</span><a href="UntypedPlutusCore.Transform.Inline.html#processSingleBinding"><span class="hs-identifier hs-var">processSingleBinding</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681137247"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UTermDef name uni fun a]
</span><a href="#local-6989586621681137248"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-159"></span><span>            </span><span id="local-6989586621681137244"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681137244"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun a.
InliningConstraints name uni fun =&gt;
Term name uni fun a -&gt; InlineM name uni fun a (Term name uni fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#processTerm"><span class="hs-identifier hs-var">processTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681137247"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-160"></span><span>            </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun a.
[UTermDef name uni fun a]
-&gt; Term name uni fun a -&gt; Term name uni fun a
</span><a href="UntypedPlutusCore.Transform.Inline.html#restoreApps"><span class="hs-identifier hs-var">restoreApps</span></a></span><span> </span><span class="annot"><span class="annottext">[UTermDef name uni fun a]
</span><a href="#local-6989586621681137246"><span class="hs-identifier hs-var">bs'</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681137244"><span class="hs-identifier hs-var">t'</span></a></span><span>
</span><span id="line-161"></span><span>        </span><span id="local-6989586621681137243"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681137243"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) s t a b.
LensLike (WrappedMonad m) s t a b -&gt; s -&gt; (a -&gt; m b) -&gt; m t
</span><a href="../../../../lens/html/src"><span class="hs-identifier hs-var">forMOf</span></a></span><span> </span><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun ann.
Traversal' (Term name uni fun ann) (Term name uni fun ann)
</span><a href="UntypedPlutusCore.Core.Plated.html#termSubterms"><span class="hs-identifier hs-var">termSubterms</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681137243"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun a.
InliningConstraints name uni fun =&gt;
Term name uni fun a -&gt; InlineM name uni fun a (Term name uni fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#processTerm"><span class="hs-identifier hs-var">processTerm</span></a></span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span>    </span><span class="hs-comment">-- See Note [Renaming strategy]</span><span>
</span><span id="line-164"></span><span>    </span><span class="annot"><a href="#local-6989586621681137249"><span class="hs-identifier hs-type">substName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621681137742"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineM"><span class="hs-identifier hs-type">InlineM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137742"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137741"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137740"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137739"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137742"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137741"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137740"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137739"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span>    </span><span id="local-6989586621681137249"><span class="annot"><span class="annottext">substName :: name -&gt; InlineM name uni fun a (Maybe (Term name uni fun a))
</span><a href="#local-6989586621681137249"><span class="hs-identifier hs-var hs-var">substName</span></a></span></span><span> </span><span id="local-6989586621681137240"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681137240"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><a href="../../../../mtl/html/src"><span class="hs-identifier hs-var">gets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun a.
HasUnique name TermUnique =&gt;
name -&gt; Subst name uni fun a -&gt; Maybe (InlineTerm name uni fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#lookupTerm"><span class="hs-identifier hs-var">lookupTerm</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681137240"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="annot"><span class="annottext">InlineTerm name uni fun a
-&gt; InlineM name uni fun a (Term name uni fun a)
</span><a href="#local-6989586621681137237"><span class="hs-identifier hs-var">renameTerm</span></a></span><span>
</span><span id="line-166"></span><span>    </span><span class="hs-comment">-- See Note [Inlining approach and 'Secrets of the GHC Inliner']</span><span>
</span><span id="line-167"></span><span>    </span><span class="annot"><a href="#local-6989586621681137237"><span class="hs-identifier hs-type">renameTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineTerm"><span class="hs-identifier hs-type">InlineTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137742"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137741"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137740"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137739"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineM"><span class="hs-identifier hs-type">InlineM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137742"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137741"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137740"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137739"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137742"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137741"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137740"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137739"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span>    </span><span id="local-6989586621681137237"><span class="annot"><span class="annottext">renameTerm :: InlineTerm name uni fun a
-&gt; InlineM name uni fun a (Term name uni fun a)
</span><a href="#local-6989586621681137237"><span class="hs-identifier hs-var hs-var">renameTerm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-169"></span><span>        </span><span class="hs-comment">-- Already processed term, just rename and put it in, don't do any</span><span>
</span><span id="line-170"></span><span>        </span><span class="hs-comment">-- further optimization here.</span><span>
</span><span id="line-171"></span><span>        </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#Done"><span class="hs-identifier hs-type">Done</span></a></span><span> </span><span id="local-6989586621681137236"><span class="annot"><span class="annottext">Dupable (Term name uni fun a)
</span><a href="#local-6989586621681137236"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
(MonadQuote m, Rename a) =&gt;
Dupable a -&gt; m a
</span><a href="PlutusCore.Rename.html#liftDupable"><span class="hs-identifier hs-var">liftDupable</span></a></span><span> </span><span class="annot"><span class="annottext">Dupable (Term name uni fun a)
</span><a href="#local-6989586621681137236"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span id="local-6989586621681137642"><span id="local-6989586621681137643"><span id="local-6989586621681137644"><span id="local-6989586621681137645"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#processSingleBinding"><span class="hs-identifier hs-type">processSingleBinding</span></a></span><span>
</span><span id="line-174"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InliningConstraints"><span class="hs-identifier hs-type">InliningConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137645"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137644"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137643"><span class="hs-identifier hs-type">fun</span></a></span><span>
</span><span id="line-175"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137645"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137644"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137643"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137642"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-176"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.MkUPlc.html#UTermDef"><span class="hs-identifier hs-type">UTermDef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137645"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137644"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137643"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137642"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-177"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineM"><span class="hs-identifier hs-type">InlineM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137645"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137644"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137643"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137642"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.MkUPlc.html#UTermDef"><span class="hs-identifier hs-type">UTermDef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137645"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137644"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137643"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137642"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-178"></span><span id="processSingleBinding"><span class="annot"><span class="annottext">processSingleBinding :: forall name (uni :: * -&gt; *) fun a.
InliningConstraints name uni fun =&gt;
Term name uni fun a
-&gt; UTermDef name uni fun a
-&gt; InlineM name uni fun a (Maybe (UTermDef name uni fun a))
</span><a href="UntypedPlutusCore.Transform.Inline.html#processSingleBinding"><span class="hs-identifier hs-var hs-var">processSingleBinding</span></a></span></span><span> </span><span id="local-6989586621681137223"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681137223"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.MkPlc.html#Def"><span class="hs-identifier hs-type">Def</span></a></span><span> </span><span id="local-6989586621681137222"><span class="annot"><span class="annottext">vd :: UVarDecl name a
</span><a href="#local-6989586621681137222"><span class="hs-identifier hs-var">vd</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#UVarDecl"><span class="hs-identifier hs-type">UVarDecl</span></a></span><span> </span><span id="local-6989586621681137221"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681137221"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681137220"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681137220"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681137219"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681137219"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-179"></span><span>    </span><span id="local-6989586621681137218"><span class="annot"><span class="annottext">Maybe (Term name uni fun a)
</span><a href="#local-6989586621681137218"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun a.
InliningConstraints name uni fun =&gt;
Term name uni fun a
-&gt; a
-&gt; name
-&gt; Term name uni fun a
-&gt; InlineM name uni fun a (Maybe (Term name uni fun a))
</span><a href="UntypedPlutusCore.Transform.Inline.html#maybeAddSubst"><span class="hs-identifier hs-var">maybeAddSubst</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681137223"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681137221"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681137220"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681137219"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-180"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall var val. var -&gt; val -&gt; Def var val
</span><a href="PlutusCore.MkPlc.html#Def"><span class="hs-identifier hs-var">Def</span></a></span><span> </span><span class="annot"><span class="annottext">UVarDecl name a
</span><a href="#local-6989586621681137222"><span class="hs-identifier hs-var">vd</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Term name uni fun a)
</span><a href="#local-6989586621681137218"><span class="hs-identifier hs-var">rhs'</span></a></span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span><span class="hs-comment">-- NOTE:  Nothing means that we are inlining the term:</span><span>
</span><span id="line-183"></span><span class="hs-comment">--   * we have extended the substitution, and</span><span>
</span><span id="line-184"></span><span class="hs-comment">--   * we are removing the binding (hence we return Nothing)</span><span>
</span><span id="line-185"></span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#maybeAddSubst"><span class="hs-identifier hs-type">maybeAddSubst</span></a></span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681137611"><span class="annot"><a href="#local-6989586621681137611"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span id="local-6989586621681137610"><span class="annot"><a href="#local-6989586621681137610"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681137609"><span class="annot"><a href="#local-6989586621681137609"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621681137608"><span class="annot"><a href="#local-6989586621681137608"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InliningConstraints"><span class="hs-identifier hs-type">InliningConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137611"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137610"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137609"><span class="hs-identifier hs-type">fun</span></a></span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137611"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137610"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137609"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137608"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-188"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681137608"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681137611"><span class="hs-identifier hs-type">name</span></a></span><span>
</span><span id="line-190"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137611"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137610"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137609"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137608"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-191"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineM"><span class="hs-identifier hs-type">InlineM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137611"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137610"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137609"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137608"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137611"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137610"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137609"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137608"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span id="maybeAddSubst"><span class="annot"><span class="annottext">maybeAddSubst :: forall name (uni :: * -&gt; *) fun a.
InliningConstraints name uni fun =&gt;
Term name uni fun a
-&gt; a
-&gt; name
-&gt; Term name uni fun a
-&gt; InlineM name uni fun a (Maybe (Term name uni fun a))
</span><a href="UntypedPlutusCore.Transform.Inline.html#maybeAddSubst"><span class="hs-identifier hs-var hs-var">maybeAddSubst</span></a></span></span><span> </span><span id="local-6989586621681137186"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681137186"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621681137185"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681137185"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681137184"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681137184"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681137183"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681137183"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-193"></span><span>    </span><span id="local-6989586621681137182"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681137182"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun a.
InliningConstraints name uni fun =&gt;
Term name uni fun a -&gt; InlineM name uni fun a (Term name uni fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#processTerm"><span class="hs-identifier hs-var">processTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681137183"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span>    </span><span class="hs-comment">-- Check whether we've been told specifically to inline this</span><span>
</span><span id="line-196"></span><span>    </span><span id="local-6989586621681137181"><span class="annot"><span class="annottext">InlineHints name a
</span><a href="#local-6989586621681137181"><span class="hs-identifier hs-var">hints</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><a href="../../../../mtl/html/src"><span class="hs-identifier hs-var">asks</span></a></span><span> </span><span class="annot"><span class="annottext">forall name a. InlineInfo name a -&gt; InlineHints name a
</span><a href="UntypedPlutusCore.Transform.Inline.html#_hints"><span class="hs-identifier hs-var">_hints</span></a></span><span>
</span><span id="line-197"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681137179"><span class="annot"><span class="annottext">hinted :: Bool
</span><a href="#local-6989586621681137179"><span class="hs-identifier hs-var hs-var">hinted</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall name a. InlineHints name a -&gt; a -&gt; name -&gt; Bool
</span><a href="PlutusCore.InlineUtils.html#shouldInline"><span class="hs-identifier hs-var">shouldInline</span></a></span><span> </span><span class="annot"><span class="annottext">InlineHints name a
</span><a href="#local-6989586621681137181"><span class="hs-identifier hs-var">hints</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681137185"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681137184"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span>    </span><span id="local-6989586621681137177"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681137177"><span class="hs-identifier hs-var">preUnconditional</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term name uni fun a -&gt; InlineM name uni fun a Bool
</span><a href="#local-6989586621681137176"><span class="hs-identifier hs-var">preInlineUnconditional</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681137182"><span class="hs-identifier hs-var">rhs'</span></a></span><span>
</span><span id="line-200"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681137177"><span class="hs-identifier hs-var">preUnconditional</span></a></span><span>
</span><span id="line-201"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall b.
InlineTerm name uni fun a -&gt; InlineM name uni fun a (Maybe b)
</span><a href="#local-6989586621681137175"><span class="hs-identifier hs-var">extendAndDrop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun a.
Dupable (Term name uni fun a) -&gt; InlineTerm name uni fun a
</span><a href="UntypedPlutusCore.Transform.Inline.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Dupable a
</span><a href="PlutusCore.Rename.html#dupable"><span class="hs-identifier hs-var">dupable</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681137182"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-203"></span><span>        </span><span class="hs-comment">-- See Note [Inlining approach and 'Secrets of the GHC Inliner']</span><span>
</span><span id="line-204"></span><span>        </span><span id="local-6989586621681137174"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681137174"><span class="hs-identifier hs-var">postUnconditional</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term name uni fun a -&gt; InlineM name uni fun a Bool
</span><a href="#local-6989586621681137173"><span class="hs-identifier hs-var">postInlineUnconditional</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681137182"><span class="hs-identifier hs-var">rhs'</span></a></span><span>
</span><span id="line-205"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681137179"><span class="hs-identifier hs-var">hinted</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681137174"><span class="hs-identifier hs-var">postUnconditional</span></a></span><span>
</span><span id="line-206"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall b.
InlineTerm name uni fun a -&gt; InlineM name uni fun a (Maybe b)
</span><a href="#local-6989586621681137175"><span class="hs-identifier hs-var">extendAndDrop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun a.
Dupable (Term name uni fun a) -&gt; InlineTerm name uni fun a
</span><a href="UntypedPlutusCore.Transform.Inline.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Dupable a
</span><a href="PlutusCore.Rename.html#dupable"><span class="hs-identifier hs-var">dupable</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681137182"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681137182"><span class="hs-identifier hs-var">rhs'</span></a></span><span>
</span><span id="line-208"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-209"></span><span>        </span><span class="annot"><a href="#local-6989586621681137175"><span class="hs-identifier hs-type">extendAndDrop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681137595"><span class="annot"><a href="#local-6989586621681137595"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineTerm"><span class="hs-identifier hs-type">InlineTerm</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137611"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137610"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137609"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137608"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineM"><span class="hs-identifier hs-type">InlineM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137611"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137610"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137609"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137608"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137595"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span>        </span><span id="local-6989586621681137175"><span class="annot"><span class="annottext">extendAndDrop :: forall b.
InlineTerm name uni fun a -&gt; InlineM name uni fun a (Maybe b)
</span><a href="#local-6989586621681137175"><span class="hs-identifier hs-var hs-var">extendAndDrop</span></a></span></span><span> </span><span id="local-6989586621681137166"><span class="annot"><span class="annottext">InlineTerm name uni fun a
</span><a href="#local-6989586621681137166"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><a href="../../../../mtl/html/src"><span class="hs-identifier hs-var">modify'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun a.
HasUnique name TermUnique =&gt;
name
-&gt; InlineTerm name uni fun a
-&gt; Subst name uni fun a
-&gt; Subst name uni fun a
</span><a href="UntypedPlutusCore.Transform.Inline.html#extendTerm"><span class="hs-identifier hs-var">extendTerm</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681137184"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">InlineTerm name uni fun a
</span><a href="#local-6989586621681137166"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span>        </span><span class="annot"><a href="#local-6989586621681137164"><span class="hs-identifier hs-type">checkPurity</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137611"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137610"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137609"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137608"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineM"><span class="hs-identifier hs-type">InlineM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137611"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137610"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137609"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137608"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-213"></span><span>        </span><span id="local-6989586621681137164"><span class="annot"><span class="annottext">checkPurity :: Term name uni fun a -&gt; InlineM name uni fun a Bool
</span><a href="#local-6989586621681137164"><span class="hs-identifier hs-var hs-var">checkPurity</span></a></span></span><span> </span><span id="local-6989586621681137163"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681137163"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun a. Term name uni fun a -&gt; Bool
</span><a href="UntypedPlutusCore.Transform.Inline.html#isPure"><span class="hs-identifier hs-var">isPure</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681137163"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span>        </span><span class="annot"><a href="#local-6989586621681137176"><span class="hs-identifier hs-type">preInlineUnconditional</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137611"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137610"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137609"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137608"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineM"><span class="hs-identifier hs-type">InlineM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137611"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137610"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137609"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137608"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-216"></span><span>        </span><span id="local-6989586621681137176"><span class="annot"><span class="annottext">preInlineUnconditional :: Term name uni fun a -&gt; InlineM name uni fun a Bool
</span><a href="#local-6989586621681137176"><span class="hs-identifier hs-var hs-var">preInlineUnconditional</span></a></span></span><span> </span><span id="local-6989586621681137161"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681137161"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-217"></span><span>            </span><span id="local-6989586621681137160"><span class="annot"><span class="annottext">Usages
</span><a href="#local-6989586621681137160"><span class="hs-identifier hs-var">usgs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><a href="../../../../mtl/html/src"><span class="hs-identifier hs-var">asks</span></a></span><span> </span><span class="annot"><span class="annottext">forall name a. InlineInfo name a -&gt; Usages
</span><a href="UntypedPlutusCore.Transform.Inline.html#_usages"><span class="hs-identifier hs-var">_usages</span></a></span><span>
</span><span id="line-218"></span><span>            </span><span class="hs-comment">-- 'inlining' terms used 0 times is a cheap way to remove dead code while we're here</span><span>
</span><span id="line-219"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681137159"><span class="annot"><span class="annottext">termUsedAtMostOnce :: Bool
</span><a href="#local-6989586621681137159"><span class="hs-identifier hs-var hs-var">termUsedAtMostOnce</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall n unique. HasUnique n unique =&gt; n -&gt; Usages -&gt; Int
</span><a href="UntypedPlutusCore.Analysis.Usages.html#getUsageCount"><span class="hs-identifier hs-var">Usages.getUsageCount</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681137184"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Usages
</span><a href="#local-6989586621681137160"><span class="hs-identifier hs-var">usgs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-220"></span><span>            </span><span class="hs-comment">-- See Note [Inlining and purity]</span><span>
</span><span id="line-221"></span><span>            </span><span id="local-6989586621681137156"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681137156"><span class="hs-identifier hs-var">termIsPure</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term name uni fun a -&gt; InlineM name uni fun a Bool
</span><a href="#local-6989586621681137164"><span class="hs-identifier hs-var">checkPurity</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681137161"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-222"></span><span>            </span><span class="hs-comment">-- This can in the worst case traverse a lot of the term, which could lead to us</span><span>
</span><span id="line-223"></span><span>            </span><span class="hs-comment">-- doing ~quadratic work as we process the program. However in practice most term</span><span>
</span><span id="line-224"></span><span>            </span><span class="hs-comment">-- types will make it give up, so it's not too bad.</span><span>
</span><span id="line-225"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681137155"><span class="annot"><span class="annottext">immediatelyEvaluated :: Bool
</span><a href="#local-6989586621681137155"><span class="hs-identifier hs-var hs-var">immediatelyEvaluated</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun a.
Term name uni fun a -&gt; Maybe (Term name uni fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#firstEffectfulTerm"><span class="hs-identifier hs-var">firstEffectfulTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681137186"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-226"></span><span>                 </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681137153"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681137153"><span class="hs-identifier hs-var">n'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681137184"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681137153"><span class="hs-identifier hs-var">n'</span></a></span><span>
</span><span id="line-227"></span><span>                 </span><span class="annot"><span class="annottext">Maybe (Term name uni fun a)
</span><span class="hs-identifier">_</span></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-228"></span><span>                </span><span id="local-6989586621681137152"><span class="annot"><span class="annottext">effectSafe :: Bool
</span><a href="#local-6989586621681137152"><span class="hs-identifier hs-var hs-var">effectSafe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681137156"><span class="hs-identifier hs-var">termIsPure</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681137155"><span class="hs-identifier hs-var">immediatelyEvaluated</span></a></span><span>
</span><span id="line-229"></span><span>            </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681137159"><span class="hs-identifier hs-var">termUsedAtMostOnce</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681137152"><span class="hs-identifier hs-var">effectSafe</span></a></span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span>        </span><span class="hs-comment">-- | Should we inline? Should only inline things that won't duplicate work or code.</span><span>
</span><span id="line-232"></span><span>        </span><span class="hs-comment">-- See Note [Inlining approach and 'Secrets of the GHC Inliner']</span><span>
</span><span id="line-233"></span><span>        </span><span class="annot"><a href="#local-6989586621681137173"><span class="hs-identifier hs-type">postInlineUnconditional</span></a></span><span> </span><span class="hs-glyph">::</span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137611"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137610"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137609"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137608"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#InlineM"><span class="hs-identifier hs-type">InlineM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137611"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137610"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137609"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137608"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-234"></span><span>        </span><span id="local-6989586621681137173"><span class="annot"><span class="annottext">postInlineUnconditional :: Term name uni fun a -&gt; InlineM name uni fun a Bool
</span><a href="#local-6989586621681137173"><span class="hs-identifier hs-var hs-var">postInlineUnconditional</span></a></span></span><span> </span><span id="local-6989586621681137150"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681137150"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-235"></span><span>            </span><span class="hs-comment">-- See Note [Inlining criteria]</span><span>
</span><span id="line-236"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681137149"><span class="annot"><span class="annottext">acceptable :: Bool
</span><a href="#local-6989586621681137149"><span class="hs-identifier hs-var hs-var">acceptable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun a. Term name uni fun a -&gt; Bool
</span><a href="UntypedPlutusCore.Transform.Inline.html#costIsAcceptable"><span class="hs-identifier hs-var">costIsAcceptable</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681137150"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun a. Term name uni fun a -&gt; Bool
</span><a href="UntypedPlutusCore.Transform.Inline.html#sizeIsAcceptable"><span class="hs-identifier hs-var">sizeIsAcceptable</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681137150"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-237"></span><span>            </span><span class="hs-comment">-- See Note [Inlining and purity]</span><span>
</span><span id="line-238"></span><span>            </span><span id="local-6989586621681137146"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681137146"><span class="hs-identifier hs-var">termIsPure</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term name uni fun a -&gt; InlineM name uni fun a Bool
</span><a href="#local-6989586621681137164"><span class="hs-identifier hs-var">checkPurity</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681137150"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-239"></span><span>            </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681137149"><span class="hs-identifier hs-var">acceptable</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681137146"><span class="hs-identifier hs-var">termIsPure</span></a></span><span>
</span><span id="line-240"></span><span>
</span><span id="line-241"></span><span class="hs-comment">{- |
Try to identify the first sub term which will be evaluated in the given term and
which could have an effect. 'Nothing' indicates that we don't know, this function
is conservative.
-}</span><span>
</span><span id="line-246"></span><span id="local-6989586621681137574"><span id="local-6989586621681137575"><span id="local-6989586621681137576"><span id="local-6989586621681137577"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#firstEffectfulTerm"><span class="hs-identifier hs-type">firstEffectfulTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137577"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137576"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137575"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137574"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137577"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137576"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137575"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137574"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-247"></span><span id="firstEffectfulTerm"><span class="annot"><span class="annottext">firstEffectfulTerm :: forall name (uni :: * -&gt; *) fun a.
Term name uni fun a -&gt; Maybe (Term name uni fun a)
</span><a href="UntypedPlutusCore.Transform.Inline.html#firstEffectfulTerm"><span class="hs-identifier hs-var hs-var">firstEffectfulTerm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun a.
Term name uni fun a -&gt; Maybe (Term name uni fun a)
</span><a href="#local-6989586621681137145"><span class="hs-identifier hs-var">goTerm</span></a></span><span>
</span><span id="line-248"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-249"></span><span>      </span><span id="local-6989586621681137145"><span class="annot"><span class="annottext">goTerm :: Term name uni fun ann -&gt; Maybe (Term name uni fun ann)
</span><a href="#local-6989586621681137145"><span class="hs-identifier hs-var hs-var">goTerm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span>        </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681137144"><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681137144"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="annot"><span class="annottext">Term name uni fun ann
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term name uni fun ann -&gt; Maybe (Term name uni fun ann)
</span><a href="#local-6989586621681137145"><span class="hs-identifier hs-var">goTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681137144"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-252"></span><span>        </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Force"><span class="hs-identifier hs-type">Force</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681137142"><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681137142"><span class="hs-identifier hs-var">t</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term name uni fun ann -&gt; Maybe (Term name uni fun ann)
</span><a href="#local-6989586621681137145"><span class="hs-identifier hs-var">goTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681137142"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span>        </span><span id="local-6989586621681137141"><span class="annot"><span class="annottext">t :: Term name uni fun ann
</span><a href="#local-6989586621681137141"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681137141"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-255"></span><span>        </span><span id="local-6989586621681137140"><span class="annot"><span class="annottext">t :: Term name uni fun ann
</span><a href="#local-6989586621681137140"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681137140"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-256"></span><span>        </span><span id="local-6989586621681137138"><span class="annot"><span class="annottext">t :: Term name uni fun ann
</span><a href="#local-6989586621681137138"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Builtin"><span class="hs-identifier hs-type">Builtin</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun ann
</span><a href="#local-6989586621681137138"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-257"></span><span>
</span><span id="line-258"></span><span>        </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#LamAbs"><span class="hs-identifier hs-type">LamAbs</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-259"></span><span>        </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Constant"><span class="hs-identifier hs-type">Constant</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-260"></span><span>        </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Delay"><span class="hs-identifier hs-type">Delay</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span class="hs-comment">-- | Is the cost increase (in terms of evaluation work) of inlining a variable whose RHS is</span><span>
</span><span id="line-263"></span><span class="hs-comment">-- the given term acceptable?</span><span>
</span><span id="line-264"></span><span id="local-6989586621681137131"><span id="local-6989586621681137132"><span id="local-6989586621681137133"><span id="local-6989586621681137134"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#costIsAcceptable"><span class="hs-identifier hs-type">costIsAcceptable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137134"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137133"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137132"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137131"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Bool</span></a></span></span></span></span></span><span>
</span><span id="line-265"></span><span id="costIsAcceptable"><span class="annot"><span class="annottext">costIsAcceptable :: forall name (uni :: * -&gt; *) fun a. Term name uni fun a -&gt; Bool
</span><a href="UntypedPlutusCore.Transform.Inline.html#costIsAcceptable"><span class="hs-identifier hs-var hs-var">costIsAcceptable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-266"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Builtin"><span class="hs-identifier hs-type">Builtin</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-267"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-268"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Constant"><span class="hs-identifier hs-type">Constant</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-269"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-270"></span><span>  </span><span class="hs-comment">-- This will mean that we create closures at each use site instead of</span><span>
</span><span id="line-271"></span><span>  </span><span class="hs-comment">-- once, but that's a very low cost which we're okay rounding to 0.</span><span>
</span><span id="line-272"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#LamAbs"><span class="hs-identifier hs-type">LamAbs</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-273"></span><span>
</span><span id="line-274"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Force"><span class="hs-identifier hs-type">Force</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-277"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Delay"><span class="hs-identifier hs-type">Delay</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span class="hs-comment">-- | Is the size increase (in the AST) of inlining a variable whose RHS is</span><span>
</span><span id="line-280"></span><span class="hs-comment">-- the given term acceptable?</span><span>
</span><span id="line-281"></span><span id="local-6989586621681137127"><span id="local-6989586621681137128"><span id="local-6989586621681137129"><span id="local-6989586621681137130"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#sizeIsAcceptable"><span class="hs-identifier hs-type">sizeIsAcceptable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137130"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137129"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137128"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137127"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Bool</span></a></span></span></span></span></span><span>
</span><span id="line-282"></span><span id="sizeIsAcceptable"><span class="annot"><span class="annottext">sizeIsAcceptable :: forall name (uni :: * -&gt; *) fun a. Term name uni fun a -&gt; Bool
</span><a href="UntypedPlutusCore.Transform.Inline.html#sizeIsAcceptable"><span class="hs-identifier hs-var hs-var">sizeIsAcceptable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-283"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Builtin"><span class="hs-identifier hs-type">Builtin</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-284"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-285"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-286"></span><span>
</span><span id="line-287"></span><span>  </span><span class="hs-comment">-- See Note [Differences from PIR inliner] 4</span><span>
</span><span id="line-288"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#LamAbs"><span class="hs-identifier hs-type">LamAbs</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-289"></span><span>
</span><span id="line-290"></span><span>  </span><span class="hs-comment">-- Constants can be big! We could check the size here and inline if they're</span><span>
</span><span id="line-291"></span><span>  </span><span class="hs-comment">-- small, but probably not worth it</span><span>
</span><span id="line-292"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Constant"><span class="hs-identifier hs-type">Constant</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-293"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Force"><span class="hs-identifier hs-type">Force</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681137126"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681137126"><span class="hs-identifier hs-var">t</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun a. Term name uni fun a -&gt; Bool
</span><a href="UntypedPlutusCore.Transform.Inline.html#sizeIsAcceptable"><span class="hs-identifier hs-var">sizeIsAcceptable</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681137126"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-296"></span><span>  </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Delay"><span class="hs-identifier hs-type">Delay</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681137125"><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681137125"><span class="hs-identifier hs-var">t</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun a. Term name uni fun a -&gt; Bool
</span><a href="UntypedPlutusCore.Transform.Inline.html#sizeIsAcceptable"><span class="hs-identifier hs-var">sizeIsAcceptable</span></a></span><span> </span><span class="annot"><span class="annottext">Term name uni fun a
</span><a href="#local-6989586621681137125"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-297"></span><span>
</span><span id="line-298"></span><span id="local-6989586621681137581"><span id="local-6989586621681137582"><span id="local-6989586621681137583"><span id="local-6989586621681137584"><span class="annot"><a href="UntypedPlutusCore.Transform.Inline.html#isPure"><span class="hs-identifier hs-type">isPure</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137584"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137583"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137582"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681137581"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Bool</span></a></span></span></span></span></span><span>
</span><span id="line-299"></span><span id="isPure"><span class="annot"><span class="annottext">isPure :: forall name (uni :: * -&gt; *) fun a. Term name uni fun a -&gt; Bool
</span><a href="UntypedPlutusCore.Transform.Inline.html#isPure"><span class="hs-identifier hs-var hs-var">isPure</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall name (uni :: * -&gt; *) fun a. Term name uni fun a -&gt; Bool
</span><a href="#local-6989586621681137124"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-300"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-301"></span><span>        </span><span id="local-6989586621681137124"><span class="annot"><span class="annottext">go :: Term name uni fun ann -&gt; Bool
</span><a href="#local-6989586621681137124"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-302"></span><span>            </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-303"></span><span>            </span><span class="hs-comment">-- These are syntactically values that won't reduce further</span><span>
</span><span id="line-304"></span><span>            </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#LamAbs"><span class="hs-identifier hs-type">LamAbs</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-305"></span><span>            </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Constant"><span class="hs-identifier hs-type">Constant</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-306"></span><span>            </span><span class="annot"><a href="UntypedPlutusCore.Core.Type.html#Delay"><span class="hs-identifier hs-type">Delay</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-307"></span><span>
</span><span id="line-308"></span><span>            </span><span class="hs-comment">-- See Note [Differences from PIR inliner] 5</span><span>
</span><span id="line-309"></span><span>            </span><span class="annot"><span class="annottext">Term name uni fun ann
</span><span class="hs-identifier">_</span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-310"></span></pre></body></html>