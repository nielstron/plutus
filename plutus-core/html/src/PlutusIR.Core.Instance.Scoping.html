<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- editorconfig-checker-disable-file</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances     #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings     #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes            #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies          #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-orphans       #-}</span><span>
</span><span id="line-8"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">PlutusIR.Core.Instance.Scoping</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html"><span class="hs-identifier">PlutusIR.Core.Type</span></a></span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html"><span class="hs-identifier">PlutusCore.Check.Scoping</span></a></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.MkPlc.html"><span class="hs-identifier">PlutusCore.MkPlc</span></a></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Quote.html"><span class="hs-identifier">PlutusCore.Quote</span></a></span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier">Data.Foldable</span></a></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier">NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator">(&lt;|)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NonEmpty</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier">Data.Traversable</span></a></span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681124623"><span id="local-6989586621681124624"><span id="local-6989586621681124625"><span id="local-6989586621681124626"><span class="annot"><a href="#local-6989586621681124626"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#Reference"><span class="hs-identifier hs-type">Reference</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124626"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124625"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124624"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124623"><span class="hs-identifier hs-type">fun</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-22"></span><span>    </span><span id="local-6989586621681124319"><span class="annot"><span class="annottext">referenceVia :: (forall name. ToScopedName name =&gt; name -&gt; NameAnn)
-&gt; TyName
-&gt; Term tyname name uni fun NameAnn
-&gt; Term tyname name uni fun NameAnn
</span><a href="PlutusCore.Check.Scoping.html#referenceVia"><span class="hs-identifier hs-var hs-var hs-var hs-var">referenceVia</span></a></span></span><span> </span><span id="local-6989586621681124317"><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681124317"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span id="local-6989586621681124316"><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681124316"><span class="hs-identifier hs-var">tyname</span></a></span></span><span> </span><span id="local-6989586621681124315"><span class="annot"><span class="annottext">Term tyname name uni fun NameAnn
</span><a href="#local-6989586621681124315"><span class="hs-identifier hs-var">term</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a
-&gt; Term tyname name uni fun a
-&gt; Type tyname uni a
-&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#TyInst"><span class="hs-identifier hs-var">TyInst</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><a href="PlutusCore.Check.Scoping.html#NotAName"><span class="hs-identifier hs-var">NotAName</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun NameAnn
</span><a href="#local-6989586621681124315"><span class="hs-identifier hs-var">term</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann.
ann -&gt; tyname -&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyVar"><span class="hs-identifier hs-var">TyVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681124317"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681124316"><span class="hs-identifier hs-var">tyname</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681124316"><span class="hs-identifier hs-var">tyname</span></a></span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681124602"><span id="local-6989586621681124603"><span id="local-6989586621681124604"><span id="local-6989586621681124605"><span class="annot"><a href="#local-6989586621681124605"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#Reference"><span class="hs-identifier hs-type">Reference</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124604"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124605"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124603"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124602"><span class="hs-identifier hs-type">fun</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-25"></span><span>    </span><span id="local-6989586621681124305"><span class="annot"><span class="annottext">referenceVia :: (forall name. ToScopedName name =&gt; name -&gt; NameAnn)
-&gt; Name
-&gt; Term tyname name uni fun NameAnn
-&gt; Term tyname name uni fun NameAnn
</span><a href="#local-6989586621681124305"><span class="hs-identifier hs-var hs-var hs-var hs-var">referenceVia</span></a></span></span><span> </span><span id="local-6989586621681124304"><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681124304"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span id="local-6989586621681124303"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124303"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621681124302"><span class="annot"><span class="annottext">Term tyname name uni fun NameAnn
</span><a href="#local-6989586621681124302"><span class="hs-identifier hs-var">term</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a
-&gt; Term tyname name uni fun a
-&gt; Term tyname name uni fun a
-&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><a href="PlutusCore.Check.Scoping.html#NotAName"><span class="hs-identifier hs-var">NotAName</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun NameAnn
</span><a href="#local-6989586621681124302"><span class="hs-identifier hs-var">term</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a -&gt; name -&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681124304"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124303"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124303"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681124595"><span id="local-6989586621681124596"><span id="local-6989586621681124597"><span class="annot"><a href="#local-6989586621681124597"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#Reference"><span class="hs-identifier hs-type">Reference</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#VarDecl"><span class="hs-identifier hs-type">VarDecl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124597"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124596"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124595"><span class="hs-identifier hs-type">uni</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-28"></span><span>    </span><span id="local-6989586621681124291"><span class="annot"><span class="annottext">referenceVia :: (forall name. ToScopedName name =&gt; name -&gt; NameAnn)
-&gt; TyName
-&gt; VarDecl tyname name uni NameAnn
-&gt; VarDecl tyname name uni NameAnn
</span><a href="#local-6989586621681124291"><span class="hs-identifier hs-var hs-var hs-var hs-var">referenceVia</span></a></span></span><span> </span><span id="local-6989586621681124290"><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681124290"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span id="local-6989586621681124289"><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681124289"><span class="hs-identifier hs-var">tyname</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#VarDecl"><span class="hs-identifier hs-type">VarDecl</span></a></span><span> </span><span id="local-6989586621681124287"><span class="annot"><span class="annottext">NameAnn
</span><a href="#local-6989586621681124287"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621681124286"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681124286"><span class="hs-identifier hs-var">varName</span></a></span></span><span> </span><span id="local-6989586621681124285"><span class="annot"><span class="annottext">Type tyname uni NameAnn
</span><a href="#local-6989586621681124285"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-29"></span><span>        </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) ann.
ann -&gt; name -&gt; Type tyname uni ann -&gt; VarDecl tyname name uni ann
</span><a href="PlutusCore.Core.Type.html#VarDecl"><span class="hs-identifier hs-var">VarDecl</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><a href="#local-6989586621681124287"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681124286"><span class="hs-identifier hs-var">varName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall n (t :: * -&gt; *).
Reference n t =&gt;
(forall name. ToScopedName name =&gt; name -&gt; NameAnn)
-&gt; n -&gt; t NameAnn -&gt; t NameAnn
</span><a href="PlutusCore.Check.Scoping.html#referenceVia"><span class="hs-identifier hs-var">referenceVia</span></a></span><span> </span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681124290"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681124289"><span class="hs-identifier hs-var">tyname</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni NameAnn
</span><a href="#local-6989586621681124285"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span class="hs-comment">-- | Scoping for data types is hard, so we employ some extra paranoia and reference the provided</span><span>
</span><span id="line-32"></span><span class="hs-comment">-- 'TyName' in the type of every single constructor, and also apply the final head to that 'TyName'.</span><span>
</span><span id="line-33"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681124581"><span id="local-6989586621681124582"><span id="local-6989586621681124583"><span class="annot"><a href="#local-6989586621681124583"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#Reference"><span class="hs-identifier hs-type">Reference</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Datatype"><span class="hs-identifier hs-type">Datatype</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124583"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124582"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124581"><span class="hs-identifier hs-type">uni</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-34"></span><span>    </span><span id="local-6989586621681124277"><span class="annot"><span class="annottext">referenceVia :: (forall name. ToScopedName name =&gt; name -&gt; NameAnn)
-&gt; TyName
-&gt; Datatype tyname name uni NameAnn
-&gt; Datatype tyname name uni NameAnn
</span><a href="#local-6989586621681124277"><span class="hs-identifier hs-var hs-var hs-var hs-var">referenceVia</span></a></span></span><span> </span><span id="local-6989586621681124276"><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681124276"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span id="local-6989586621681124275"><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681124275"><span class="hs-identifier hs-var">tyname</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Datatype"><span class="hs-identifier hs-type">Datatype</span></a></span><span> </span><span id="local-6989586621681124273"><span class="annot"><span class="annottext">NameAnn
</span><a href="#local-6989586621681124273"><span class="hs-identifier hs-var">dataAnn</span></a></span></span><span> </span><span id="local-6989586621681124272"><span class="annot"><span class="annottext">TyVarDecl tyname NameAnn
</span><a href="#local-6989586621681124272"><span class="hs-identifier hs-var">dataDecl</span></a></span></span><span> </span><span id="local-6989586621681124271"><span class="annot"><span class="annottext">[TyVarDecl tyname NameAnn]
</span><a href="#local-6989586621681124271"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621681124270"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681124270"><span class="hs-identifier hs-var">matchName</span></a></span></span><span> </span><span id="local-6989586621681124269"><span class="annot"><span class="annottext">[VarDecl tyname name uni NameAnn]
</span><a href="#local-6989586621681124269"><span class="hs-identifier hs-var">constrs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-35"></span><span>        </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) a.
a
-&gt; TyVarDecl tyname a
-&gt; [TyVarDecl tyname a]
-&gt; name
-&gt; [VarDecl tyname name uni a]
-&gt; Datatype tyname name uni a
</span><a href="PlutusIR.Core.Type.html#Datatype"><span class="hs-identifier hs-var">Datatype</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><a href="#local-6989586621681124273"><span class="hs-identifier hs-var">dataAnn</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarDecl tyname NameAnn
</span><a href="#local-6989586621681124272"><span class="hs-identifier hs-var">dataDecl</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarDecl tyname NameAnn]
</span><a href="#local-6989586621681124271"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681124270"><span class="hs-identifier hs-var">matchName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">VarDecl TyName name uni NameAnn -&gt; VarDecl TyName name uni NameAnn
</span><a href="#local-6989586621681124268"><span class="hs-identifier hs-var">goConstr</span></a></span><span> </span><span class="annot"><span class="annottext">[VarDecl tyname name uni NameAnn]
</span><a href="#local-6989586621681124269"><span class="hs-identifier hs-var">constrs</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-36"></span><span>            </span><span id="local-6989586621681124267"><span class="annot"><span class="annottext">tyVar :: Type TyName uni NameAnn
</span><a href="#local-6989586621681124267"><span class="hs-identifier hs-var hs-var">tyVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann.
ann -&gt; tyname -&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyVar"><span class="hs-identifier hs-var">TyVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681124276"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681124275"><span class="hs-identifier hs-var">tyname</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681124275"><span class="hs-identifier hs-var">tyname</span></a></span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span>            </span><span id="local-6989586621681124268"><span class="annot"><span class="annottext">goConstr :: VarDecl TyName name uni NameAnn -&gt; VarDecl TyName name uni NameAnn
</span><a href="#local-6989586621681124268"><span class="hs-identifier hs-var hs-var">goConstr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#VarDecl"><span class="hs-identifier hs-type">VarDecl</span></a></span><span> </span><span id="local-6989586621681124266"><span class="annot"><span class="annottext">NameAnn
</span><a href="#local-6989586621681124266"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621681124265"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681124265"><span class="hs-identifier hs-var">constrName</span></a></span></span><span> </span><span id="local-6989586621681124264"><span class="annot"><span class="annottext">Type TyName uni NameAnn
</span><a href="#local-6989586621681124264"><span class="hs-identifier hs-var">constrTy</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) ann.
ann -&gt; name -&gt; Type tyname uni ann -&gt; VarDecl tyname name uni ann
</span><a href="PlutusCore.Core.Type.html#VarDecl"><span class="hs-identifier hs-var">VarDecl</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><a href="#local-6989586621681124266"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681124265"><span class="hs-identifier hs-var">constrName</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni NameAnn -&gt; Type TyName uni NameAnn
</span><a href="#local-6989586621681124263"><span class="hs-identifier hs-var">goSpine</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni NameAnn
</span><a href="#local-6989586621681124264"><span class="hs-identifier hs-var">constrTy</span></a></span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span>            </span><span id="local-6989586621681124263"><span class="annot"><span class="annottext">goSpine :: Type TyName uni NameAnn -&gt; Type TyName uni NameAnn
</span><a href="#local-6989586621681124263"><span class="hs-identifier hs-var hs-var">goSpine</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#TyForall"><span class="hs-identifier hs-type">TyForall</span></a></span><span> </span><span id="local-6989586621681124261"><span class="annot"><span class="annottext">NameAnn
</span><a href="#local-6989586621681124261"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621681124260"><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681124260"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621681124259"><span class="annot"><span class="annottext">Kind NameAnn
</span><a href="#local-6989586621681124259"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span id="local-6989586621681124258"><span class="annot"><span class="annottext">Type TyName uni NameAnn
</span><a href="#local-6989586621681124258"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann.
ann
-&gt; tyname -&gt; Kind ann -&gt; Type tyname uni ann -&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyForall"><span class="hs-identifier hs-var">TyForall</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><a href="#local-6989586621681124261"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681124260"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Kind NameAnn
</span><a href="#local-6989586621681124259"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni NameAnn -&gt; Type TyName uni NameAnn
</span><a href="#local-6989586621681124263"><span class="hs-identifier hs-var">goSpine</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni NameAnn
</span><a href="#local-6989586621681124258"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-41"></span><span>            </span><span class="annot"><a href="#local-6989586621681124263"><span class="hs-identifier hs-var">goSpine</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#TyFun"><span class="hs-identifier hs-type">TyFun</span></a></span><span> </span><span id="local-6989586621681124256"><span class="annot"><span class="annottext">NameAnn
</span><a href="#local-6989586621681124256"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621681124255"><span class="annot"><span class="annottext">Type TyName uni NameAnn
</span><a href="#local-6989586621681124255"><span class="hs-identifier hs-var">dom</span></a></span></span><span> </span><span id="local-6989586621681124254"><span class="annot"><span class="annottext">Type TyName uni NameAnn
</span><a href="#local-6989586621681124254"><span class="hs-identifier hs-var">cod</span></a></span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann.
ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyFun"><span class="hs-identifier hs-var">TyFun</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><a href="#local-6989586621681124256"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni NameAnn
</span><a href="#local-6989586621681124255"><span class="hs-identifier hs-var">dom</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni NameAnn -&gt; Type TyName uni NameAnn
</span><a href="#local-6989586621681124263"><span class="hs-identifier hs-var">goSpine</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni NameAnn
</span><a href="#local-6989586621681124254"><span class="hs-identifier hs-var">cod</span></a></span><span>
</span><span id="line-42"></span><span>            </span><span class="annot"><a href="#local-6989586621681124263"><span class="hs-identifier hs-var">goSpine</span></a></span><span> </span><span id="local-6989586621681124253"><span class="annot"><span class="annottext">Type TyName uni NameAnn
</span><a href="#local-6989586621681124253"><span class="hs-identifier hs-var">ty</span></a></span></span><span>                          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann.
ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyFun"><span class="hs-identifier hs-var">TyFun</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><a href="PlutusCore.Check.Scoping.html#NotAName"><span class="hs-identifier hs-var">NotAName</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni NameAnn
</span><a href="#local-6989586621681124267"><span class="hs-identifier hs-var">tyVar</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni NameAnn -&gt; Type TyName uni NameAnn
</span><a href="#local-6989586621681124252"><span class="hs-identifier hs-var">goResult</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni NameAnn
</span><a href="#local-6989586621681124253"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span>            </span><span id="local-6989586621681124252"><span class="annot"><span class="annottext">goResult :: Type TyName uni NameAnn -&gt; Type TyName uni NameAnn
</span><a href="#local-6989586621681124252"><span class="hs-identifier hs-var hs-var">goResult</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#TyApp"><span class="hs-identifier hs-type">TyApp</span></a></span><span> </span><span id="local-6989586621681124250"><span class="annot"><span class="annottext">NameAnn
</span><a href="#local-6989586621681124250"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621681124249"><span class="annot"><span class="annottext">Type TyName uni NameAnn
</span><a href="#local-6989586621681124249"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621681124248"><span class="annot"><span class="annottext">Type TyName uni NameAnn
</span><a href="#local-6989586621681124248"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann.
ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyApp"><span class="hs-identifier hs-var">TyApp</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><a href="#local-6989586621681124250"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type TyName uni NameAnn -&gt; Type TyName uni NameAnn
</span><a href="#local-6989586621681124252"><span class="hs-identifier hs-var">goResult</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni NameAnn
</span><a href="#local-6989586621681124249"><span class="hs-identifier hs-var">fun</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type TyName uni NameAnn
</span><a href="#local-6989586621681124248"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-45"></span><span>            </span><span class="annot"><a href="#local-6989586621681124252"><span class="hs-identifier hs-var">goResult</span></a></span><span> </span><span id="local-6989586621681124247"><span class="annot"><span class="annottext">Type TyName uni NameAnn
</span><a href="#local-6989586621681124247"><span class="hs-identifier hs-var">ty</span></a></span></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann.
ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyApp"><span class="hs-identifier hs-var">TyApp</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><a href="PlutusCore.Check.Scoping.html#NotAName"><span class="hs-identifier hs-var">NotAName</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni NameAnn
</span><a href="#local-6989586621681124247"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni NameAnn
</span><a href="#local-6989586621681124267"><span class="hs-identifier hs-var">tyVar</span></a></span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681124564"><span id="local-6989586621681124565"><span id="local-6989586621681124566"><span id="local-6989586621681124567"><span class="annot"><a href="#local-6989586621681124567"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#Reference"><span class="hs-identifier hs-type">Reference</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124567"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124566"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124565"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124564"><span class="hs-identifier hs-type">fun</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-48"></span><span>    </span><span id="local-6989586621681124233"><span class="annot"><span class="annottext">referenceVia :: (forall name. ToScopedName name =&gt; name -&gt; NameAnn)
-&gt; TyName
-&gt; Binding tyname name uni fun NameAnn
-&gt; Binding tyname name uni fun NameAnn
</span><a href="#local-6989586621681124233"><span class="hs-identifier hs-var hs-var hs-var hs-var">referenceVia</span></a></span></span><span> </span><span id="local-6989586621681124232"><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681124232"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span id="local-6989586621681124231"><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681124231"><span class="hs-identifier hs-var">tyname</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#TermBind"><span class="hs-identifier hs-type">TermBind</span></a></span><span> </span><span id="local-6989586621681124229"><span class="annot"><span class="annottext">NameAnn
</span><a href="#local-6989586621681124229"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621681124228"><span class="annot"><span class="annottext">Strictness
</span><a href="#local-6989586621681124228"><span class="hs-identifier hs-var">strictness</span></a></span></span><span> </span><span id="local-6989586621681124227"><span class="annot"><span class="annottext">VarDecl tyname name uni NameAnn
</span><a href="#local-6989586621681124227"><span class="hs-identifier hs-var">varDecl</span></a></span></span><span> </span><span id="local-6989586621681124226"><span class="annot"><span class="annottext">Term tyname name uni fun NameAnn
</span><a href="#local-6989586621681124226"><span class="hs-identifier hs-var">term</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-49"></span><span>        </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a
-&gt; Strictness
-&gt; VarDecl tyname name uni a
-&gt; Term tyname name uni fun a
-&gt; Binding tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#TermBind"><span class="hs-identifier hs-var">TermBind</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><a href="#local-6989586621681124229"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Strictness
</span><a href="#local-6989586621681124228"><span class="hs-identifier hs-var">strictness</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall n (t :: * -&gt; *).
Reference n t =&gt;
(forall name. ToScopedName name =&gt; name -&gt; NameAnn)
-&gt; n -&gt; t NameAnn -&gt; t NameAnn
</span><a href="PlutusCore.Check.Scoping.html#referenceVia"><span class="hs-identifier hs-var">referenceVia</span></a></span><span> </span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681124232"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681124231"><span class="hs-identifier hs-var">tyname</span></a></span><span> </span><span class="annot"><span class="annottext">VarDecl tyname name uni NameAnn
</span><a href="#local-6989586621681124227"><span class="hs-identifier hs-var">varDecl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall n (t :: * -&gt; *).
Reference n t =&gt;
(forall name. ToScopedName name =&gt; name -&gt; NameAnn)
-&gt; n -&gt; t NameAnn -&gt; t NameAnn
</span><a href="PlutusCore.Check.Scoping.html#referenceVia"><span class="hs-identifier hs-var">referenceVia</span></a></span><span> </span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681124232"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681124231"><span class="hs-identifier hs-var">tyname</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun NameAnn
</span><a href="#local-6989586621681124226"><span class="hs-identifier hs-var">term</span></a></span><span>
</span><span id="line-50"></span><span>    </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#referenceVia"><span class="hs-identifier hs-var">referenceVia</span></a></span><span> </span><span id="local-6989586621681124221"><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681124221"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span id="local-6989586621681124220"><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681124220"><span class="hs-identifier hs-var">tyname</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#TypeBind"><span class="hs-identifier hs-type">TypeBind</span></a></span><span> </span><span id="local-6989586621681124218"><span class="annot"><span class="annottext">NameAnn
</span><a href="#local-6989586621681124218"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621681124217"><span class="annot"><span class="annottext">TyVarDecl tyname NameAnn
</span><a href="#local-6989586621681124217"><span class="hs-identifier hs-var">tyVarDecl</span></a></span></span><span> </span><span id="local-6989586621681124216"><span class="annot"><span class="annottext">Type tyname uni NameAnn
</span><a href="#local-6989586621681124216"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-51"></span><span>        </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a
-&gt; TyVarDecl tyname a
-&gt; Type tyname uni a
-&gt; Binding tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#TypeBind"><span class="hs-identifier hs-var">TypeBind</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><a href="#local-6989586621681124218"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarDecl tyname NameAnn
</span><a href="#local-6989586621681124217"><span class="hs-identifier hs-var">tyVarDecl</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall n (t :: * -&gt; *).
Reference n t =&gt;
(forall name. ToScopedName name =&gt; name -&gt; NameAnn)
-&gt; n -&gt; t NameAnn -&gt; t NameAnn
</span><a href="PlutusCore.Check.Scoping.html#referenceVia"><span class="hs-identifier hs-var">referenceVia</span></a></span><span> </span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681124221"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681124220"><span class="hs-identifier hs-var">tyname</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni NameAnn
</span><a href="#local-6989586621681124216"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-52"></span><span>    </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#referenceVia"><span class="hs-identifier hs-var">referenceVia</span></a></span><span> </span><span id="local-6989586621681124213"><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681124213"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span id="local-6989586621681124212"><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681124212"><span class="hs-identifier hs-var">tyname</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#DatatypeBind"><span class="hs-identifier hs-type">DatatypeBind</span></a></span><span> </span><span id="local-6989586621681124210"><span class="annot"><span class="annottext">NameAnn
</span><a href="#local-6989586621681124210"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621681124209"><span class="annot"><span class="annottext">Datatype tyname name uni NameAnn
</span><a href="#local-6989586621681124209"><span class="hs-identifier hs-var">datatype</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-53"></span><span>        </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a -&gt; Datatype tyname name uni a -&gt; Binding tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#DatatypeBind"><span class="hs-identifier hs-var">DatatypeBind</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><a href="#local-6989586621681124210"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall n (t :: * -&gt; *).
Reference n t =&gt;
(forall name. ToScopedName name =&gt; name -&gt; NameAnn)
-&gt; n -&gt; t NameAnn -&gt; t NameAnn
</span><a href="PlutusCore.Check.Scoping.html#referenceVia"><span class="hs-identifier hs-var">referenceVia</span></a></span><span> </span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681124213"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681124212"><span class="hs-identifier hs-var">tyname</span></a></span><span> </span><span class="annot"><span class="annottext">Datatype tyname name uni NameAnn
</span><a href="#local-6989586621681124209"><span class="hs-identifier hs-var">datatype</span></a></span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="hs-comment">-- | Unlike other 'Reference' instances this one does not guarantee that the name will actually be</span><span>
</span><span id="line-56"></span><span class="hs-comment">-- referenced, but it's too convenient to have this instance to give up on it, without it would be</span><span>
</span><span id="line-57"></span><span class="hs-comment">-- awkward to express \&quot;reference this binding in this thing\&quot;.</span><span>
</span><span id="line-58"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681124546"><span id="local-6989586621681124547"><span id="local-6989586621681124548"><span id="local-6989586621681124549"><span class="annot"><a href="#local-6989586621681124549"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#Reference"><span class="hs-identifier hs-type">Reference</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124548"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124549"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124547"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124546"><span class="hs-identifier hs-type">fun</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-59"></span><span>    </span><span id="local-6989586621681124199"><span class="annot"><span class="annottext">referenceVia :: (forall name. ToScopedName name =&gt; name -&gt; NameAnn)
-&gt; Name
-&gt; Binding tyname name uni fun NameAnn
-&gt; Binding tyname name uni fun NameAnn
</span><a href="#local-6989586621681124199"><span class="hs-identifier hs-var hs-var hs-var hs-var">referenceVia</span></a></span></span><span> </span><span id="local-6989586621681124198"><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681124198"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span id="local-6989586621681124197"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124197"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#TermBind"><span class="hs-identifier hs-type">TermBind</span></a></span><span> </span><span id="local-6989586621681124196"><span class="annot"><span class="annottext">NameAnn
</span><a href="#local-6989586621681124196"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621681124195"><span class="annot"><span class="annottext">Strictness
</span><a href="#local-6989586621681124195"><span class="hs-identifier hs-var">strictness</span></a></span></span><span> </span><span id="local-6989586621681124194"><span class="annot"><span class="annottext">VarDecl tyname name uni NameAnn
</span><a href="#local-6989586621681124194"><span class="hs-identifier hs-var">varDecl</span></a></span></span><span> </span><span id="local-6989586621681124193"><span class="annot"><span class="annottext">Term tyname name uni fun NameAnn
</span><a href="#local-6989586621681124193"><span class="hs-identifier hs-var">term</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-60"></span><span>        </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a
-&gt; Strictness
-&gt; VarDecl tyname name uni a
-&gt; Term tyname name uni fun a
-&gt; Binding tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#TermBind"><span class="hs-identifier hs-var">TermBind</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><a href="#local-6989586621681124196"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Strictness
</span><a href="#local-6989586621681124195"><span class="hs-identifier hs-var">strictness</span></a></span><span> </span><span class="annot"><span class="annottext">VarDecl tyname name uni NameAnn
</span><a href="#local-6989586621681124194"><span class="hs-identifier hs-var">varDecl</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall n (t :: * -&gt; *).
Reference n t =&gt;
(forall name. ToScopedName name =&gt; name -&gt; NameAnn)
-&gt; n -&gt; t NameAnn -&gt; t NameAnn
</span><a href="PlutusCore.Check.Scoping.html#referenceVia"><span class="hs-identifier hs-var">referenceVia</span></a></span><span> </span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681124198"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124197"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun NameAnn
</span><a href="#local-6989586621681124193"><span class="hs-identifier hs-var">term</span></a></span><span>
</span><span id="line-61"></span><span>    </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#referenceVia"><span class="hs-identifier hs-var">referenceVia</span></a></span><span> </span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681124190"><span class="annot"><span class="annottext">typeBind :: Binding tyname name uni fun NameAnn
</span><a href="#local-6989586621681124190"><span class="hs-identifier hs-var">typeBind</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="PlutusIR.Core.Type.html#TypeBind"><span class="hs-identifier hs-type">TypeBind</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Binding tyname name uni fun NameAnn
</span><a href="#local-6989586621681124190"><span class="hs-identifier hs-var">typeBind</span></a></span><span>
</span><span id="line-62"></span><span>    </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#referenceVia"><span class="hs-identifier hs-var">referenceVia</span></a></span><span> </span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681124189"><span class="annot"><span class="annottext">datatypeBind :: Binding tyname name uni fun NameAnn
</span><a href="#local-6989586621681124189"><span class="hs-identifier hs-var">datatypeBind</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="PlutusIR.Core.Type.html#DatatypeBind"><span class="hs-identifier hs-type">DatatypeBind</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Binding tyname name uni fun NameAnn
</span><a href="#local-6989586621681124189"><span class="hs-identifier hs-var">datatypeBind</span></a></span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681124539"><span id="local-6989586621681124540"><span id="local-6989586621681124541"><span class="annot"><a href="PlutusCore.Check.Scoping.html#Reference"><span class="hs-identifier hs-type">Reference</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124541"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124540"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#Reference"><span class="hs-identifier hs-type">Reference</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#TyVarDecl"><span class="hs-identifier hs-type">TyVarDecl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124541"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124539"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621681124540"><span class="hs-identifier hs-type">t</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-65"></span><span>    </span><span id="local-6989586621681124184"><span class="annot"><span class="annottext">referenceVia :: (forall name. ToScopedName name =&gt; name -&gt; NameAnn)
-&gt; TyVarDecl tyname ann -&gt; t NameAnn -&gt; t NameAnn
</span><a href="#local-6989586621681124184"><span class="hs-identifier hs-var hs-var hs-var hs-var">referenceVia</span></a></span></span><span> </span><span id="local-6989586621681124183"><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681124183"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall n (t :: * -&gt; *).
Reference n t =&gt;
(forall name. ToScopedName name =&gt; name -&gt; NameAnn)
-&gt; n -&gt; t NameAnn -&gt; t NameAnn
</span><a href="PlutusCore.Check.Scoping.html#referenceVia"><span class="hs-identifier hs-var">referenceVia</span></a></span><span> </span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681124183"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname ann. TyVarDecl tyname ann -&gt; tyname
</span><a href="PlutusCore.Core.Type.html#_tyVarDeclName"><span class="hs-identifier hs-var">_tyVarDeclName</span></a></span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681124523"><span id="local-6989586621681124524"><span id="local-6989586621681124525"><span id="local-6989586621681124526"><span id="local-6989586621681124527"><span class="annot"><a href="PlutusCore.Check.Scoping.html#Reference"><span class="hs-identifier hs-type">Reference</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124527"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124526"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#Reference"><span class="hs-identifier hs-type">Reference</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#VarDecl"><span class="hs-identifier hs-type">VarDecl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124525"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124527"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124524"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124523"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621681124526"><span class="hs-identifier hs-type">t</span></a></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-68"></span><span>    </span><span id="local-6989586621681124174"><span class="annot"><span class="annottext">referenceVia :: (forall name. ToScopedName name =&gt; name -&gt; NameAnn)
-&gt; VarDecl tyname name uni ann -&gt; t NameAnn -&gt; t NameAnn
</span><a href="#local-6989586621681124174"><span class="hs-identifier hs-var hs-var hs-var hs-var">referenceVia</span></a></span></span><span> </span><span id="local-6989586621681124173"><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681124173"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall n (t :: * -&gt; *).
Reference n t =&gt;
(forall name. ToScopedName name =&gt; name -&gt; NameAnn)
-&gt; n -&gt; t NameAnn -&gt; t NameAnn
</span><a href="PlutusCore.Check.Scoping.html#referenceVia"><span class="hs-identifier hs-var">referenceVia</span></a></span><span> </span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681124173"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) ann.
VarDecl tyname name uni ann -&gt; name
</span><a href="PlutusCore.Core.Type.html#_varDeclName"><span class="hs-identifier hs-var">_varDeclName</span></a></span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681124512"><span id="local-6989586621681124513"><span id="local-6989586621681124514"><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Check.Scoping.html#Reference"><span class="hs-identifier hs-type">Reference</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124514"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#Reference"><span class="hs-identifier hs-type">Reference</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124514"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#Reference"><span class="hs-identifier hs-type">Reference</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Datatype"><span class="hs-identifier hs-type">Datatype</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124513"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124512"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621681124514"><span class="hs-identifier hs-type">t</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-71"></span><span>    </span><span id="local-6989586621681124159"><span class="annot"><span class="annottext">referenceVia :: (forall name. ToScopedName name =&gt; name -&gt; NameAnn)
-&gt; Datatype TyName Name uni ann -&gt; t NameAnn -&gt; t NameAnn
</span><a href="#local-6989586621681124159"><span class="hs-identifier hs-var hs-var hs-var hs-var">referenceVia</span></a></span></span><span> </span><span id="local-6989586621681124158"><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681124158"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Datatype"><span class="hs-identifier hs-type">Datatype</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681124157"><span class="annot"><span class="annottext">TyVarDecl TyName ann
</span><a href="#local-6989586621681124157"><span class="hs-identifier hs-var">dataDecl</span></a></span></span><span> </span><span id="local-6989586621681124156"><span class="annot"><span class="annottext">[TyVarDecl TyName ann]
</span><a href="#local-6989586621681124156"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621681124155"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124155"><span class="hs-identifier hs-var">matchName</span></a></span></span><span> </span><span id="local-6989586621681124154"><span class="annot"><span class="annottext">[VarDecl TyName Name uni ann]
</span><a href="#local-6989586621681124154"><span class="hs-identifier hs-var">constrs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall n (t :: * -&gt; *).
Reference n t =&gt;
(forall name. ToScopedName name =&gt; name -&gt; NameAnn)
-&gt; n -&gt; t NameAnn -&gt; t NameAnn
</span><a href="PlutusCore.Check.Scoping.html#referenceVia"><span class="hs-identifier hs-var">referenceVia</span></a></span><span> </span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681124158"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarDecl TyName ann
</span><a href="#local-6989586621681124157"><span class="hs-identifier hs-var">dataDecl</span></a></span><span>
</span><span id="line-73"></span><span>        </span><span class="hs-comment">-- Parameters of a data type are not visible outside of the data type no matter what.</span><span>
</span><span id="line-74"></span><span>        </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall n (t :: * -&gt; *).
Reference n t =&gt;
n -&gt; t NameAnn -&gt; t NameAnn
</span><a href="PlutusCore.Check.Scoping.html#referenceOutOfScope"><span class="hs-identifier hs-var">referenceOutOfScope</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarDecl TyName ann]
</span><a href="#local-6989586621681124156"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-75"></span><span>        </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall n (t :: * -&gt; *).
Reference n t =&gt;
(forall name. ToScopedName name =&gt; name -&gt; NameAnn)
-&gt; n -&gt; t NameAnn -&gt; t NameAnn
</span><a href="PlutusCore.Check.Scoping.html#referenceVia"><span class="hs-identifier hs-var">referenceVia</span></a></span><span> </span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681124158"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124155"><span class="hs-identifier hs-var">matchName</span></a></span><span>
</span><span id="line-76"></span><span>        </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall n (t :: * -&gt; *).
Reference n t =&gt;
(forall name. ToScopedName name =&gt; name -&gt; NameAnn)
-&gt; n -&gt; t NameAnn -&gt; t NameAnn
</span><a href="PlutusCore.Check.Scoping.html#referenceVia"><span class="hs-identifier hs-var">referenceVia</span></a></span><span> </span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681124158"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">[VarDecl TyName Name uni ann]
</span><a href="#local-6989586621681124154"><span class="hs-identifier hs-var">constrs</span></a></span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681124497"><span id="local-6989586621681124498"><span id="local-6989586621681124499"><span id="local-6989586621681124500"><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Check.Scoping.html#Reference"><span class="hs-identifier hs-type">Reference</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124500"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#Reference"><span class="hs-identifier hs-type">Reference</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124500"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#Reference"><span class="hs-identifier hs-type">Reference</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124499"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124498"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124497"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621681124500"><span class="hs-identifier hs-type">t</span></a></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-79"></span><span>    </span><span id="local-6989586621681124139"><span class="annot"><span class="annottext">referenceVia :: (forall name. ToScopedName name =&gt; name -&gt; NameAnn)
-&gt; Binding TyName Name uni fun ann -&gt; t NameAnn -&gt; t NameAnn
</span><a href="#local-6989586621681124139"><span class="hs-identifier hs-var hs-var hs-var hs-var">referenceVia</span></a></span></span><span> </span><span id="local-6989586621681124138"><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681124138"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#TermBind"><span class="hs-identifier hs-type">TermBind</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Strictness
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681124137"><span class="annot"><span class="annottext">VarDecl TyName Name uni ann
</span><a href="#local-6989586621681124137"><span class="hs-identifier hs-var">varDecl</span></a></span></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall n (t :: * -&gt; *).
Reference n t =&gt;
(forall name. ToScopedName name =&gt; name -&gt; NameAnn)
-&gt; n -&gt; t NameAnn -&gt; t NameAnn
</span><a href="PlutusCore.Check.Scoping.html#referenceVia"><span class="hs-identifier hs-var">referenceVia</span></a></span><span> </span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681124138"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">VarDecl TyName Name uni ann
</span><a href="#local-6989586621681124137"><span class="hs-identifier hs-var">varDecl</span></a></span><span>
</span><span id="line-80"></span><span>    </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#referenceVia"><span class="hs-identifier hs-var">referenceVia</span></a></span><span> </span><span id="local-6989586621681124134"><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681124134"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#TypeBind"><span class="hs-identifier hs-type">TypeBind</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681124133"><span class="annot"><span class="annottext">TyVarDecl TyName ann
</span><a href="#local-6989586621681124133"><span class="hs-identifier hs-var">tyVarDecl</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall n (t :: * -&gt; *).
Reference n t =&gt;
(forall name. ToScopedName name =&gt; name -&gt; NameAnn)
-&gt; n -&gt; t NameAnn -&gt; t NameAnn
</span><a href="PlutusCore.Check.Scoping.html#referenceVia"><span class="hs-identifier hs-var">referenceVia</span></a></span><span> </span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681124134"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarDecl TyName ann
</span><a href="#local-6989586621681124133"><span class="hs-identifier hs-var">tyVarDecl</span></a></span><span>
</span><span id="line-81"></span><span>    </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#referenceVia"><span class="hs-identifier hs-var">referenceVia</span></a></span><span> </span><span id="local-6989586621681124130"><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681124130"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#DatatypeBind"><span class="hs-identifier hs-type">DatatypeBind</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681124129"><span class="annot"><span class="annottext">Datatype TyName Name uni ann
</span><a href="#local-6989586621681124129"><span class="hs-identifier hs-var">datatype</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall n (t :: * -&gt; *).
Reference n t =&gt;
(forall name. ToScopedName name =&gt; name -&gt; NameAnn)
-&gt; n -&gt; t NameAnn -&gt; t NameAnn
</span><a href="PlutusCore.Check.Scoping.html#referenceVia"><span class="hs-identifier hs-var">referenceVia</span></a></span><span> </span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681124130"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">Datatype TyName Name uni ann
</span><a href="#local-6989586621681124129"><span class="hs-identifier hs-var">datatype</span></a></span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="hs-comment">-- | Establish scoping for each of the parameters of a datatype by only annotating every parameter</span><span>
</span><span id="line-84"></span><span class="hs-comment">-- with 'introduceBound'.</span><span>
</span><span id="line-85"></span><span id="local-6989586621681124493"><span class="annot"><a href="PlutusIR.Core.Instance.Scoping.html#establishScopingParams"><span class="hs-identifier hs-type">establishScopingParams</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PlutusCore.Core.Type.html#TyVarDecl"><span class="hs-identifier hs-type">TyVarDecl</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124493"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Quote.html#Quote"><span class="hs-identifier hs-type">Quote</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PlutusCore.Core.Type.html#TyVarDecl"><span class="hs-identifier hs-type">TyVarDecl</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#NameAnn"><span class="hs-identifier hs-type">NameAnn</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-86"></span><span id="establishScopingParams"><span class="annot"><span class="annottext">establishScopingParams :: forall ann.
[TyVarDecl TyName ann] -&gt; Quote [TyVarDecl TyName NameAnn]
</span><a href="PlutusIR.Core.Instance.Scoping.html#establishScopingParams"><span class="hs-identifier hs-var hs-var">establishScopingParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-87"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#TyVarDecl"><span class="hs-identifier hs-type">TyVarDecl</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681124106"><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681124106"><span class="hs-identifier hs-var">paramNameDup</span></a></span></span><span> </span><span id="local-6989586621681124105"><span class="annot"><span class="annottext">Kind ann
</span><a href="#local-6989586621681124105"><span class="hs-identifier hs-var">paramKind</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-88"></span><span>        </span><span id="local-6989586621681124104"><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681124104"><span class="hs-identifier hs-var">paramName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadQuote m =&gt; TyName -&gt; m TyName
</span><a href="PlutusCore.Quote.html#freshenTyName"><span class="hs-identifier hs-var">freshenTyName</span></a></span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681124106"><span class="hs-identifier hs-var">paramNameDup</span></a></span><span>
</span><span id="line-89"></span><span>        </span><span class="annot"><span class="annottext">forall tyname ann.
ann -&gt; tyname -&gt; Kind ann -&gt; TyVarDecl tyname ann
</span><a href="PlutusCore.Core.Type.html#TyVarDecl"><span class="hs-identifier hs-var">TyVarDecl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="PlutusCore.Check.Scoping.html#introduceBound"><span class="hs-identifier hs-var">introduceBound</span></a></span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681124104"><span class="hs-identifier hs-var">paramName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681124104"><span class="hs-identifier hs-var">paramName</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) ann.
EstablishScoping t =&gt;
t ann -&gt; Quote (t NameAnn)
</span><a href="PlutusCore.Check.Scoping.html#establishScoping"><span class="hs-identifier hs-var">establishScoping</span></a></span><span> </span><span class="annot"><span class="annottext">Kind ann
</span><a href="#local-6989586621681124105"><span class="hs-identifier hs-var">paramKind</span></a></span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="hs-comment">-- See Note [Weird IR data types].</span><span>
</span><span id="line-92"></span><span class="hs-comment">{- | Establish scoping for the type of a constructor. The updated constructor expects an argument
of the \&quot;the data type applied to all its parameters\&quot; type (that argument is the last one) and
always returns that exact type as a result. For example, this functions turns the following
generated type of constructor

    integer -&gt; a -&gt; &lt;a_non_-&gt;_type&gt;

into

    integer -&gt; a -&gt; D a b -&gt; D a b

assuming the constructor is supposed to construct a data type @D@ parameterized by two parameters
@a@ and @b@. Note that @&lt;a_non_-&gt;_type&gt;@ can be anything as the generator is allowed to generate
mess such as a constructor not actually constructing a value of the data type.

Whether the name of the data type is referenced as in-scope or out-of-scope one in the types of
arguments of constructors is controlled by the first argument, which ultimately depends on the
recursivity of the data type.
-}</span><span>
</span><span id="line-111"></span><span id="local-6989586621681124469"><span id="local-6989586621681124470"><span class="annot"><a href="PlutusIR.Core.Instance.Scoping.html#establishScopingConstrTy"><span class="hs-identifier hs-type">establishScopingConstrTy</span></a></span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#NameAnn"><span class="hs-identifier hs-type">NameAnn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span>
</span><span id="line-114"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PlutusCore.Core.Type.html#TyVarDecl"><span class="hs-identifier hs-type">TyVarDecl</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#NameAnn"><span class="hs-identifier hs-type">NameAnn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-115"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124470"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124469"><span class="hs-identifier hs-type">ann</span></a></span><span>
</span><span id="line-116"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Quote.html#Quote"><span class="hs-identifier hs-type">Quote</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124470"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#NameAnn"><span class="hs-identifier hs-type">NameAnn</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-117"></span><span id="establishScopingConstrTy"><span class="annot"><span class="annottext">establishScopingConstrTy :: forall (uni :: * -&gt; *) ann.
(TyName -&gt; NameAnn)
-&gt; TyName
-&gt; [TyVarDecl TyName NameAnn]
-&gt; Type TyName uni ann
-&gt; Quote (Type TyName uni NameAnn)
</span><a href="PlutusIR.Core.Instance.Scoping.html#establishScopingConstrTy"><span class="hs-identifier hs-var hs-var">establishScopingConstrTy</span></a></span></span><span> </span><span id="local-6989586621681124080"><span class="annot"><span class="annottext">TyName -&gt; NameAnn
</span><a href="#local-6989586621681124080"><span class="hs-identifier hs-var">regSelf</span></a></span></span><span> </span><span id="local-6989586621681124079"><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681124079"><span class="hs-identifier hs-var">dataName</span></a></span></span><span> </span><span id="local-6989586621681124078"><span class="annot"><span class="annottext">[TyVarDecl TyName NameAnn]
</span><a href="#local-6989586621681124078"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann -&gt; QuoteT Identity (Type TyName uni NameAnn)
</span><a href="#local-6989586621681124077"><span class="hs-identifier hs-var">goSpine</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-118"></span><span>    </span><span id="local-6989586621681124076"><span class="annot"><span class="annottext">toDataAppliedToParams :: (TyName -&gt; NameAnn) -&gt; Type TyName uni NameAnn
</span><a href="#local-6989586621681124076"><span class="hs-identifier hs-var hs-var">toDataAppliedToParams</span></a></span></span><span> </span><span id="local-6989586621681124075"><span class="annot"><span class="annottext">TyName -&gt; NameAnn
</span><a href="#local-6989586621681124075"><span class="hs-identifier hs-var">reg</span></a></span></span><span>
</span><span id="line-119"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall ann tyname (uni :: * -&gt; *).
ann
-&gt; Type tyname uni ann
-&gt; [Type tyname uni ann]
-&gt; Type tyname uni ann
</span><a href="PlutusCore.MkPlc.html#mkIterTyApp"><span class="hs-identifier hs-var">mkIterTyApp</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><a href="PlutusCore.Check.Scoping.html#NotAName"><span class="hs-identifier hs-var">NotAName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann.
ann -&gt; tyname -&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyVar"><span class="hs-identifier hs-var">TyVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyName -&gt; NameAnn
</span><a href="#local-6989586621681124075"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681124079"><span class="hs-identifier hs-var">dataName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681124079"><span class="hs-identifier hs-var">dataName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span>        </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#TyVarDecl"><span class="hs-identifier hs-type">TyVarDecl</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681124073"><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681124073"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="annot"><span class="annottext">Kind NameAnn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann.
ann -&gt; tyname -&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyVar"><span class="hs-identifier hs-var">TyVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="PlutusCore.Check.Scoping.html#registerBound"><span class="hs-identifier hs-var">registerBound</span></a></span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681124073"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681124073"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TyVarDecl TyName NameAnn]
</span><a href="#local-6989586621681124078"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span>    </span><span id="local-6989586621681124077"><span class="annot"><span class="annottext">goSpine :: Type TyName uni ann -&gt; QuoteT Identity (Type TyName uni NameAnn)
</span><a href="#local-6989586621681124077"><span class="hs-identifier hs-var hs-var">goSpine</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#TyForall"><span class="hs-identifier hs-type">TyForall</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681124071"><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681124071"><span class="hs-identifier hs-var">nameDup</span></a></span></span><span> </span><span id="local-6989586621681124070"><span class="annot"><span class="annottext">Kind ann
</span><a href="#local-6989586621681124070"><span class="hs-identifier hs-var">kindDup</span></a></span></span><span> </span><span id="local-6989586621681124069"><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681124069"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-123"></span><span>        </span><span class="hs-comment">-- Similar to 'establishScopingBinder', but uses 'TyFun' rather than whatever 'registerVia'</span><span>
</span><span id="line-124"></span><span>        </span><span class="hs-comment">-- uses in order not to break the invariants described in Note [Weird IR data types].</span><span>
</span><span id="line-125"></span><span>        </span><span class="hs-comment">-- Also calls 'goSpine' recursively rather than 'establishScoping'.</span><span>
</span><span id="line-126"></span><span>        </span><span id="local-6989586621681124068"><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681124068"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadQuote m =&gt; TyName -&gt; m TyName
</span><a href="PlutusCore.Quote.html#freshenTyName"><span class="hs-identifier hs-var">freshenTyName</span></a></span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681124071"><span class="hs-identifier hs-var">nameDup</span></a></span><span>
</span><span id="line-127"></span><span>        </span><span id="local-6989586621681124067"><span class="annot"><span class="annottext">Kind NameAnn
</span><a href="#local-6989586621681124067"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) ann.
EstablishScoping t =&gt;
t ann -&gt; Quote (t NameAnn)
</span><a href="PlutusCore.Check.Scoping.html#establishScoping"><span class="hs-identifier hs-var">establishScoping</span></a></span><span> </span><span class="annot"><span class="annottext">Kind ann
</span><a href="#local-6989586621681124070"><span class="hs-identifier hs-var">kindDup</span></a></span><span>
</span><span id="line-128"></span><span>        </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann.
ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyFun"><span class="hs-identifier hs-var">TyFun</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><a href="PlutusCore.Check.Scoping.html#NotAName"><span class="hs-identifier hs-var">NotAName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann.
ann -&gt; tyname -&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyVar"><span class="hs-identifier hs-var">TyVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="PlutusCore.Check.Scoping.html#registerOutOfScope"><span class="hs-identifier hs-var">registerOutOfScope</span></a></span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681124068"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681124068"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span>
</span><span id="line-129"></span><span>            </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann.
ann
-&gt; tyname -&gt; Kind ann -&gt; Type tyname uni ann -&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyForall"><span class="hs-identifier hs-var">TyForall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="PlutusCore.Check.Scoping.html#introduceBound"><span class="hs-identifier hs-var">introduceBound</span></a></span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681124068"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681124068"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Kind NameAnn
</span><a href="#local-6989586621681124067"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span>
</span><span id="line-130"></span><span>                </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann.
ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyFun"><span class="hs-identifier hs-var">TyFun</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><a href="PlutusCore.Check.Scoping.html#NotAName"><span class="hs-identifier hs-var">NotAName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann.
ann -&gt; tyname -&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyVar"><span class="hs-identifier hs-var">TyVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="PlutusCore.Check.Scoping.html#registerBound"><span class="hs-identifier hs-var">registerBound</span></a></span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681124068"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681124068"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-131"></span><span>                    </span><span class="annot"><span class="annottext">Type TyName uni ann -&gt; QuoteT Identity (Type TyName uni NameAnn)
</span><a href="#local-6989586621681124077"><span class="hs-identifier hs-var">goSpine</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681124069"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-132"></span><span>    </span><span class="annot"><a href="#local-6989586621681124077"><span class="hs-identifier hs-var">goSpine</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#TyFun"><span class="hs-identifier hs-type">TyFun</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681124065"><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681124065"><span class="hs-identifier hs-var">dom</span></a></span></span><span> </span><span id="local-6989586621681124064"><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681124064"><span class="hs-identifier hs-var">cod</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann.
ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyFun"><span class="hs-identifier hs-var">TyFun</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><a href="PlutusCore.Check.Scoping.html#NotAName"><span class="hs-identifier hs-var">NotAName</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) ann.
EstablishScoping t =&gt;
t ann -&gt; Quote (t NameAnn)
</span><a href="PlutusCore.Check.Scoping.html#establishScoping"><span class="hs-identifier hs-var">establishScoping</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681124065"><span class="hs-identifier hs-var">dom</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann -&gt; QuoteT Identity (Type TyName uni NameAnn)
</span><a href="#local-6989586621681124077"><span class="hs-identifier hs-var">goSpine</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681124064"><span class="hs-identifier hs-var">cod</span></a></span><span>
</span><span id="line-133"></span><span>    </span><span class="annot"><a href="#local-6989586621681124077"><span class="hs-identifier hs-var">goSpine</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><span class="hs-identifier">_</span></span><span>                 </span><span class="hs-glyph">=</span><span>
</span><span id="line-134"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann.
ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyFun"><span class="hs-identifier hs-var">TyFun</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><a href="PlutusCore.Check.Scoping.html#NotAName"><span class="hs-identifier hs-var">NotAName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TyName -&gt; NameAnn) -&gt; Type TyName uni NameAnn
</span><a href="#local-6989586621681124076"><span class="hs-identifier hs-var">toDataAppliedToParams</span></a></span><span> </span><span class="annot"><span class="annottext">TyName -&gt; NameAnn
</span><a href="#local-6989586621681124080"><span class="hs-identifier hs-var">regSelf</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(TyName -&gt; NameAnn) -&gt; Type TyName uni NameAnn
</span><a href="#local-6989586621681124076"><span class="hs-identifier hs-var">toDataAppliedToParams</span></a></span><span> </span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="PlutusCore.Check.Scoping.html#registerBound"><span class="hs-identifier hs-var">registerBound</span></a></span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span class="hs-comment">-- | Establish scoping for all constructors of a data type by establishing scoping for each of them</span><span>
</span><span id="line-137"></span><span class="hs-comment">-- individually. If there are no constructors, then a dummy one is added, because we need to</span><span>
</span><span id="line-138"></span><span class="hs-comment">-- maintain the invariant that every binding is referenced as an in-scope one somewhere and the only</span><span>
</span><span id="line-139"></span><span class="hs-comment">-- place where parameters of a data type can be referenced this way is a constructor of that data</span><span>
</span><span id="line-140"></span><span class="hs-comment">-- type.</span><span>
</span><span id="line-141"></span><span id="local-6989586621681124456"><span id="local-6989586621681124457"><span class="annot"><a href="PlutusIR.Core.Instance.Scoping.html#establishScopingConstrs"><span class="hs-identifier hs-type">establishScopingConstrs</span></a></span><span>
</span><span id="line-142"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#NameAnn"><span class="hs-identifier hs-type">NameAnn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681124457"><span class="hs-identifier hs-type">ann</span></a></span><span>
</span><span id="line-144"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span>
</span><span id="line-145"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PlutusCore.Core.Type.html#TyVarDecl"><span class="hs-identifier hs-type">TyVarDecl</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#NameAnn"><span class="hs-identifier hs-type">NameAnn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-146"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PlutusCore.Core.Type.html#VarDecl"><span class="hs-identifier hs-type">VarDecl</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124456"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124457"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-147"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Quote.html#Quote"><span class="hs-identifier hs-type">Quote</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PlutusCore.Core.Type.html#VarDecl"><span class="hs-identifier hs-type">VarDecl</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124456"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#NameAnn"><span class="hs-identifier hs-type">NameAnn</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-148"></span><span id="establishScopingConstrs"><span class="annot"><span class="annottext">establishScopingConstrs :: forall ann (uni :: * -&gt; *).
(TyName -&gt; NameAnn)
-&gt; ann
-&gt; TyName
-&gt; [TyVarDecl TyName NameAnn]
-&gt; [VarDecl TyName Name uni ann]
-&gt; Quote [VarDecl TyName Name uni NameAnn]
</span><a href="PlutusIR.Core.Instance.Scoping.html#establishScopingConstrs"><span class="hs-identifier hs-var hs-var">establishScopingConstrs</span></a></span></span><span> </span><span id="local-6989586621681124048"><span class="annot"><span class="annottext">TyName -&gt; NameAnn
</span><a href="#local-6989586621681124048"><span class="hs-identifier hs-var">regSelf</span></a></span></span><span> </span><span id="local-6989586621681124047"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681124047"><span class="hs-identifier hs-var">dataAnn</span></a></span></span><span> </span><span id="local-6989586621681124046"><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681124046"><span class="hs-identifier hs-var">dataName</span></a></span></span><span> </span><span id="local-6989586621681124045"><span class="annot"><span class="annottext">[TyVarDecl TyName NameAnn]
</span><a href="#local-6989586621681124045"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621681124044"><span class="annot"><span class="annottext">[VarDecl TyName Name uni ann]
</span><a href="#local-6989586621681124044"><span class="hs-identifier hs-var">constrsPossiblyEmpty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-149"></span><span>    </span><span id="local-6989586621681124043"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124043"><span class="hs-identifier hs-var">cons0Name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadQuote m =&gt; Text -&gt; m Name
</span><a href="PlutusCore.Quote.html#freshName"><span class="hs-identifier hs-var">freshName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;cons0&quot;</span></span><span>
</span><span id="line-150"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681124041"><span class="annot"><span class="annottext">cons0 :: VarDecl TyName Name uni ann
</span><a href="#local-6989586621681124041"><span class="hs-identifier hs-var hs-var">cons0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) ann.
ann -&gt; name -&gt; Type tyname uni ann -&gt; VarDecl tyname name uni ann
</span><a href="PlutusCore.Core.Type.html#VarDecl"><span class="hs-identifier hs-var">VarDecl</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681124047"><span class="hs-identifier hs-var">dataAnn</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124043"><span class="hs-identifier hs-var">cons0Name</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann.
ann -&gt; tyname -&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyVar"><span class="hs-identifier hs-var">TyVar</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681124047"><span class="hs-identifier hs-var">dataAnn</span></a></span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681124046"><span class="hs-identifier hs-var">dataName</span></a></span><span>
</span><span id="line-151"></span><span>        </span><span id="local-6989586621681124040"><span class="annot"><span class="annottext">constrs :: [VarDecl TyName Name uni ann]
</span><a href="#local-6989586621681124040"><span class="hs-identifier hs-var hs-var">constrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[VarDecl TyName Name uni ann]
</span><a href="#local-6989586621681124044"><span class="hs-identifier hs-var">constrsPossiblyEmpty</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">VarDecl TyName Name uni ann
</span><a href="#local-6989586621681124041"><span class="hs-identifier hs-var">cons0</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[VarDecl TyName Name uni ann]
</span><a href="#local-6989586621681124044"><span class="hs-identifier hs-var">constrsPossiblyEmpty</span></a></span><span>
</span><span id="line-152"></span><span>    </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">for</span></a></span><span> </span><span class="annot"><span class="annottext">[VarDecl TyName Name uni ann]
</span><a href="#local-6989586621681124040"><span class="hs-identifier hs-var">constrs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#VarDecl"><span class="hs-identifier hs-type">VarDecl</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681124037"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124037"><span class="hs-identifier hs-var">constrNameDup</span></a></span></span><span> </span><span id="local-6989586621681124036"><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681124036"><span class="hs-identifier hs-var">constrTyDup</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-153"></span><span>        </span><span id="local-6989586621681124035"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124035"><span class="hs-identifier hs-var">constrName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadQuote m =&gt; Name -&gt; m Name
</span><a href="PlutusCore.Quote.html#freshenName"><span class="hs-identifier hs-var">freshenName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124037"><span class="hs-identifier hs-var">constrNameDup</span></a></span><span>
</span><span id="line-154"></span><span>        </span><span id="local-6989586621681124033"><span class="annot"><span class="annottext">Type TyName uni NameAnn
</span><a href="#local-6989586621681124033"><span class="hs-identifier hs-var">constrTy</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) ann.
(TyName -&gt; NameAnn)
-&gt; TyName
-&gt; [TyVarDecl TyName NameAnn]
-&gt; Type TyName uni ann
-&gt; Quote (Type TyName uni NameAnn)
</span><a href="PlutusIR.Core.Instance.Scoping.html#establishScopingConstrTy"><span class="hs-identifier hs-var">establishScopingConstrTy</span></a></span><span> </span><span class="annot"><span class="annottext">TyName -&gt; NameAnn
</span><a href="#local-6989586621681124048"><span class="hs-identifier hs-var">regSelf</span></a></span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681124046"><span class="hs-identifier hs-var">dataName</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarDecl TyName NameAnn]
</span><a href="#local-6989586621681124045"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681124036"><span class="hs-identifier hs-var">constrTyDup</span></a></span><span>
</span><span id="line-155"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) ann.
ann -&gt; name -&gt; Type tyname uni ann -&gt; VarDecl tyname name uni ann
</span><a href="PlutusCore.Core.Type.html#VarDecl"><span class="hs-identifier hs-var">VarDecl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="PlutusCore.Check.Scoping.html#introduceBound"><span class="hs-identifier hs-var">introduceBound</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124035"><span class="hs-identifier hs-var">constrName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124035"><span class="hs-identifier hs-var">constrName</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni NameAnn
</span><a href="#local-6989586621681124033"><span class="hs-identifier hs-var">constrTy</span></a></span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="hs-comment">-- | Establish scoping of a binding. Each bindings gets referenced in its own body either as an</span><span>
</span><span id="line-158"></span><span class="hs-comment">-- in-scope or out-of-scope one, which is controlled by the first argument and ultimately depends on</span><span>
</span><span id="line-159"></span><span class="hs-comment">-- the recursivity of the binding.</span><span>
</span><span id="line-160"></span><span id="local-6989586621681124442"><span id="local-6989586621681124443"><span id="local-6989586621681124444"><span class="annot"><a href="PlutusIR.Core.Instance.Scoping.html#establishScopingBinding"><span class="hs-identifier hs-type">establishScopingBinding</span></a></span><span>
</span><span id="line-161"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681124031"><span class="annot"><a href="#local-6989586621681124031"><span class="hs-identifier hs-type">name</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#ToScopedName"><span class="hs-identifier hs-type">ToScopedName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124031"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681124031"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#NameAnn"><span class="hs-identifier hs-type">NameAnn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124444"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124443"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124442"><span class="hs-identifier hs-type">ann</span></a></span><span>
</span><span id="line-163"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Quote.html#Quote"><span class="hs-identifier hs-type">Quote</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124444"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124443"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#NameAnn"><span class="hs-identifier hs-type">NameAnn</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-164"></span><span id="establishScopingBinding"><span class="annot"><span class="annottext">establishScopingBinding :: forall (uni :: * -&gt; *) fun ann.
(forall name. ToScopedName name =&gt; name -&gt; NameAnn)
-&gt; Binding TyName Name uni fun ann
-&gt; Quote (Binding TyName Name uni fun NameAnn)
</span><a href="PlutusIR.Core.Instance.Scoping.html#establishScopingBinding"><span class="hs-identifier hs-var hs-var">establishScopingBinding</span></a></span></span><span> </span><span id="local-6989586621681123991"><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681123991"><span class="hs-identifier hs-var">regSelf</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#TermBind"><span class="hs-identifier hs-type">TermBind</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681123990"><span class="annot"><span class="annottext">Strictness
</span><a href="#local-6989586621681123990"><span class="hs-identifier hs-var">strictness</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#VarDecl"><span class="hs-identifier hs-type">VarDecl</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681123989"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681123989"><span class="hs-identifier hs-var">nameDup</span></a></span></span><span> </span><span id="local-6989586621681123988"><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681123988"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681123987"><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621681123987"><span class="hs-identifier hs-var">term</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-165"></span><span>    </span><span id="local-6989586621681123986"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681123986"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadQuote m =&gt; Name -&gt; m Name
</span><a href="PlutusCore.Quote.html#freshenName"><span class="hs-identifier hs-var">freshenName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681123989"><span class="hs-identifier hs-var">nameDup</span></a></span><span>
</span><span id="line-166"></span><span>    </span><span id="local-6989586621681123985"><span class="annot"><span class="annottext">VarDecl TyName Name uni NameAnn
</span><a href="#local-6989586621681123985"><span class="hs-identifier hs-var">varDecl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) ann.
ann -&gt; name -&gt; Type tyname uni ann -&gt; VarDecl tyname name uni ann
</span><a href="PlutusCore.Core.Type.html#VarDecl"><span class="hs-identifier hs-var">VarDecl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="PlutusCore.Check.Scoping.html#introduceBound"><span class="hs-identifier hs-var">introduceBound</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681123986"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681123986"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) ann.
EstablishScoping t =&gt;
t ann -&gt; Quote (t NameAnn)
</span><a href="PlutusCore.Check.Scoping.html#establishScoping"><span class="hs-identifier hs-var">establishScoping</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681123988"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-167"></span><span>    </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a
-&gt; Strictness
-&gt; VarDecl tyname name uni a
-&gt; Term tyname name uni fun a
-&gt; Binding tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#TermBind"><span class="hs-identifier hs-var">TermBind</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><a href="PlutusCore.Check.Scoping.html#NotAName"><span class="hs-identifier hs-var">NotAName</span></a></span><span> </span><span class="annot"><span class="annottext">Strictness
</span><a href="#local-6989586621681123990"><span class="hs-identifier hs-var">strictness</span></a></span><span> </span><span class="annot"><span class="annottext">VarDecl TyName Name uni NameAnn
</span><a href="#local-6989586621681123985"><span class="hs-identifier hs-var">varDecl</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall n (t :: * -&gt; *).
Reference n t =&gt;
(forall name. ToScopedName name =&gt; name -&gt; NameAnn)
-&gt; n -&gt; t NameAnn -&gt; t NameAnn
</span><a href="PlutusCore.Check.Scoping.html#referenceVia"><span class="hs-identifier hs-var">referenceVia</span></a></span><span> </span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681123991"><span class="hs-identifier hs-var">regSelf</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681123986"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) ann.
EstablishScoping t =&gt;
t ann -&gt; Quote (t NameAnn)
</span><a href="PlutusCore.Check.Scoping.html#establishScoping"><span class="hs-identifier hs-var">establishScoping</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621681123987"><span class="hs-identifier hs-var">term</span></a></span><span>
</span><span id="line-168"></span><span class="annot"><a href="PlutusIR.Core.Instance.Scoping.html#establishScopingBinding"><span class="hs-identifier hs-var">establishScopingBinding</span></a></span><span> </span><span id="local-6989586621681123982"><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681123982"><span class="hs-identifier hs-var">regSelf</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#TypeBind"><span class="hs-identifier hs-type">TypeBind</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#TyVarDecl"><span class="hs-identifier hs-type">TyVarDecl</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681123981"><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681123981"><span class="hs-identifier hs-var">nameDup</span></a></span></span><span> </span><span id="local-6989586621681123980"><span class="annot"><span class="annottext">Kind ann
</span><a href="#local-6989586621681123980"><span class="hs-identifier hs-var">kind</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681123979"><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681123979"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-169"></span><span>    </span><span id="local-6989586621681123978"><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681123978"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadQuote m =&gt; TyName -&gt; m TyName
</span><a href="PlutusCore.Quote.html#freshenTyName"><span class="hs-identifier hs-var">freshenTyName</span></a></span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681123981"><span class="hs-identifier hs-var">nameDup</span></a></span><span>
</span><span id="line-170"></span><span>    </span><span id="local-6989586621681123977"><span class="annot"><span class="annottext">TyVarDecl TyName NameAnn
</span><a href="#local-6989586621681123977"><span class="hs-identifier hs-var">tyVarDecl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall tyname ann.
ann -&gt; tyname -&gt; Kind ann -&gt; TyVarDecl tyname ann
</span><a href="PlutusCore.Core.Type.html#TyVarDecl"><span class="hs-identifier hs-var">TyVarDecl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="PlutusCore.Check.Scoping.html#introduceBound"><span class="hs-identifier hs-var">introduceBound</span></a></span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681123978"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681123978"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) ann.
EstablishScoping t =&gt;
t ann -&gt; Quote (t NameAnn)
</span><a href="PlutusCore.Check.Scoping.html#establishScoping"><span class="hs-identifier hs-var">establishScoping</span></a></span><span> </span><span class="annot"><span class="annottext">Kind ann
</span><a href="#local-6989586621681123980"><span class="hs-identifier hs-var">kind</span></a></span><span>
</span><span id="line-171"></span><span>    </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a
-&gt; TyVarDecl tyname a
-&gt; Type tyname uni a
-&gt; Binding tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#TypeBind"><span class="hs-identifier hs-var">TypeBind</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><a href="PlutusCore.Check.Scoping.html#NotAName"><span class="hs-identifier hs-var">NotAName</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarDecl TyName NameAnn
</span><a href="#local-6989586621681123977"><span class="hs-identifier hs-var">tyVarDecl</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall n (t :: * -&gt; *).
Reference n t =&gt;
(forall name. ToScopedName name =&gt; name -&gt; NameAnn)
-&gt; n -&gt; t NameAnn -&gt; t NameAnn
</span><a href="PlutusCore.Check.Scoping.html#referenceVia"><span class="hs-identifier hs-var">referenceVia</span></a></span><span> </span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681123982"><span class="hs-identifier hs-var">regSelf</span></a></span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681123978"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) ann.
EstablishScoping t =&gt;
t ann -&gt; Quote (t NameAnn)
</span><a href="PlutusCore.Check.Scoping.html#establishScoping"><span class="hs-identifier hs-var">establishScoping</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621681123979"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-172"></span><span class="annot"><a href="PlutusIR.Core.Instance.Scoping.html#establishScopingBinding"><span class="hs-identifier hs-var">establishScopingBinding</span></a></span><span> </span><span id="local-6989586621681123974"><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681123974"><span class="hs-identifier hs-var">regSelf</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#DatatypeBind"><span class="hs-identifier hs-type">DatatypeBind</span></a></span><span> </span><span id="local-6989586621681123973"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681123973"><span class="hs-identifier hs-var">dataAnn</span></a></span></span><span> </span><span id="local-6989586621681123972"><span class="annot"><span class="annottext">Datatype TyName Name uni ann
</span><a href="#local-6989586621681123972"><span class="hs-identifier hs-var">datatypeDup</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-173"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Datatype"><span class="hs-identifier hs-type">Datatype</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681123971"><span class="annot"><span class="annottext">TyVarDecl TyName ann
</span><a href="#local-6989586621681123971"><span class="hs-identifier hs-var">dataDeclDup</span></a></span></span><span> </span><span id="local-6989586621681123970"><span class="annot"><span class="annottext">[TyVarDecl TyName ann]
</span><a href="#local-6989586621681123970"><span class="hs-identifier hs-var">paramsDup</span></a></span></span><span> </span><span id="local-6989586621681123969"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681123969"><span class="hs-identifier hs-var">matchNameDup</span></a></span></span><span> </span><span id="local-6989586621681123968"><span class="annot"><span class="annottext">[VarDecl TyName Name uni ann]
</span><a href="#local-6989586621681123968"><span class="hs-identifier hs-var">constrsDup</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Datatype TyName Name uni ann
</span><a href="#local-6989586621681123972"><span class="hs-identifier hs-var">datatypeDup</span></a></span><span>
</span><span id="line-174"></span><span>        </span><span class="annot"><a href="PlutusCore.Core.Type.html#TyVarDecl"><span class="hs-identifier hs-type">TyVarDecl</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681123967"><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681123967"><span class="hs-identifier hs-var">dataNameDup</span></a></span></span><span> </span><span id="local-6989586621681123966"><span class="annot"><span class="annottext">Kind ann
</span><a href="#local-6989586621681123966"><span class="hs-identifier hs-var">dataKind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyVarDecl TyName ann
</span><a href="#local-6989586621681123971"><span class="hs-identifier hs-var">dataDeclDup</span></a></span><span>
</span><span id="line-175"></span><span>    </span><span id="local-6989586621681123965"><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681123965"><span class="hs-identifier hs-var">dataName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadQuote m =&gt; TyName -&gt; m TyName
</span><a href="PlutusCore.Quote.html#freshenTyName"><span class="hs-identifier hs-var">freshenTyName</span></a></span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681123967"><span class="hs-identifier hs-var">dataNameDup</span></a></span><span>
</span><span id="line-176"></span><span>    </span><span id="local-6989586621681123964"><span class="annot"><span class="annottext">TyVarDecl TyName NameAnn
</span><a href="#local-6989586621681123964"><span class="hs-identifier hs-var">dataDecl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall tyname ann.
ann -&gt; tyname -&gt; Kind ann -&gt; TyVarDecl tyname ann
</span><a href="PlutusCore.Core.Type.html#TyVarDecl"><span class="hs-identifier hs-var">TyVarDecl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="PlutusCore.Check.Scoping.html#introduceBound"><span class="hs-identifier hs-var">introduceBound</span></a></span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681123965"><span class="hs-identifier hs-var">dataName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681123965"><span class="hs-identifier hs-var">dataName</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) ann.
EstablishScoping t =&gt;
t ann -&gt; Quote (t NameAnn)
</span><a href="PlutusCore.Check.Scoping.html#establishScoping"><span class="hs-identifier hs-var">establishScoping</span></a></span><span> </span><span class="annot"><span class="annottext">Kind ann
</span><a href="#local-6989586621681123966"><span class="hs-identifier hs-var">dataKind</span></a></span><span>
</span><span id="line-177"></span><span>    </span><span id="local-6989586621681123963"><span class="annot"><span class="annottext">[TyVarDecl TyName NameAnn]
</span><a href="#local-6989586621681123963"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall ann.
[TyVarDecl TyName ann] -&gt; Quote [TyVarDecl TyName NameAnn]
</span><a href="PlutusIR.Core.Instance.Scoping.html#establishScopingParams"><span class="hs-identifier hs-var">establishScopingParams</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarDecl TyName ann]
</span><a href="#local-6989586621681123970"><span class="hs-identifier hs-var">paramsDup</span></a></span><span>
</span><span id="line-178"></span><span>    </span><span id="local-6989586621681123962"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681123962"><span class="hs-identifier hs-var">matchName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadQuote m =&gt; Name -&gt; m Name
</span><a href="PlutusCore.Quote.html#freshenName"><span class="hs-identifier hs-var">freshenName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681123969"><span class="hs-identifier hs-var">matchNameDup</span></a></span><span>
</span><span id="line-179"></span><span>    </span><span id="local-6989586621681123961"><span class="annot"><span class="annottext">[VarDecl TyName Name uni NameAnn]
</span><a href="#local-6989586621681123961"><span class="hs-identifier hs-var">constrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall ann (uni :: * -&gt; *).
(TyName -&gt; NameAnn)
-&gt; ann
-&gt; TyName
-&gt; [TyVarDecl TyName NameAnn]
-&gt; [VarDecl TyName Name uni ann]
-&gt; Quote [VarDecl TyName Name uni NameAnn]
</span><a href="PlutusIR.Core.Instance.Scoping.html#establishScopingConstrs"><span class="hs-identifier hs-var">establishScopingConstrs</span></a></span><span> </span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681123974"><span class="hs-identifier hs-var">regSelf</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621681123973"><span class="hs-identifier hs-var">dataAnn</span></a></span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681123965"><span class="hs-identifier hs-var">dataName</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarDecl TyName NameAnn]
</span><a href="#local-6989586621681123963"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">[VarDecl TyName Name uni ann]
</span><a href="#local-6989586621681123968"><span class="hs-identifier hs-var">constrsDup</span></a></span><span>
</span><span id="line-180"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681123960"><span class="annot"><span class="annottext">datatype :: Datatype TyName Name uni NameAnn
</span><a href="#local-6989586621681123960"><span class="hs-identifier hs-var hs-var">datatype</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) a.
a
-&gt; TyVarDecl tyname a
-&gt; [TyVarDecl tyname a]
-&gt; name
-&gt; [VarDecl tyname name uni a]
-&gt; Datatype tyname name uni a
</span><a href="PlutusIR.Core.Type.html#Datatype"><span class="hs-identifier hs-var">Datatype</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="PlutusCore.Check.Scoping.html#introduceBound"><span class="hs-identifier hs-var">introduceBound</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681123962"><span class="hs-identifier hs-var">matchName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyVarDecl TyName NameAnn
</span><a href="#local-6989586621681123964"><span class="hs-identifier hs-var">dataDecl</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarDecl TyName NameAnn]
</span><a href="#local-6989586621681123963"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681123962"><span class="hs-identifier hs-var">matchName</span></a></span><span> </span><span class="annot"><span class="annottext">[VarDecl TyName Name uni NameAnn]
</span><a href="#local-6989586621681123961"><span class="hs-identifier hs-var">constrs</span></a></span><span>
</span><span id="line-181"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a -&gt; Datatype tyname name uni a -&gt; Binding tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#DatatypeBind"><span class="hs-identifier hs-var">DatatypeBind</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><a href="PlutusCore.Check.Scoping.html#NotAName"><span class="hs-identifier hs-var">NotAName</span></a></span><span> </span><span class="annot"><span class="annottext">Datatype TyName Name uni NameAnn
</span><a href="#local-6989586621681123960"><span class="hs-identifier hs-var">datatype</span></a></span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span class="hs-comment">-- | Reference each binding in the last one apart from itself.</span><span>
</span><span id="line-184"></span><span id="local-6989586621681124431"><span id="local-6989586621681124432"><span class="annot"><a href="PlutusIR.Core.Instance.Scoping.html#referenceViaBindings"><span class="hs-identifier hs-type">referenceViaBindings</span></a></span><span>
</span><span id="line-185"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681123958"><span class="annot"><a href="#local-6989586621681123958"><span class="hs-identifier hs-type">name</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#ToScopedName"><span class="hs-identifier hs-type">ToScopedName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681123958"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681123958"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#NameAnn"><span class="hs-identifier hs-type">NameAnn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124432"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124431"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#NameAnn"><span class="hs-identifier hs-type">NameAnn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124432"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124431"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#NameAnn"><span class="hs-identifier hs-type">NameAnn</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-188"></span><span id="referenceViaBindings"><span class="annot"><span class="annottext">referenceViaBindings :: forall (uni :: * -&gt; *) fun.
(forall name. ToScopedName name =&gt; name -&gt; NameAnn)
-&gt; NonEmpty (Binding TyName Name uni fun NameAnn)
-&gt; NonEmpty (Binding TyName Name uni fun NameAnn)
</span><a href="PlutusIR.Core.Instance.Scoping.html#referenceViaBindings"><span class="hs-identifier hs-var hs-var">referenceViaBindings</span></a></span></span><span> </span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-special">(</span><span id="local-6989586621681123951"><span class="annot"><span class="annottext">Binding TyName Name uni fun NameAnn
</span><a href="#local-6989586621681123951"><span class="hs-identifier hs-var">b0</span></a></span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-type">:|</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Binding TyName Name uni fun NameAnn
</span><a href="#local-6989586621681123951"><span class="hs-identifier hs-var">b0</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; NonEmpty a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">:|</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-189"></span><span class="annot"><a href="PlutusIR.Core.Instance.Scoping.html#referenceViaBindings"><span class="hs-identifier hs-var">referenceViaBindings</span></a></span><span> </span><span id="local-6989586621681123950"><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681123950"><span class="hs-identifier hs-var">reg</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681123949"><span class="annot"><span class="annottext">Binding TyName Name uni fun NameAnn
</span><a href="#local-6989586621681123949"><span class="hs-identifier hs-var">b0</span></a></span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-type">:|</span></a></span><span> </span><span id="local-6989586621681123948"><span class="annot"><span class="annottext">[Binding TyName Name uni fun NameAnn]
</span><a href="#local-6989586621681123948"><span class="hs-identifier hs-var">bs0</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Binding TyName Name uni fun NameAnn]
-&gt; Binding TyName Name uni fun NameAnn
-&gt; [Binding TyName Name uni fun NameAnn]
-&gt; NonEmpty (Binding TyName Name uni fun NameAnn)
</span><a href="#local-6989586621681123947"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Binding TyName Name uni fun NameAnn
</span><a href="#local-6989586621681123949"><span class="hs-identifier hs-var">b0</span></a></span><span> </span><span class="annot"><span class="annottext">[Binding TyName Name uni fun NameAnn]
</span><a href="#local-6989586621681123948"><span class="hs-identifier hs-var">bs0</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-190"></span><span>    </span><span id="local-6989586621681123947"><span class="annot"><span class="annottext">go :: [Binding TyName Name uni fun NameAnn]
-&gt; Binding TyName Name uni fun NameAnn
-&gt; [Binding TyName Name uni fun NameAnn]
-&gt; NonEmpty (Binding TyName Name uni fun NameAnn)
</span><a href="#local-6989586621681123947"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621681123946"><span class="annot"><span class="annottext">[Binding TyName Name uni fun NameAnn]
</span><a href="#local-6989586621681123946"><span class="hs-identifier hs-var">prevs</span></a></span></span><span> </span><span id="local-6989586621681123945"><span class="annot"><span class="annottext">Binding TyName Name uni fun NameAnn
</span><a href="#local-6989586621681123945"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall n (t :: * -&gt; *).
Reference n t =&gt;
(forall name. ToScopedName name =&gt; name -&gt; NameAnn)
-&gt; n -&gt; t NameAnn -&gt; t NameAnn
</span><a href="PlutusCore.Check.Scoping.html#referenceVia"><span class="hs-identifier hs-var">referenceVia</span></a></span><span> </span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681123950"><span class="hs-identifier hs-var">reg</span></a></span><span> </span><span class="annot"><span class="annottext">[Binding TyName Name uni fun NameAnn]
</span><a href="#local-6989586621681123946"><span class="hs-identifier hs-var">prevs</span></a></span><span> </span><span class="annot"><span class="annottext">Binding TyName Name uni fun NameAnn
</span><a href="#local-6989586621681123945"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; NonEmpty a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">:|</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-191"></span><span>    </span><span class="annot"><a href="#local-6989586621681123947"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681123942"><span class="annot"><span class="annottext">[Binding TyName Name uni fun NameAnn]
</span><a href="#local-6989586621681123942"><span class="hs-identifier hs-var">prevs</span></a></span></span><span> </span><span id="local-6989586621681123941"><span class="annot"><span class="annottext">Binding TyName Name uni fun NameAnn
</span><a href="#local-6989586621681123941"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681123940"><span class="annot"><span class="annottext">Binding TyName Name uni fun NameAnn
</span><a href="#local-6989586621681123940"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span id="local-6989586621681123939"><span class="annot"><span class="annottext">[Binding TyName Name uni fun NameAnn]
</span><a href="#local-6989586621681123939"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Binding TyName Name uni fun NameAnn
</span><a href="#local-6989586621681123941"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; NonEmpty a -&gt; NonEmpty a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;|</span></a></span><span> </span><span class="annot"><span class="annottext">[Binding TyName Name uni fun NameAnn]
-&gt; Binding TyName Name uni fun NameAnn
-&gt; [Binding TyName Name uni fun NameAnn]
-&gt; NonEmpty (Binding TyName Name uni fun NameAnn)
</span><a href="#local-6989586621681123947"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Binding TyName Name uni fun NameAnn
</span><a href="#local-6989586621681123941"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[Binding TyName Name uni fun NameAnn]
</span><a href="#local-6989586621681123942"><span class="hs-identifier hs-var">prevs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Binding TyName Name uni fun NameAnn
</span><a href="#local-6989586621681123940"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">[Binding TyName Name uni fun NameAnn]
</span><a href="#local-6989586621681123939"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span class="hs-comment">-- | Reference each binding in the first one apart from itself and in the last one also apart from</span><span>
</span><span id="line-194"></span><span class="hs-comment">-- itself. Former bindings are always visible in latter ones and whether latter bindings are visible</span><span>
</span><span id="line-195"></span><span class="hs-comment">-- in former ones is controlled by the first argument and ultimately depends on the recursivity</span><span>
</span><span id="line-196"></span><span class="hs-comment">-- of the family of bindings.</span><span>
</span><span id="line-197"></span><span id="local-6989586621681123937"><span id="local-6989586621681123938"><span class="annot"><a href="PlutusIR.Core.Instance.Scoping.html#referenceBindingsBothWays"><span class="hs-identifier hs-type">referenceBindingsBothWays</span></a></span><span>
</span><span id="line-198"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681123935"><span class="annot"><a href="#local-6989586621681123935"><span class="hs-identifier hs-type">name</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#ToScopedName"><span class="hs-identifier hs-type">ToScopedName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681123935"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681123935"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#NameAnn"><span class="hs-identifier hs-type">NameAnn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681123938"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681123937"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#NameAnn"><span class="hs-identifier hs-type">NameAnn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-200"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681123938"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681123937"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#NameAnn"><span class="hs-identifier hs-type">NameAnn</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-201"></span><span id="referenceBindingsBothWays"><span class="annot"><span class="annottext">referenceBindingsBothWays :: forall (uni :: * -&gt; *) fun.
(forall name. ToScopedName name =&gt; name -&gt; NameAnn)
-&gt; NonEmpty (Binding TyName Name uni fun NameAnn)
-&gt; NonEmpty (Binding TyName Name uni fun NameAnn)
</span><a href="PlutusIR.Core.Instance.Scoping.html#referenceBindingsBothWays"><span class="hs-identifier hs-var hs-var">referenceBindingsBothWays</span></a></span></span><span> </span><span id="local-6989586621681123934"><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681123934"><span class="hs-identifier hs-var">regRec</span></a></span></span><span>          </span><span class="hs-comment">-- Whether latter bindings are visible in former ones</span><span>
</span><span id="line-202"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. NonEmpty a -&gt; NonEmpty a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">NonEmpty.reverse</span></a></span><span>                    </span><span class="hs-comment">-- or not depends on the recursivity and so we have</span><span>
</span><span id="line-203"></span><span>    </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) fun.
(forall name. ToScopedName name =&gt; name -&gt; NameAnn)
-&gt; NonEmpty (Binding TyName Name uni fun NameAnn)
-&gt; NonEmpty (Binding TyName Name uni fun NameAnn)
</span><a href="PlutusIR.Core.Instance.Scoping.html#referenceViaBindings"><span class="hs-identifier hs-var">referenceViaBindings</span></a></span><span> </span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681123934"><span class="hs-identifier hs-var">regRec</span></a></span><span>         </span><span class="hs-comment">-- the registering function as an argument.</span><span>
</span><span id="line-204"></span><span>    </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. NonEmpty a -&gt; NonEmpty a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">NonEmpty.reverse</span></a></span><span>
</span><span id="line-205"></span><span>    </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) fun.
(forall name. ToScopedName name =&gt; name -&gt; NameAnn)
-&gt; NonEmpty (Binding TyName Name uni fun NameAnn)
-&gt; NonEmpty (Binding TyName Name uni fun NameAnn)
</span><a href="PlutusIR.Core.Instance.Scoping.html#referenceViaBindings"><span class="hs-identifier hs-var">referenceViaBindings</span></a></span><span> </span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="PlutusCore.Check.Scoping.html#registerBound"><span class="hs-identifier hs-var">registerBound</span></a></span><span>  </span><span class="hs-comment">-- Former bindings are always visible in latter ones.</span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span class="hs-comment">-- | Establish scoping for a family of bindings.</span><span>
</span><span id="line-208"></span><span id="local-6989586621681124418"><span id="local-6989586621681124419"><span id="local-6989586621681124420"><span class="annot"><a href="PlutusIR.Core.Instance.Scoping.html#establishScopingBindings"><span class="hs-identifier hs-type">establishScopingBindings</span></a></span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681123927"><span class="annot"><a href="#local-6989586621681123927"><span class="hs-identifier hs-type">name</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#ToScopedName"><span class="hs-identifier hs-type">ToScopedName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681123927"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681123927"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#NameAnn"><span class="hs-identifier hs-type">NameAnn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124420"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124419"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124418"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Quote.html#Quote"><span class="hs-identifier hs-type">Quote</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124420"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124419"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#NameAnn"><span class="hs-identifier hs-type">NameAnn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-212"></span><span id="establishScopingBindings"><span class="annot"><span class="annottext">establishScopingBindings :: forall (uni :: * -&gt; *) fun ann.
(forall name. ToScopedName name =&gt; name -&gt; NameAnn)
-&gt; NonEmpty (Binding TyName Name uni fun ann)
-&gt; Quote (NonEmpty (Binding TyName Name uni fun NameAnn))
</span><a href="PlutusIR.Core.Instance.Scoping.html#establishScopingBindings"><span class="hs-identifier hs-var hs-var">establishScopingBindings</span></a></span></span><span> </span><span id="local-6989586621681123920"><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681123920"><span class="hs-identifier hs-var">regRec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-213"></span><span>    </span><span class="hs-comment">-- Note that mutual recursion and self-recursion are handled separately.</span><span>
</span><span id="line-214"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) fun.
(forall name. ToScopedName name =&gt; name -&gt; NameAnn)
-&gt; NonEmpty (Binding TyName Name uni fun NameAnn)
-&gt; NonEmpty (Binding TyName Name uni fun NameAnn)
</span><a href="PlutusIR.Core.Instance.Scoping.html#referenceBindingsBothWays"><span class="hs-identifier hs-var">referenceBindingsBothWays</span></a></span><span> </span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681123920"><span class="hs-identifier hs-var">regRec</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) fun ann.
(forall name. ToScopedName name =&gt; name -&gt; NameAnn)
-&gt; Binding TyName Name uni fun ann
-&gt; Quote (Binding TyName Name uni fun NameAnn)
</span><a href="PlutusIR.Core.Instance.Scoping.html#establishScopingBinding"><span class="hs-identifier hs-var">establishScopingBinding</span></a></span><span> </span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="#local-6989586621681123920"><span class="hs-identifier hs-var">regRec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span class="hs-comment">-- | Return a registering function depending on the recursivity.</span><span>
</span><span id="line-217"></span><span id="local-6989586621681124409"><span class="annot"><a href="PlutusIR.Core.Instance.Scoping.html#registerByRecursivity"><span class="hs-identifier hs-type">registerByRecursivity</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#ToScopedName"><span class="hs-identifier hs-type">ToScopedName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124409"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Recursivity"><span class="hs-identifier hs-type">Recursivity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681124409"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#NameAnn"><span class="hs-identifier hs-type">NameAnn</span></a></span></span><span>
</span><span id="line-218"></span><span id="registerByRecursivity"><span class="annot"><span class="annottext">registerByRecursivity :: forall name. ToScopedName name =&gt; Recursivity -&gt; name -&gt; NameAnn
</span><a href="PlutusIR.Core.Instance.Scoping.html#registerByRecursivity"><span class="hs-identifier hs-var hs-var">registerByRecursivity</span></a></span></span><span> </span><span class="annot"><span class="annottext">Recursivity
</span><a href="PlutusIR.Core.Type.html#Rec"><span class="hs-identifier hs-var">Rec</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="PlutusCore.Check.Scoping.html#registerBound"><span class="hs-identifier hs-var">registerBound</span></a></span><span>
</span><span id="line-219"></span><span class="annot"><a href="PlutusIR.Core.Instance.Scoping.html#registerByRecursivity"><span class="hs-identifier hs-var">registerByRecursivity</span></a></span><span> </span><span class="annot"><span class="annottext">Recursivity
</span><a href="PlutusIR.Core.Type.html#NonRec"><span class="hs-identifier hs-var">NonRec</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="PlutusCore.Check.Scoping.html#registerOutOfScope"><span class="hs-identifier hs-var">registerOutOfScope</span></a></span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681124436"><span id="local-6989586621681124437"><span id="local-6989586621681124438"><span id="local-6989586621681124439"><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681124439"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681124438"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#EstablishScoping"><span class="hs-identifier hs-type">EstablishScoping</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124439"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124438"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124437"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124436"><span class="hs-identifier hs-type">fun</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-222"></span><span>    </span><span id="local-6989586621681123840"><span class="annot"><span class="annottext">establishScoping :: forall ann.
Term tyname name uni fun ann
-&gt; Quote (Term tyname name uni fun NameAnn)
</span><a href="#local-6989586621681123840"><span class="hs-identifier hs-var hs-var hs-var hs-var">establishScoping</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681123838"><span class="annot"><span class="annottext">Recursivity
</span><a href="#local-6989586621681123838"><span class="hs-identifier hs-var">recy</span></a></span></span><span> </span><span id="local-6989586621681123837"><span class="annot"><span class="annottext">NonEmpty (Binding tyname name uni fun ann)
</span><a href="#local-6989586621681123837"><span class="hs-identifier hs-var">bindingsDup</span></a></span></span><span> </span><span id="local-6989586621681123836"><span class="annot"><span class="annottext">Term tyname name uni fun ann
</span><a href="#local-6989586621681123836"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-223"></span><span>        </span><span id="local-6989586621681123835"><span class="annot"><span class="annottext">NonEmpty (Binding TyName Name uni fun NameAnn)
</span><a href="#local-6989586621681123835"><span class="hs-identifier hs-var">bindings</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) fun ann.
(forall name. ToScopedName name =&gt; name -&gt; NameAnn)
-&gt; NonEmpty (Binding TyName Name uni fun ann)
-&gt; Quote (NonEmpty (Binding TyName Name uni fun NameAnn))
</span><a href="PlutusIR.Core.Instance.Scoping.html#establishScopingBindings"><span class="hs-identifier hs-var">establishScopingBindings</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; Recursivity -&gt; name -&gt; NameAnn
</span><a href="PlutusIR.Core.Instance.Scoping.html#registerByRecursivity"><span class="hs-identifier hs-var">registerByRecursivity</span></a></span><span> </span><span class="annot"><span class="annottext">Recursivity
</span><a href="#local-6989586621681123838"><span class="hs-identifier hs-var">recy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NonEmpty (Binding tyname name uni fun ann)
</span><a href="#local-6989586621681123837"><span class="hs-identifier hs-var">bindingsDup</span></a></span><span>
</span><span id="line-224"></span><span>        </span><span class="hs-comment">-- Follows the shape of 'establishScopingBinder', but subtly differs (for example,</span><span>
</span><span id="line-225"></span><span>        </span><span class="hs-comment">-- does not bind a single name, does not have a @sort@ etc), hence we write things out</span><span>
</span><span id="line-226"></span><span>        </span><span class="hs-comment">-- manually.</span><span>
</span><span id="line-227"></span><span>        </span><span class="annot"><span class="annottext">forall n (t :: * -&gt; *).
Reference n t =&gt;
n -&gt; t NameAnn -&gt; t NameAnn
</span><a href="PlutusCore.Check.Scoping.html#referenceOutOfScope"><span class="hs-identifier hs-var">referenceOutOfScope</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Binding TyName Name uni fun NameAnn)
</span><a href="#local-6989586621681123835"><span class="hs-identifier hs-var">bindings</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span>
</span><span id="line-228"></span><span>            </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a
-&gt; Recursivity
-&gt; NonEmpty (Binding tyname name uni fun a)
-&gt; Term tyname name uni fun a
-&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><a href="PlutusCore.Check.Scoping.html#NotAName"><span class="hs-identifier hs-var">NotAName</span></a></span><span> </span><span class="annot"><span class="annottext">Recursivity
</span><a href="#local-6989586621681123838"><span class="hs-identifier hs-var">recy</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Binding TyName Name uni fun NameAnn)
</span><a href="#local-6989586621681123835"><span class="hs-identifier hs-var">bindings</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span>
</span><span id="line-229"></span><span>                </span><span class="annot"><span class="annottext">forall n (t :: * -&gt; *).
Reference n t =&gt;
n -&gt; t NameAnn -&gt; t NameAnn
</span><a href="PlutusCore.Check.Scoping.html#referenceBound"><span class="hs-identifier hs-var">referenceBound</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Binding TyName Name uni fun NameAnn)
</span><a href="#local-6989586621681123835"><span class="hs-identifier hs-var">bindings</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-230"></span><span>                    </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) ann.
EstablishScoping t =&gt;
t ann -&gt; Quote (t NameAnn)
</span><a href="PlutusCore.Check.Scoping.html#establishScoping"><span class="hs-identifier hs-var">establishScoping</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun ann
</span><a href="#local-6989586621681123836"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-231"></span><span>    </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#establishScoping"><span class="hs-identifier hs-var">establishScoping</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#LamAbs"><span class="hs-identifier hs-type">LamAbs</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681123830"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681123830"><span class="hs-identifier hs-var">nameDup</span></a></span></span><span> </span><span id="local-6989586621681123829"><span class="annot"><span class="annottext">Type tyname uni ann
</span><a href="#local-6989586621681123829"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621681123828"><span class="annot"><span class="annottext">Term tyname name uni fun ann
</span><a href="#local-6989586621681123828"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-232"></span><span>        </span><span id="local-6989586621681123827"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681123827"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadQuote m =&gt; Name -&gt; m Name
</span><a href="PlutusCore.Quote.html#freshenName"><span class="hs-identifier hs-var">freshenName</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681123830"><span class="hs-identifier hs-var">nameDup</span></a></span><span>
</span><span id="line-233"></span><span>        </span><span class="annot"><span class="annottext">forall name (value :: * -&gt; *) (sort :: * -&gt; *) ann.
(Reference name value, ToScopedName name, Scoping sort,
 Scoping value) =&gt;
(NameAnn -&gt; name -&gt; sort NameAnn -&gt; value NameAnn -&gt; value NameAnn)
-&gt; name -&gt; sort ann -&gt; value ann -&gt; Quote (value NameAnn)
</span><a href="PlutusCore.Check.Scoping.html#establishScopingBinder"><span class="hs-identifier hs-var">establishScopingBinder</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a
-&gt; name
-&gt; Type tyname uni a
-&gt; Term tyname name uni fun a
-&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#LamAbs"><span class="hs-identifier hs-var">LamAbs</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681123827"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni ann
</span><a href="#local-6989586621681123829"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun ann
</span><a href="#local-6989586621681123828"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-234"></span><span>    </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#establishScoping"><span class="hs-identifier hs-var">establishScoping</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#TyAbs"><span class="hs-identifier hs-type">TyAbs</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681123824"><span class="annot"><span class="annottext">tyname
</span><a href="#local-6989586621681123824"><span class="hs-identifier hs-var">nameDup</span></a></span></span><span> </span><span id="local-6989586621681123823"><span class="annot"><span class="annottext">Kind ann
</span><a href="#local-6989586621681123823"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span id="local-6989586621681123822"><span class="annot"><span class="annottext">Term tyname name uni fun ann
</span><a href="#local-6989586621681123822"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-235"></span><span>        </span><span id="local-6989586621681123821"><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681123821"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadQuote m =&gt; TyName -&gt; m TyName
</span><a href="PlutusCore.Quote.html#freshenTyName"><span class="hs-identifier hs-var">freshenTyName</span></a></span><span> </span><span class="annot"><span class="annottext">tyname
</span><a href="#local-6989586621681123824"><span class="hs-identifier hs-var">nameDup</span></a></span><span>
</span><span id="line-236"></span><span>        </span><span class="annot"><span class="annottext">forall name (value :: * -&gt; *) (sort :: * -&gt; *) ann.
(Reference name value, ToScopedName name, Scoping sort,
 Scoping value) =&gt;
(NameAnn -&gt; name -&gt; sort NameAnn -&gt; value NameAnn -&gt; value NameAnn)
-&gt; name -&gt; sort ann -&gt; value ann -&gt; Quote (value NameAnn)
</span><a href="PlutusCore.Check.Scoping.html#establishScopingBinder"><span class="hs-identifier hs-var">establishScopingBinder</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a
-&gt; tyname
-&gt; Kind a
-&gt; Term tyname name uni fun a
-&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#TyAbs"><span class="hs-identifier hs-var">TyAbs</span></a></span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621681123821"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Kind ann
</span><a href="#local-6989586621681123823"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun ann
</span><a href="#local-6989586621681123822"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-237"></span><span>    </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#establishScoping"><span class="hs-identifier hs-var">establishScoping</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#IWrap"><span class="hs-identifier hs-type">IWrap</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681123819"><span class="annot"><span class="annottext">Type tyname uni ann
</span><a href="#local-6989586621681123819"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621681123818"><span class="annot"><span class="annottext">Type tyname uni ann
</span><a href="#local-6989586621681123818"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span id="local-6989586621681123817"><span class="annot"><span class="annottext">Term tyname name uni fun ann
</span><a href="#local-6989586621681123817"><span class="hs-identifier hs-var">term</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-238"></span><span>        </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a
-&gt; Type tyname uni a
-&gt; Type tyname uni a
-&gt; Term tyname name uni fun a
-&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#IWrap"><span class="hs-identifier hs-var">IWrap</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><a href="PlutusCore.Check.Scoping.html#NotAName"><span class="hs-identifier hs-var">NotAName</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) ann.
EstablishScoping t =&gt;
t ann -&gt; Quote (t NameAnn)
</span><a href="PlutusCore.Check.Scoping.html#establishScoping"><span class="hs-identifier hs-var">establishScoping</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni ann
</span><a href="#local-6989586621681123819"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) ann.
EstablishScoping t =&gt;
t ann -&gt; Quote (t NameAnn)
</span><a href="PlutusCore.Check.Scoping.html#establishScoping"><span class="hs-identifier hs-var">establishScoping</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni ann
</span><a href="#local-6989586621681123818"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) ann.
EstablishScoping t =&gt;
t ann -&gt; Quote (t NameAnn)
</span><a href="PlutusCore.Check.Scoping.html#establishScoping"><span class="hs-identifier hs-var">establishScoping</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun ann
</span><a href="#local-6989586621681123817"><span class="hs-identifier hs-var">term</span></a></span><span>
</span><span id="line-239"></span><span>    </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#establishScoping"><span class="hs-identifier hs-var">establishScoping</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681123816"><span class="annot"><span class="annottext">Term tyname name uni fun ann
</span><a href="#local-6989586621681123816"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621681123815"><span class="annot"><span class="annottext">Term tyname name uni fun ann
</span><a href="#local-6989586621681123815"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-240"></span><span>        </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a
-&gt; Term tyname name uni fun a
-&gt; Term tyname name uni fun a
-&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><a href="PlutusCore.Check.Scoping.html#NotAName"><span class="hs-identifier hs-var">NotAName</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) ann.
EstablishScoping t =&gt;
t ann -&gt; Quote (t NameAnn)
</span><a href="PlutusCore.Check.Scoping.html#establishScoping"><span class="hs-identifier hs-var">establishScoping</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun ann
</span><a href="#local-6989586621681123816"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) ann.
EstablishScoping t =&gt;
t ann -&gt; Quote (t NameAnn)
</span><a href="PlutusCore.Check.Scoping.html#establishScoping"><span class="hs-identifier hs-var">establishScoping</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun ann
</span><a href="#local-6989586621681123815"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-241"></span><span>    </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#establishScoping"><span class="hs-identifier hs-var">establishScoping</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Unwrap"><span class="hs-identifier hs-type">Unwrap</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681123813"><span class="annot"><span class="annottext">Term tyname name uni fun ann
</span><a href="#local-6989586621681123813"><span class="hs-identifier hs-var">term</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a -&gt; Term tyname name uni fun a -&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#Unwrap"><span class="hs-identifier hs-var">Unwrap</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><a href="PlutusCore.Check.Scoping.html#NotAName"><span class="hs-identifier hs-var">NotAName</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) ann.
EstablishScoping t =&gt;
t ann -&gt; Quote (t NameAnn)
</span><a href="PlutusCore.Check.Scoping.html#establishScoping"><span class="hs-identifier hs-var">establishScoping</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun ann
</span><a href="#local-6989586621681123813"><span class="hs-identifier hs-var">term</span></a></span><span>
</span><span id="line-242"></span><span>    </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#establishScoping"><span class="hs-identifier hs-var">establishScoping</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681123811"><span class="annot"><span class="annottext">Type tyname uni ann
</span><a href="#local-6989586621681123811"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a -&gt; Type tyname uni a -&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#Error"><span class="hs-identifier hs-var">Error</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><a href="PlutusCore.Check.Scoping.html#NotAName"><span class="hs-identifier hs-var">NotAName</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) ann.
EstablishScoping t =&gt;
t ann -&gt; Quote (t NameAnn)
</span><a href="PlutusCore.Check.Scoping.html#establishScoping"><span class="hs-identifier hs-var">establishScoping</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni ann
</span><a href="#local-6989586621681123811"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-243"></span><span>    </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#establishScoping"><span class="hs-identifier hs-var">establishScoping</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#TyInst"><span class="hs-identifier hs-type">TyInst</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681123810"><span class="annot"><span class="annottext">Term tyname name uni fun ann
</span><a href="#local-6989586621681123810"><span class="hs-identifier hs-var">term</span></a></span></span><span> </span><span id="local-6989586621681123809"><span class="annot"><span class="annottext">Type tyname uni ann
</span><a href="#local-6989586621681123809"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-244"></span><span>        </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a
-&gt; Term tyname name uni fun a
-&gt; Type tyname uni a
-&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#TyInst"><span class="hs-identifier hs-var">TyInst</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><a href="PlutusCore.Check.Scoping.html#NotAName"><span class="hs-identifier hs-var">NotAName</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) ann.
EstablishScoping t =&gt;
t ann -&gt; Quote (t NameAnn)
</span><a href="PlutusCore.Check.Scoping.html#establishScoping"><span class="hs-identifier hs-var">establishScoping</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun ann
</span><a href="#local-6989586621681123810"><span class="hs-identifier hs-var">term</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) ann.
EstablishScoping t =&gt;
t ann -&gt; Quote (t NameAnn)
</span><a href="PlutusCore.Check.Scoping.html#establishScoping"><span class="hs-identifier hs-var">establishScoping</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni ann
</span><a href="#local-6989586621681123809"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-245"></span><span>    </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#establishScoping"><span class="hs-identifier hs-var">establishScoping</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681123808"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681123808"><span class="hs-identifier hs-var">nameDup</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-246"></span><span>        </span><span id="local-6989586621681123807"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681123807"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). MonadQuote m =&gt; Name -&gt; m Name
</span><a href="PlutusCore.Quote.html#freshenName"><span class="hs-identifier hs-var">freshenName</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681123808"><span class="hs-identifier hs-var">nameDup</span></a></span><span>
</span><span id="line-247"></span><span>        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a -&gt; name -&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall name. ToScopedName name =&gt; name -&gt; NameAnn
</span><a href="PlutusCore.Check.Scoping.html#registerFree"><span class="hs-identifier hs-var">registerFree</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681123807"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681123807"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-248"></span><span>    </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#establishScoping"><span class="hs-identifier hs-var">establishScoping</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Constant"><span class="hs-identifier hs-type">Constant</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681123804"><span class="annot"><span class="annottext">Some (ValueOf uni)
</span><a href="#local-6989586621681123804"><span class="hs-identifier hs-var">con</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a -&gt; Some (ValueOf uni) -&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#Constant"><span class="hs-identifier hs-var">Constant</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><a href="PlutusCore.Check.Scoping.html#NotAName"><span class="hs-identifier hs-var">NotAName</span></a></span><span> </span><span class="annot"><span class="annottext">Some (ValueOf uni)
</span><a href="#local-6989586621681123804"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-249"></span><span>    </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#establishScoping"><span class="hs-identifier hs-var">establishScoping</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Builtin"><span class="hs-identifier hs-type">Builtin</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681123802"><span class="annot"><span class="annottext">fun
</span><a href="#local-6989586621681123802"><span class="hs-identifier hs-var">bi</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a -&gt; fun -&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#Builtin"><span class="hs-identifier hs-var">Builtin</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><a href="PlutusCore.Check.Scoping.html#NotAName"><span class="hs-identifier hs-var">NotAName</span></a></span><span> </span><span class="annot"><span class="annottext">fun
</span><a href="#local-6989586621681123802"><span class="hs-identifier hs-var">bi</span></a></span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681124376"><span id="local-6989586621681124377"><span id="local-6989586621681124378"><span id="local-6989586621681124379"><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681124379"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681124378"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#EstablishScoping"><span class="hs-identifier hs-type">EstablishScoping</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Program"><span class="hs-identifier hs-type">Program</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124379"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124378"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124377"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124376"><span class="hs-identifier hs-type">fun</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-252"></span><span>    </span><span id="local-6989586621681123789"><span class="annot"><span class="annottext">establishScoping :: forall ann.
Program tyname name uni fun ann
-&gt; Quote (Program tyname name uni fun NameAnn)
</span><a href="#local-6989586621681123789"><span class="hs-identifier hs-var hs-var hs-var hs-var">establishScoping</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Program"><span class="hs-identifier hs-type">Program</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681123787"><span class="annot"><span class="annottext">Term tyname name uni fun ann
</span><a href="#local-6989586621681123787"><span class="hs-identifier hs-var">term</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun ann.
ann
-&gt; Term tyname name uni fun ann -&gt; Program tyname name uni fun ann
</span><a href="PlutusIR.Core.Type.html#Program"><span class="hs-identifier hs-var">Program</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><a href="PlutusCore.Check.Scoping.html#NotAName"><span class="hs-identifier hs-var">NotAName</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) ann.
EstablishScoping t =&gt;
t ann -&gt; Quote (t NameAnn)
</span><a href="PlutusCore.Check.Scoping.html#establishScoping"><span class="hs-identifier hs-var">establishScoping</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun ann
</span><a href="#local-6989586621681123787"><span class="hs-identifier hs-var">term</span></a></span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681124366"><span class="annot"><a href="#local-6989586621681124366"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#CollectScopeInfo"><span class="hs-identifier hs-type">CollectScopeInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#TyVarDecl"><span class="hs-identifier hs-type">TyVarDecl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124366"><span class="hs-identifier hs-type">tyname</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-255"></span><span>    </span><span id="local-6989586621681123776"><span class="annot"><span class="annottext">collectScopeInfo :: TyVarDecl tyname NameAnn -&gt; ScopeErrorOrInfo
</span><a href="PlutusCore.Check.Scoping.html#collectScopeInfo"><span class="hs-identifier hs-var hs-var hs-var hs-var">collectScopeInfo</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#TyVarDecl"><span class="hs-identifier hs-type">TyVarDecl</span></a></span><span> </span><span id="local-6989586621681123774"><span class="annot"><span class="annottext">NameAnn
</span><a href="#local-6989586621681123774"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621681123773"><span class="annot"><span class="annottext">tyname
</span><a href="#local-6989586621681123773"><span class="hs-identifier hs-var">tyname</span></a></span></span><span> </span><span id="local-6989586621681123772"><span class="annot"><span class="annottext">Kind NameAnn
</span><a href="#local-6989586621681123772"><span class="hs-identifier hs-var">kind</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall name.
ToScopedName name =&gt;
NameAnn -&gt; name -&gt; ScopeErrorOrInfo
</span><a href="PlutusCore.Check.Scoping.html#handleSname"><span class="hs-identifier hs-var">handleSname</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><a href="#local-6989586621681123774"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">tyname
</span><a href="#local-6989586621681123773"><span class="hs-identifier hs-var">tyname</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *).
CollectScopeInfo t =&gt;
t NameAnn -&gt; ScopeErrorOrInfo
</span><a href="PlutusCore.Check.Scoping.html#collectScopeInfo"><span class="hs-identifier hs-var">collectScopeInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Kind NameAnn
</span><a href="#local-6989586621681123772"><span class="hs-identifier hs-var">kind</span></a></span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681124358"><span id="local-6989586621681124359"><span id="local-6989586621681124360"><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681124360"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681124359"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#CollectScopeInfo"><span class="hs-identifier hs-type">CollectScopeInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#VarDecl"><span class="hs-identifier hs-type">VarDecl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124360"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124359"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124358"><span class="hs-identifier hs-type">uni</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-258"></span><span>    </span><span id="local-6989586621681123758"><span class="annot"><span class="annottext">collectScopeInfo :: VarDecl tyname name uni NameAnn -&gt; ScopeErrorOrInfo
</span><a href="#local-6989586621681123758"><span class="hs-identifier hs-var hs-var hs-var hs-var">collectScopeInfo</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#VarDecl"><span class="hs-identifier hs-type">VarDecl</span></a></span><span> </span><span id="local-6989586621681123757"><span class="annot"><span class="annottext">NameAnn
</span><a href="#local-6989586621681123757"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621681123756"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681123756"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621681123755"><span class="annot"><span class="annottext">Type tyname uni NameAnn
</span><a href="#local-6989586621681123755"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall name.
ToScopedName name =&gt;
NameAnn -&gt; name -&gt; ScopeErrorOrInfo
</span><a href="PlutusCore.Check.Scoping.html#handleSname"><span class="hs-identifier hs-var">handleSname</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><a href="#local-6989586621681123757"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681123756"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *).
CollectScopeInfo t =&gt;
t NameAnn -&gt; ScopeErrorOrInfo
</span><a href="PlutusCore.Check.Scoping.html#collectScopeInfo"><span class="hs-identifier hs-var">collectScopeInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni NameAnn
</span><a href="#local-6989586621681123755"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-259"></span><span>
</span><span id="line-260"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681124352"><span id="local-6989586621681124353"><span id="local-6989586621681124354"><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681124354"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681124353"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#CollectScopeInfo"><span class="hs-identifier hs-type">CollectScopeInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Datatype"><span class="hs-identifier hs-type">Datatype</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124354"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124353"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124352"><span class="hs-identifier hs-type">uni</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-261"></span><span>    </span><span id="local-6989586621681123732"><span class="annot"><span class="annottext">collectScopeInfo :: Datatype tyname name uni NameAnn -&gt; ScopeErrorOrInfo
</span><a href="#local-6989586621681123732"><span class="hs-identifier hs-var hs-var hs-var hs-var">collectScopeInfo</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Datatype"><span class="hs-identifier hs-type">Datatype</span></a></span><span> </span><span id="local-6989586621681123731"><span class="annot"><span class="annottext">NameAnn
</span><a href="#local-6989586621681123731"><span class="hs-identifier hs-var">matchAnn</span></a></span></span><span> </span><span id="local-6989586621681123730"><span class="annot"><span class="annottext">TyVarDecl tyname NameAnn
</span><a href="#local-6989586621681123730"><span class="hs-identifier hs-var">dataDecl</span></a></span></span><span> </span><span id="local-6989586621681123729"><span class="annot"><span class="annottext">[TyVarDecl tyname NameAnn]
</span><a href="#local-6989586621681123729"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621681123728"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681123728"><span class="hs-identifier hs-var">matchName</span></a></span></span><span> </span><span id="local-6989586621681123727"><span class="annot"><span class="annottext">[VarDecl tyname name uni NameAnn]
</span><a href="#local-6989586621681123727"><span class="hs-identifier hs-var">constrs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">fold</span></a></span><span>
</span><span id="line-262"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *).
CollectScopeInfo t =&gt;
t NameAnn -&gt; ScopeErrorOrInfo
</span><a href="PlutusCore.Check.Scoping.html#collectScopeInfo"><span class="hs-identifier hs-var">collectScopeInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarDecl tyname NameAnn
</span><a href="#local-6989586621681123730"><span class="hs-identifier hs-var">dataDecl</span></a></span><span>
</span><span id="line-263"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">foldMap</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *).
CollectScopeInfo t =&gt;
t NameAnn -&gt; ScopeErrorOrInfo
</span><a href="PlutusCore.Check.Scoping.html#collectScopeInfo"><span class="hs-identifier hs-var">collectScopeInfo</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarDecl tyname NameAnn]
</span><a href="#local-6989586621681123729"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-264"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall name.
ToScopedName name =&gt;
NameAnn -&gt; name -&gt; ScopeErrorOrInfo
</span><a href="PlutusCore.Check.Scoping.html#handleSname"><span class="hs-identifier hs-var">handleSname</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><a href="#local-6989586621681123731"><span class="hs-identifier hs-var">matchAnn</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681123728"><span class="hs-identifier hs-var">matchName</span></a></span><span>
</span><span id="line-265"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">foldMap</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *).
CollectScopeInfo t =&gt;
t NameAnn -&gt; ScopeErrorOrInfo
</span><a href="PlutusCore.Check.Scoping.html#collectScopeInfo"><span class="hs-identifier hs-var">collectScopeInfo</span></a></span><span> </span><span class="annot"><span class="annottext">[VarDecl tyname name uni NameAnn]
</span><a href="#local-6989586621681123727"><span class="hs-identifier hs-var">constrs</span></a></span><span>
</span><span id="line-266"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-267"></span><span>
</span><span id="line-268"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681124341"><span id="local-6989586621681124342"><span id="local-6989586621681124343"><span id="local-6989586621681124344"><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681124344"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681124343"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#CollectScopeInfo"><span class="hs-identifier hs-type">CollectScopeInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124344"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124343"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124342"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124341"><span class="hs-identifier hs-type">fun</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-269"></span><span>    </span><span id="local-6989586621681123704"><span class="annot"><span class="annottext">collectScopeInfo :: Binding tyname name uni fun NameAnn -&gt; ScopeErrorOrInfo
</span><a href="#local-6989586621681123704"><span class="hs-identifier hs-var hs-var hs-var hs-var">collectScopeInfo</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#TermBind"><span class="hs-identifier hs-type">TermBind</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Strictness
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681123703"><span class="annot"><span class="annottext">VarDecl tyname name uni NameAnn
</span><a href="#local-6989586621681123703"><span class="hs-identifier hs-var">varDecl</span></a></span></span><span> </span><span id="local-6989586621681123702"><span class="annot"><span class="annottext">Term tyname name uni fun NameAnn
</span><a href="#local-6989586621681123702"><span class="hs-identifier hs-var">term</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *).
CollectScopeInfo t =&gt;
t NameAnn -&gt; ScopeErrorOrInfo
</span><a href="PlutusCore.Check.Scoping.html#collectScopeInfo"><span class="hs-identifier hs-var">collectScopeInfo</span></a></span><span> </span><span class="annot"><span class="annottext">VarDecl tyname name uni NameAnn
</span><a href="#local-6989586621681123703"><span class="hs-identifier hs-var">varDecl</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *).
CollectScopeInfo t =&gt;
t NameAnn -&gt; ScopeErrorOrInfo
</span><a href="PlutusCore.Check.Scoping.html#collectScopeInfo"><span class="hs-identifier hs-var">collectScopeInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun NameAnn
</span><a href="#local-6989586621681123702"><span class="hs-identifier hs-var">term</span></a></span><span>
</span><span id="line-270"></span><span>    </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#collectScopeInfo"><span class="hs-identifier hs-var">collectScopeInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#TypeBind"><span class="hs-identifier hs-type">TypeBind</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681123701"><span class="annot"><span class="annottext">TyVarDecl tyname NameAnn
</span><a href="#local-6989586621681123701"><span class="hs-identifier hs-var">tyVarDecl</span></a></span></span><span> </span><span id="local-6989586621681123700"><span class="annot"><span class="annottext">Type tyname uni NameAnn
</span><a href="#local-6989586621681123700"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *).
CollectScopeInfo t =&gt;
t NameAnn -&gt; ScopeErrorOrInfo
</span><a href="PlutusCore.Check.Scoping.html#collectScopeInfo"><span class="hs-identifier hs-var">collectScopeInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarDecl tyname NameAnn
</span><a href="#local-6989586621681123701"><span class="hs-identifier hs-var">tyVarDecl</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *).
CollectScopeInfo t =&gt;
t NameAnn -&gt; ScopeErrorOrInfo
</span><a href="PlutusCore.Check.Scoping.html#collectScopeInfo"><span class="hs-identifier hs-var">collectScopeInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni NameAnn
</span><a href="#local-6989586621681123700"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-271"></span><span>    </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#collectScopeInfo"><span class="hs-identifier hs-var">collectScopeInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#DatatypeBind"><span class="hs-identifier hs-type">DatatypeBind</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681123699"><span class="annot"><span class="annottext">Datatype tyname name uni NameAnn
</span><a href="#local-6989586621681123699"><span class="hs-identifier hs-var">datatype</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *).
CollectScopeInfo t =&gt;
t NameAnn -&gt; ScopeErrorOrInfo
</span><a href="PlutusCore.Check.Scoping.html#collectScopeInfo"><span class="hs-identifier hs-var">collectScopeInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Datatype tyname name uni NameAnn
</span><a href="#local-6989586621681123699"><span class="hs-identifier hs-var">datatype</span></a></span><span>
</span><span id="line-272"></span><span>
</span><span id="line-273"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681124393"><span id="local-6989586621681124394"><span id="local-6989586621681124395"><span id="local-6989586621681124396"><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681124396"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681124395"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#CollectScopeInfo"><span class="hs-identifier hs-type">CollectScopeInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124396"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124395"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124394"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124393"><span class="hs-identifier hs-type">fun</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-274"></span><span>    </span><span id="local-6989586621681123654"><span class="annot"><span class="annottext">collectScopeInfo :: Term tyname name uni fun NameAnn -&gt; ScopeErrorOrInfo
</span><a href="#local-6989586621681123654"><span class="hs-identifier hs-var hs-var hs-var hs-var">collectScopeInfo</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Recursivity
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681123653"><span class="annot"><span class="annottext">NonEmpty (Binding tyname name uni fun NameAnn)
</span><a href="#local-6989586621681123653"><span class="hs-identifier hs-var">bindings</span></a></span></span><span> </span><span id="local-6989586621681123652"><span class="annot"><span class="annottext">Term tyname name uni fun NameAnn
</span><a href="#local-6989586621681123652"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-275"></span><span>        </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">foldMap</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *).
CollectScopeInfo t =&gt;
t NameAnn -&gt; ScopeErrorOrInfo
</span><a href="PlutusCore.Check.Scoping.html#collectScopeInfo"><span class="hs-identifier hs-var">collectScopeInfo</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Binding tyname name uni fun NameAnn)
</span><a href="#local-6989586621681123653"><span class="hs-identifier hs-var">bindings</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *).
CollectScopeInfo t =&gt;
t NameAnn -&gt; ScopeErrorOrInfo
</span><a href="PlutusCore.Check.Scoping.html#collectScopeInfo"><span class="hs-identifier hs-var">collectScopeInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun NameAnn
</span><a href="#local-6989586621681123652"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-276"></span><span>    </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#collectScopeInfo"><span class="hs-identifier hs-var">collectScopeInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#LamAbs"><span class="hs-identifier hs-type">LamAbs</span></a></span><span> </span><span id="local-6989586621681123651"><span class="annot"><span class="annottext">NameAnn
</span><a href="#local-6989586621681123651"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621681123650"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681123650"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621681123649"><span class="annot"><span class="annottext">Type tyname uni NameAnn
</span><a href="#local-6989586621681123649"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621681123648"><span class="annot"><span class="annottext">Term tyname name uni fun NameAnn
</span><a href="#local-6989586621681123648"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-277"></span><span>        </span><span class="annot"><span class="annottext">forall name.
ToScopedName name =&gt;
NameAnn -&gt; name -&gt; ScopeErrorOrInfo
</span><a href="PlutusCore.Check.Scoping.html#handleSname"><span class="hs-identifier hs-var">handleSname</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><a href="#local-6989586621681123651"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681123650"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *).
CollectScopeInfo t =&gt;
t NameAnn -&gt; ScopeErrorOrInfo
</span><a href="PlutusCore.Check.Scoping.html#collectScopeInfo"><span class="hs-identifier hs-var">collectScopeInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni NameAnn
</span><a href="#local-6989586621681123649"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *).
CollectScopeInfo t =&gt;
t NameAnn -&gt; ScopeErrorOrInfo
</span><a href="PlutusCore.Check.Scoping.html#collectScopeInfo"><span class="hs-identifier hs-var">collectScopeInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun NameAnn
</span><a href="#local-6989586621681123648"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-278"></span><span>    </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#collectScopeInfo"><span class="hs-identifier hs-var">collectScopeInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#TyAbs"><span class="hs-identifier hs-type">TyAbs</span></a></span><span> </span><span id="local-6989586621681123647"><span class="annot"><span class="annottext">NameAnn
</span><a href="#local-6989586621681123647"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621681123646"><span class="annot"><span class="annottext">tyname
</span><a href="#local-6989586621681123646"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621681123645"><span class="annot"><span class="annottext">Kind NameAnn
</span><a href="#local-6989586621681123645"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span id="local-6989586621681123644"><span class="annot"><span class="annottext">Term tyname name uni fun NameAnn
</span><a href="#local-6989586621681123644"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-279"></span><span>        </span><span class="annot"><span class="annottext">forall name.
ToScopedName name =&gt;
NameAnn -&gt; name -&gt; ScopeErrorOrInfo
</span><a href="PlutusCore.Check.Scoping.html#handleSname"><span class="hs-identifier hs-var">handleSname</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><a href="#local-6989586621681123647"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">tyname
</span><a href="#local-6989586621681123646"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *).
CollectScopeInfo t =&gt;
t NameAnn -&gt; ScopeErrorOrInfo
</span><a href="PlutusCore.Check.Scoping.html#collectScopeInfo"><span class="hs-identifier hs-var">collectScopeInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Kind NameAnn
</span><a href="#local-6989586621681123645"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *).
CollectScopeInfo t =&gt;
t NameAnn -&gt; ScopeErrorOrInfo
</span><a href="PlutusCore.Check.Scoping.html#collectScopeInfo"><span class="hs-identifier hs-var">collectScopeInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun NameAnn
</span><a href="#local-6989586621681123644"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-280"></span><span>    </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#collectScopeInfo"><span class="hs-identifier hs-var">collectScopeInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#IWrap"><span class="hs-identifier hs-type">IWrap</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681123643"><span class="annot"><span class="annottext">Type tyname uni NameAnn
</span><a href="#local-6989586621681123643"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621681123642"><span class="annot"><span class="annottext">Type tyname uni NameAnn
</span><a href="#local-6989586621681123642"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span id="local-6989586621681123641"><span class="annot"><span class="annottext">Term tyname name uni fun NameAnn
</span><a href="#local-6989586621681123641"><span class="hs-identifier hs-var">term</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-281"></span><span>        </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *).
CollectScopeInfo t =&gt;
t NameAnn -&gt; ScopeErrorOrInfo
</span><a href="PlutusCore.Check.Scoping.html#collectScopeInfo"><span class="hs-identifier hs-var">collectScopeInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni NameAnn
</span><a href="#local-6989586621681123643"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *).
CollectScopeInfo t =&gt;
t NameAnn -&gt; ScopeErrorOrInfo
</span><a href="PlutusCore.Check.Scoping.html#collectScopeInfo"><span class="hs-identifier hs-var">collectScopeInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni NameAnn
</span><a href="#local-6989586621681123642"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *).
CollectScopeInfo t =&gt;
t NameAnn -&gt; ScopeErrorOrInfo
</span><a href="PlutusCore.Check.Scoping.html#collectScopeInfo"><span class="hs-identifier hs-var">collectScopeInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun NameAnn
</span><a href="#local-6989586621681123641"><span class="hs-identifier hs-var">term</span></a></span><span>
</span><span id="line-282"></span><span>    </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#collectScopeInfo"><span class="hs-identifier hs-var">collectScopeInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681123640"><span class="annot"><span class="annottext">Term tyname name uni fun NameAnn
</span><a href="#local-6989586621681123640"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621681123639"><span class="annot"><span class="annottext">Term tyname name uni fun NameAnn
</span><a href="#local-6989586621681123639"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *).
CollectScopeInfo t =&gt;
t NameAnn -&gt; ScopeErrorOrInfo
</span><a href="PlutusCore.Check.Scoping.html#collectScopeInfo"><span class="hs-identifier hs-var">collectScopeInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun NameAnn
</span><a href="#local-6989586621681123640"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *).
CollectScopeInfo t =&gt;
t NameAnn -&gt; ScopeErrorOrInfo
</span><a href="PlutusCore.Check.Scoping.html#collectScopeInfo"><span class="hs-identifier hs-var">collectScopeInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun NameAnn
</span><a href="#local-6989586621681123639"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-283"></span><span>    </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#collectScopeInfo"><span class="hs-identifier hs-var">collectScopeInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Unwrap"><span class="hs-identifier hs-type">Unwrap</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681123638"><span class="annot"><span class="annottext">Term tyname name uni fun NameAnn
</span><a href="#local-6989586621681123638"><span class="hs-identifier hs-var">term</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *).
CollectScopeInfo t =&gt;
t NameAnn -&gt; ScopeErrorOrInfo
</span><a href="PlutusCore.Check.Scoping.html#collectScopeInfo"><span class="hs-identifier hs-var">collectScopeInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun NameAnn
</span><a href="#local-6989586621681123638"><span class="hs-identifier hs-var">term</span></a></span><span>
</span><span id="line-284"></span><span>    </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#collectScopeInfo"><span class="hs-identifier hs-var">collectScopeInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681123637"><span class="annot"><span class="annottext">Type tyname uni NameAnn
</span><a href="#local-6989586621681123637"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *).
CollectScopeInfo t =&gt;
t NameAnn -&gt; ScopeErrorOrInfo
</span><a href="PlutusCore.Check.Scoping.html#collectScopeInfo"><span class="hs-identifier hs-var">collectScopeInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni NameAnn
</span><a href="#local-6989586621681123637"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-285"></span><span>    </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#collectScopeInfo"><span class="hs-identifier hs-var">collectScopeInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#TyInst"><span class="hs-identifier hs-type">TyInst</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681123636"><span class="annot"><span class="annottext">Term tyname name uni fun NameAnn
</span><a href="#local-6989586621681123636"><span class="hs-identifier hs-var">term</span></a></span></span><span> </span><span id="local-6989586621681123635"><span class="annot"><span class="annottext">Type tyname uni NameAnn
</span><a href="#local-6989586621681123635"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *).
CollectScopeInfo t =&gt;
t NameAnn -&gt; ScopeErrorOrInfo
</span><a href="PlutusCore.Check.Scoping.html#collectScopeInfo"><span class="hs-identifier hs-var">collectScopeInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun NameAnn
</span><a href="#local-6989586621681123636"><span class="hs-identifier hs-var">term</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *).
CollectScopeInfo t =&gt;
t NameAnn -&gt; ScopeErrorOrInfo
</span><a href="PlutusCore.Check.Scoping.html#collectScopeInfo"><span class="hs-identifier hs-var">collectScopeInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni NameAnn
</span><a href="#local-6989586621681123635"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-286"></span><span>    </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#collectScopeInfo"><span class="hs-identifier hs-var">collectScopeInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621681123634"><span class="annot"><span class="annottext">NameAnn
</span><a href="#local-6989586621681123634"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621681123633"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681123633"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall name.
ToScopedName name =&gt;
NameAnn -&gt; name -&gt; ScopeErrorOrInfo
</span><a href="PlutusCore.Check.Scoping.html#handleSname"><span class="hs-identifier hs-var">handleSname</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><a href="#local-6989586621681123634"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681123633"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-287"></span><span>    </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#collectScopeInfo"><span class="hs-identifier hs-var">collectScopeInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Constant"><span class="hs-identifier hs-type">Constant</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Some (ValueOf uni)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-288"></span><span>    </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#collectScopeInfo"><span class="hs-identifier hs-var">collectScopeInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Builtin"><span class="hs-identifier hs-type">Builtin</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">fun
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-289"></span><span>
</span><span id="line-290"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681124328"><span id="local-6989586621681124329"><span id="local-6989586621681124330"><span id="local-6989586621681124331"><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681124331"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681124330"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Check.Scoping.html#CollectScopeInfo"><span class="hs-identifier hs-type">CollectScopeInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Program"><span class="hs-identifier hs-type">Program</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124331"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124330"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124329"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124328"><span class="hs-identifier hs-type">fun</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-291"></span><span>    </span><span id="local-6989586621681123622"><span class="annot"><span class="annottext">collectScopeInfo :: Program tyname name uni fun NameAnn -&gt; ScopeErrorOrInfo
</span><a href="#local-6989586621681123622"><span class="hs-identifier hs-var hs-var hs-var hs-var">collectScopeInfo</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Program"><span class="hs-identifier hs-type">Program</span></a></span><span> </span><span class="annot"><span class="annottext">NameAnn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681123621"><span class="annot"><span class="annottext">Term tyname name uni fun NameAnn
</span><a href="#local-6989586621681123621"><span class="hs-identifier hs-var">term</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *).
CollectScopeInfo t =&gt;
t NameAnn -&gt; ScopeErrorOrInfo
</span><a href="PlutusCore.Check.Scoping.html#collectScopeInfo"><span class="hs-identifier hs-var">collectScopeInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun NameAnn
</span><a href="#local-6989586621681123621"><span class="hs-identifier hs-var">term</span></a></span><span>
</span><span id="line-292"></span></pre></body></html>