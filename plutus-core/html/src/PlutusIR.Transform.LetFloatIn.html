<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns      #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase        #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell   #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE TupleSections     #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications  #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns      #-}</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-comment">-- | Float bindings inwards.</span><span>
</span><span id="line-10"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">PlutusIR.Transform.LetFloatIn</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#floatTerm"><span class="hs-identifier">floatTerm</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.html"><span class="hs-identifier">PlutusCore</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PLC</span></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.html"><span class="hs-identifier">PlutusCore.Builtin</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PLC</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Name.html"><span class="hs-identifier">PlutusCore.Name</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PLC</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusIR.html"><span class="hs-identifier">PlutusIR</span></a></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusIR.Analysis.Usages.html"><span class="hs-identifier">PlutusIR.Analysis.Usages</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Usages</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusIR.Purity.html"><span class="hs-identifier">PlutusIR.Purity</span></a></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusIR.Transform.Rename.html"><span class="hs-identifier">PlutusIR.Transform.Rename</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../lens/html/src"><span class="hs-identifier">Control.Lens</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../lens/html/src"><span class="hs-identifier">Strict</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../extra/html/src"><span class="hs-identifier">Control.Monad.Extra</span></a></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier">Control.Monad.Trans.Reader</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Data.Foldable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">foldrM</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../extra/html/src"><span class="hs-identifier">Data.List.Extra</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../extra/html/src"><span class="hs-identifier">Data.List.NonEmpty.Extra</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../extra/html/src"><span class="hs-identifier">Data.List.NonEmpty.Extra</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NonEmpty</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Set</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="hs-comment">{- Note [Float-in]

-------------------------------------------------------------------------------
1. Which term bindings can be floated in?
-------------------------------------------------------------------------------

Strict bindings whose RHSs are impure should never be moved, since they can change the
semantics of the program. We can only move non-strict bindings or strict bindings
whose RHSs are pure.

We also need to be very careful about moving a strict binding whose RHS is not a work-free
(though pure). Consider a strict binding whose RHS is a pure, expensive application. If we
move it into, e.g., a lambda, its RHS may end up being evaluated more times. Although this
doesn't change the semantics of the program, it can make it much more expensive. For
simplicity, we do not move such bindings either.

In the rest of this Note, we may simply use &quot;binding&quot; to refer to either a non-strict
binding, or a strict binding whose RHS is work-free. Usually there's no need to distinguish
between these two, since `let x (nonstrict) = rhs` is essentially equivalent to
`let x (strict) = all a rhs`.

-------------------------------------------------------------------------------
2. What about type and datatype bindings?
-------------------------------------------------------------------------------

Type bindings can always be floated in. Doing so has no impact on cost since the a type
binding is compiled into a `force`/`delay` pair that will be optimized away. However,
doing so may enable other type and datatype bindings to be floated inwards.

Datatype bindings can also always be floated inwards. A `DatatypeBind` defines both new types
and new terms. The types can always be floated in, and the terms are all lambda abstractions
or type abstractions, which are essentially work free.

-------------------------------------------------------------------------------
3. The effect of floating in
-------------------------------------------------------------------------------

If we only float in bindings that are either non-strict, or whose RHSs is a work-free, then
why does that make a difference? Because such bindings are not completely free: when we
move a non-strict binding `let x (nonstrict) = rhs`, what we are really moving around is
`delay rhs`, lambda abstractions and lambda applications. None of them is free because
they incur CEK machine costs.

Here's a concrete example where floating a non-strict binding inwards saves cost:

let a (nonstrict) = rhs in if True then t else ..a..

Without floating `a` into the `else` branch, it is compiled into (in pseudo-UPLC)

[(\a -&gt; if True then t else ..a..) (delay rhs)]

If we float `a` into the `else` branch, then it is compiled into

if True then t else [(\a -&gt; ..a..) rhs]

Since the `else` branch is not taken, the former incurs additional `LamAbs`, `Apply`
and `Delay` steps when evaluated by the CEK machine. Note that `rhs` itself is
evaluated the same number of times (i.e., zero time) in both cases.

And floating a binding inwards can also increases cost. Here's an example:

let a (nonstrict) = rhs in let b (nonstrict) = a in b+b

Because `b` is non-strict and occurs twice in the body, floating the definition of `a` into
the RHS of `b` will incur one more of each of these steps: `Delay`, `LamAbs` and `Apply`.

-------------------------------------------------------------------------------
4. When can floating-in increase costs?
-------------------------------------------------------------------------------

Floating-in a binding can increase cost only if the binding is originally outside of `X`,
and is floated into `X`, and `X` satisfies both of the following conditions:

(1) `X` is a lambda abstraction, a type abstraction, or the RHS of a non-strict binding
(recall that the RHS of a non-strict binding is equivalent to a type abstraction).

(2) `X` is in the RHS of a (either strict or non-strict) binding whose LHS is used more than once.

Note the &quot;only if&quot; - the above are the necessary conditions, but not sufficient. Also note
that this is in the context of the float-in pass itself. Floating a binding in /can/ affect
ther subsequent optimizations in a negative way (e.g., inlining).

Therefore, to avoid the possibility of float-in increasing costs, we should avoid
floating-in if the above conditions are met.

-------------------------------------------------------------------------------
5. Implementation of the float-in pass
-------------------------------------------------------------------------------

This float-in pass is a conservative optimization which tries to avoid increasing costs.
The implementation recurses into the top-level `Term` using the following context type:

data FloatInContext = FloatInContext
    { _ctxtInManyOccRhs :: Bool
    , _ctxtUsages       :: Usages.Usages
    }

`ctxtUsages` is the usage counts of variables, and `ctxtInManyOccRhs` is initially `False`.
`ctxtInManyOccRhs` is set to `True` if we descend into:

(1) The RHS of a binding whose LHS is used more than once
(2) The argument of an application, unless the function is a LamAbs whose bound variable
is used at most once, or a Builtin.

The value of `ctxtInManyOccRhs` is used as follows:

(1) When `ctxtInManyOccRhs = False`, we avoid descending into the RHS of a non-strict binding
whose LHS is used more than once, and we descend in all other cases;
(2) When `ctxtInManyOccRhs = True`, we additionally avoid descending into `LamAbs`, `TyAbs`,
and the RHS of a non-strict binding whose LHS is used only once.

-------------------------------------------------------------------------------
6. Relaxation of the float-in criteria
-------------------------------------------------------------------------------

Experimentation using our test suites indicates that the above criteria is too
conservative (there's no cost saving if we adhere to them). We relax the criteria
by allowing a binding to be floated into lambda abstractions or type abstractions,
even if they are in the RHS of a multi-use binding or the argument of an application.

Why does that make sense? Because, as said before, the savings created by float-in
comes from floating bindings into unused branches. A branch of an `if`-expression
is either a value, or a type abstraction (see Note [Case expressions and laziness]).
If it is a value and contains an unused variable, the unused variable is most likely
(if not always) behind a lambda abstraction or a type abstraction. Therefore, by
always allowing a binding to be floated into lambda/type abstractions, the chance
that it is floated into an unused branch is greatly increased.

The relaxation reduces the costs of several test cases (in one case, &quot;formulaBudget&quot;,
the saving is significant), although it does increase the cost of one test case (&quot;knightsBudget&quot;).

The relaxation is on by default, and can be turned off with flag `no-relaxed-float-in`
or flag `conservative-optimisation`.

-}</span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span class="hs-comment">-- | The uniques of all used variables in a term.</span><span>
</span><span id="line-167"></span><span class="hs-keyword">type</span><span> </span><span id="Uniques"><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#Uniques"><span class="hs-identifier hs-var">Uniques</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../../../containers/html/src"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Unique"><span class="hs-identifier hs-type">PLC.Unique</span></a></span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span class="hs-keyword">data</span><span> </span><span id="FloatInContext"><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#FloatInContext"><span class="hs-identifier hs-var">FloatInContext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="FloatInContext"><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#FloatInContext"><span class="hs-identifier hs-var">FloatInContext</span></a></span></span><span>
</span><span id="line-170"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="_ctxtInManyOccRhs"><span class="annot"><span class="annottext">FloatInContext -&gt; Bool
</span><a href="PlutusIR.Transform.LetFloatIn.html#_ctxtInManyOccRhs"><span class="hs-identifier hs-var hs-var">_ctxtInManyOccRhs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-171"></span><span>    </span><span class="hs-comment">-- ^ Whether we are in the RHS of a binding whose LHS is used more than once.</span><span>
</span><span id="line-172"></span><span>    </span><span class="hs-comment">-- See Note [Float-in] #5</span><span>
</span><span id="line-173"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_ctxtUsages"><span class="annot"><span class="annottext">FloatInContext -&gt; Usages
</span><a href="PlutusIR.Transform.LetFloatIn.html#_ctxtUsages"><span class="hs-identifier hs-var hs-var">_ctxtUsages</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusIR.Analysis.Usages.html#Usages"><span class="hs-identifier hs-type">Usages.Usages</span></a></span><span>
</span><span id="line-174"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_ctxtRelaxed"><span class="annot"><span class="annottext">FloatInContext -&gt; Bool
</span><a href="PlutusIR.Transform.LetFloatIn.html#_ctxtRelaxed"><span class="hs-identifier hs-var hs-var">_ctxtRelaxed</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-175"></span><span>    </span><span class="hs-comment">-- ^ Whether to float-in more aggressively. See Note [Float-in] #6</span><span>
</span><span id="line-176"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span id="ctxtUsages"><span id="ctxtRelaxed"><span id="ctxtInManyOccRhs"><span class="hs-identifier">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">FloatInContext</span></span></span></span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span class="hs-comment">-- | Float bindings in the given `Term` inwards.</span><span>
</span><span id="line-181"></span><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#floatTerm"><span class="hs-identifier hs-type">floatTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-182"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681156566"><span class="annot"><a href="#local-6989586621681156566"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621681156571"><span class="annot"><a href="#local-6989586621681156571"><span class="hs-identifier hs-type">tyname</span></a></span></span><span> </span><span id="local-6989586621681156574"><span class="annot"><a href="#local-6989586621681156574"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span id="local-6989586621681156569"><span class="annot"><a href="#local-6989586621681156569"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681156568"><span class="annot"><a href="#local-6989586621681156568"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621681156563"><span class="annot"><a href="#local-6989586621681156563"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-183"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="PlutusCore.Name.html#HasUnique"><span class="hs-identifier hs-type">PLC.HasUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156574"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TermUnique"><span class="hs-identifier hs-type">PLC.TermUnique</span></a></span><span>
</span><span id="line-184"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Name.html#HasUnique"><span class="hs-identifier hs-type">PLC.HasUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156571"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TypeUnique"><span class="hs-identifier hs-type">PLC.TypeUnique</span></a></span><span>
</span><span id="line-185"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Meaning.html#ToBuiltinMeaning"><span class="hs-identifier hs-type">PLC.ToBuiltinMeaning</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156569"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156568"><span class="hs-identifier hs-type">fun</span></a></span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Quote.html#MonadQuote"><span class="hs-identifier hs-type">PLC.MonadQuote</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156566"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-188"></span><span>    </span><span class="annot"><a href="PlutusCore.Builtin.Meaning.html#BuiltinVersion"><span class="hs-identifier hs-type">PLC.BuiltinVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156568"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-comment">-- | Whether to float-in more aggressively. See Note [Float-in] #6</span><span>
</span><span id="line-190"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-191"></span><span>    </span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156571"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156574"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156569"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156568"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156563"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-192"></span><span>    </span><span class="annot"><a href="#local-6989586621681156566"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156571"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156574"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156569"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156568"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156563"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span id="floatTerm"><span class="annot"><span class="annottext">floatTerm :: forall (m :: * -&gt; *) tyname name (uni :: * -&gt; *) fun a.
(HasUnique name TermUnique, HasUnique tyname TypeUnique,
 ToBuiltinMeaning uni fun, MonadQuote m) =&gt;
BuiltinVersion fun
-&gt; Bool
-&gt; Term tyname name uni fun a
-&gt; m (Term tyname name uni fun a)
</span><a href="PlutusIR.Transform.LetFloatIn.html#floatTerm"><span class="hs-identifier hs-var hs-var">floatTerm</span></a></span></span><span> </span><span id="local-6989586621681156200"><span class="annot"><span class="annottext">BuiltinVersion fun
</span><a href="#local-6989586621681156200"><span class="hs-identifier hs-var">ver</span></a></span></span><span> </span><span id="local-6989586621681156199"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681156199"><span class="hs-identifier hs-var">relaxed</span></a></span></span><span> </span><span id="local-6989586621681156198"><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681156198"><span class="hs-identifier hs-var">t0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-194"></span><span>    </span><span id="local-6989586621681156197"><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681156197"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *). (Rename a, MonadQuote m) =&gt; a -&gt; m a
</span><a href="PlutusCore.Rename.html#rename"><span class="hs-identifier hs-var">PLC.rename</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681156198"><span class="hs-identifier hs-var">t0</span></a></span><span>
</span><span id="line-195"></span><span>    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Usages
-&gt; Term tyname name uni fun a
-&gt; Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156194"><span class="hs-identifier hs-var">floatTermInner</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall name tyname (uni :: * -&gt; *) fun a.
(HasUnique name TermUnique, HasUnique tyname TypeUnique) =&gt;
Term tyname name uni fun a -&gt; Usages
</span><a href="PlutusIR.Analysis.Usages.html#termUsages"><span class="hs-identifier hs-var">Usages.termUsages</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681156197"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681156197"><span class="hs-identifier hs-var">t1</span></a></span><span>
</span><span id="line-196"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-197"></span><span>    </span><span class="annot"><a href="#local-6989586621681156194"><span class="hs-identifier hs-type">floatTermInner</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-198"></span><span>        </span><span class="annot"><a href="PlutusIR.Analysis.Usages.html#Usages"><span class="hs-identifier hs-type">Usages.Usages</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-199"></span><span>        </span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156571"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156574"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156569"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156568"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156563"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-200"></span><span>        </span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156571"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156574"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156569"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156568"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681156563"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#Uniques"><span class="hs-identifier hs-type">Uniques</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-201"></span><span>    </span><span id="local-6989586621681156194"><span class="annot"><span class="annottext">floatTermInner :: Usages
-&gt; Term tyname name uni fun a
-&gt; Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156194"><span class="hs-identifier hs-var hs-var">floatTermInner</span></a></span></span><span> </span><span id="local-6989586621681156192"><span class="annot"><span class="annottext">Usages
</span><a href="#local-6989586621681156192"><span class="hs-identifier hs-var">usgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a -&gt; Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156191"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-202"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-203"></span><span>        </span><span class="hs-comment">-- Float bindings in the given `Term` inwards, and annotate each term with the set of</span><span>
</span><span id="line-204"></span><span>        </span><span class="hs-comment">-- `Unique`s of used variables in the `Term`.</span><span>
</span><span id="line-205"></span><span>        </span><span class="annot"><a href="#local-6989586621681156191"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-206"></span><span>            </span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156571"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156574"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156569"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156568"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156563"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-207"></span><span>            </span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156571"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156574"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156569"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156568"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681156563"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#Uniques"><span class="hs-identifier hs-type">Uniques</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>        </span><span id="local-6989586621681156191"><span class="annot"><span class="annottext">go :: Term tyname name uni fun a -&gt; Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156191"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621681156190"><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681156190"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681156190"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-209"></span><span>            </span><span class="annot"><a href="PlutusIR.Core.Type.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span id="local-6989586621681156188"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156188"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681156187"><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681156187"><span class="hs-identifier hs-var">fun0</span></a></span></span><span> </span><span id="local-6989586621681156186"><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681156186"><span class="hs-identifier hs-var">arg0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-210"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681156185"><span class="annot"><span class="annottext">fun :: Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156185"><span class="hs-identifier hs-var hs-var">fun</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a -&gt; Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156191"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681156187"><span class="hs-identifier hs-var">fun0</span></a></span><span>
</span><span id="line-211"></span><span>                    </span><span id="local-6989586621681156184"><span class="annot"><span class="annottext">arg :: Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156184"><span class="hs-identifier hs-var hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a -&gt; Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156191"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681156186"><span class="hs-identifier hs-var">arg0</span></a></span><span>
</span><span id="line-212"></span><span>                    </span><span id="local-6989586621681156181"><span class="annot"><span class="annottext">us :: Uniques
</span><a href="#local-6989586621681156181"><span class="hs-identifier hs-var hs-var">us</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
Term tyname name uni fun (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#termUniqs"><span class="hs-identifier hs-var">termUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156185"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
Term tyname name uni fun (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#termUniqs"><span class="hs-identifier hs-var">termUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156184"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-213"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a
-&gt; Term tyname name uni fun a
-&gt; Term tyname name uni fun a
-&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156188"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681156181"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156185"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156184"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-214"></span><span>            </span><span class="annot"><a href="PlutusIR.Core.Type.html#LamAbs"><span class="hs-identifier hs-type">LamAbs</span></a></span><span> </span><span id="local-6989586621681156178"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156178"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681156177"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681156177"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681156176"><span class="annot"><span class="annottext">Type tyname uni a
</span><a href="#local-6989586621681156176"><span class="hs-identifier hs-var">ty0</span></a></span></span><span> </span><span id="local-6989586621681156175"><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681156175"><span class="hs-identifier hs-var">body0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-215"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681156174"><span class="annot"><span class="annottext">ty :: Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156174"><span class="hs-identifier hs-var hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type tyname uni a -&gt; Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156173"><span class="hs-identifier hs-var">goType</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni a
</span><a href="#local-6989586621681156176"><span class="hs-identifier hs-var">ty0</span></a></span><span>
</span><span id="line-216"></span><span>                    </span><span id="local-6989586621681156172"><span class="annot"><span class="annottext">body :: Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156172"><span class="hs-identifier hs-var hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a -&gt; Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156191"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681156175"><span class="hs-identifier hs-var">body0</span></a></span><span>
</span><span id="line-217"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a
-&gt; name
-&gt; Type tyname uni a
-&gt; Term tyname name uni fun a
-&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#LamAbs"><span class="hs-identifier hs-var">LamAbs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156178"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) a.
Type tyname uni (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#typeUniqs"><span class="hs-identifier hs-var">typeUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156174"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
Term tyname name uni fun (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#termUniqs"><span class="hs-identifier hs-var">termUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156172"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681156177"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156174"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156172"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-218"></span><span>            </span><span class="annot"><a href="PlutusIR.Core.Type.html#TyAbs"><span class="hs-identifier hs-type">TyAbs</span></a></span><span> </span><span id="local-6989586621681156169"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156169"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681156168"><span class="annot"><span class="annottext">tyname
</span><a href="#local-6989586621681156168"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681156167"><span class="annot"><span class="annottext">Kind a
</span><a href="#local-6989586621681156167"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621681156166"><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681156166"><span class="hs-identifier hs-var">body0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-219"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681156165"><span class="annot"><span class="annottext">body :: Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156165"><span class="hs-identifier hs-var hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a -&gt; Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156191"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681156166"><span class="hs-identifier hs-var">body0</span></a></span><span>
</span><span id="line-220"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a
-&gt; tyname
-&gt; Kind a
-&gt; Term tyname name uni fun a
-&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#TyAbs"><span class="hs-identifier hs-var">TyAbs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156169"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
Term tyname name uni fun (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#termUniqs"><span class="hs-identifier hs-var">termUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156165"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">tyname
</span><a href="#local-6989586621681156168"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f (a, Uniques)
</span><a href="PlutusIR.Transform.LetFloatIn.html#noUniq"><span class="hs-identifier hs-var">noUniq</span></a></span><span> </span><span class="annot"><span class="annottext">Kind a
</span><a href="#local-6989586621681156167"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156165"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-221"></span><span>            </span><span class="annot"><a href="PlutusIR.Core.Type.html#TyInst"><span class="hs-identifier hs-type">TyInst</span></a></span><span> </span><span id="local-6989586621681156162"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156162"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681156161"><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681156161"><span class="hs-identifier hs-var">body0</span></a></span></span><span> </span><span id="local-6989586621681156160"><span class="annot"><span class="annottext">Type tyname uni a
</span><a href="#local-6989586621681156160"><span class="hs-identifier hs-var">ty0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-222"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681156159"><span class="annot"><span class="annottext">body :: Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156159"><span class="hs-identifier hs-var hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a -&gt; Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156191"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681156161"><span class="hs-identifier hs-var">body0</span></a></span><span>
</span><span id="line-223"></span><span>                    </span><span id="local-6989586621681156158"><span class="annot"><span class="annottext">ty :: Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156158"><span class="hs-identifier hs-var hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type tyname uni a -&gt; Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156173"><span class="hs-identifier hs-var">goType</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni a
</span><a href="#local-6989586621681156160"><span class="hs-identifier hs-var">ty0</span></a></span><span>
</span><span id="line-224"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a
-&gt; Term tyname name uni fun a
-&gt; Type tyname uni a
-&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#TyInst"><span class="hs-identifier hs-var">TyInst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156162"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
Term tyname name uni fun (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#termUniqs"><span class="hs-identifier hs-var">termUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156159"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) a.
Type tyname uni (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#typeUniqs"><span class="hs-identifier hs-var">typeUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156158"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156159"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156158"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-225"></span><span>            </span><span class="annot"><a href="PlutusIR.Core.Type.html#IWrap"><span class="hs-identifier hs-type">IWrap</span></a></span><span> </span><span id="local-6989586621681156156"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156156"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681156155"><span class="annot"><span class="annottext">Type tyname uni a
</span><a href="#local-6989586621681156155"><span class="hs-identifier hs-var">patTy0</span></a></span></span><span> </span><span id="local-6989586621681156154"><span class="annot"><span class="annottext">Type tyname uni a
</span><a href="#local-6989586621681156154"><span class="hs-identifier hs-var">argTy0</span></a></span></span><span> </span><span id="local-6989586621681156153"><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681156153"><span class="hs-identifier hs-var">body0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-226"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681156152"><span class="annot"><span class="annottext">patTy :: Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156152"><span class="hs-identifier hs-var hs-var">patTy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type tyname uni a -&gt; Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156173"><span class="hs-identifier hs-var">goType</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni a
</span><a href="#local-6989586621681156155"><span class="hs-identifier hs-var">patTy0</span></a></span><span>
</span><span id="line-227"></span><span>                    </span><span id="local-6989586621681156151"><span class="annot"><span class="annottext">argTy :: Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156151"><span class="hs-identifier hs-var hs-var">argTy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type tyname uni a -&gt; Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156173"><span class="hs-identifier hs-var">goType</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni a
</span><a href="#local-6989586621681156154"><span class="hs-identifier hs-var">argTy0</span></a></span><span>
</span><span id="line-228"></span><span>                    </span><span id="local-6989586621681156150"><span class="annot"><span class="annottext">body :: Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156150"><span class="hs-identifier hs-var hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a -&gt; Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156191"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681156153"><span class="hs-identifier hs-var">body0</span></a></span><span>
</span><span id="line-229"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a
-&gt; Type tyname uni a
-&gt; Type tyname uni a
-&gt; Term tyname name uni fun a
-&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#IWrap"><span class="hs-identifier hs-var">IWrap</span></a></span><span>
</span><span id="line-230"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156156"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) a.
Type tyname uni (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#typeUniqs"><span class="hs-identifier hs-var">typeUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156152"><span class="hs-identifier hs-var">patTy</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) a.
Type tyname uni (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#typeUniqs"><span class="hs-identifier hs-var">typeUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156151"><span class="hs-identifier hs-var">argTy</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
Term tyname name uni fun (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#termUniqs"><span class="hs-identifier hs-var">termUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156150"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span>                        </span><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156152"><span class="hs-identifier hs-var">patTy</span></a></span><span>
</span><span id="line-232"></span><span>                        </span><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156151"><span class="hs-identifier hs-var">argTy</span></a></span><span>
</span><span id="line-233"></span><span>                        </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156150"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-234"></span><span>            </span><span class="annot"><a href="PlutusIR.Core.Type.html#Unwrap"><span class="hs-identifier hs-type">Unwrap</span></a></span><span> </span><span id="local-6989586621681156148"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156148"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681156147"><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681156147"><span class="hs-identifier hs-var">body0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-235"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681156146"><span class="annot"><span class="annottext">body :: Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156146"><span class="hs-identifier hs-var hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a -&gt; Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156191"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681156147"><span class="hs-identifier hs-var">body0</span></a></span><span>
</span><span id="line-236"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a -&gt; Term tyname name uni fun a -&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#Unwrap"><span class="hs-identifier hs-var">Unwrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156148"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
Term tyname name uni fun (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#termUniqs"><span class="hs-identifier hs-var">termUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156146"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156146"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-237"></span><span>            </span><span class="annot"><a href="PlutusIR.Core.Type.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span id="local-6989586621681156144"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156144"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><span class="annottext">Recursivity
</span><a href="PlutusIR.Core.Type.html#NonRec"><span class="hs-identifier hs-var">NonRec</span></a></span><span> </span><span id="local-6989586621681156142"><span class="annot"><span class="annottext">NonEmpty (Binding tyname name uni fun a)
</span><a href="#local-6989586621681156142"><span class="hs-identifier hs-var">bs0</span></a></span></span><span> </span><span id="local-6989586621681156141"><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681156141"><span class="hs-identifier hs-var">body0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-238"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681156138"><span class="annot"><span class="annottext">bs :: NonEmpty (Binding tyname name uni fun (a, Uniques))
</span><a href="#local-6989586621681156138"><span class="hs-identifier hs-var hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Binding tyname name uni fun a
-&gt; Binding tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156137"><span class="hs-identifier hs-var">goBinding</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Binding tyname name uni fun a)
</span><a href="#local-6989586621681156142"><span class="hs-identifier hs-var">bs0</span></a></span><span>
</span><span id="line-239"></span><span>                    </span><span id="local-6989586621681156135"><span class="annot"><span class="annottext">body :: Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156135"><span class="hs-identifier hs-var hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a -&gt; Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156191"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681156141"><span class="hs-identifier hs-var">body0</span></a></span><span>
</span><span id="line-240"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="hs-comment">-- The bindings in `bs` should be processed from right to left, since</span><span>
</span><span id="line-241"></span><span>                    </span><span class="hs-comment">-- a binding may depend on another binding to its left.</span><span>
</span><span id="line-242"></span><span>                    </span><span class="hs-comment">-- e.g. let x = 1; y = x in ... y ...</span><span>
</span><span id="line-243"></span><span>                    </span><span class="hs-comment">-- we want to float y in first otherwise it will block us from floating in x</span><span>
</span><span id="line-244"></span><span>                    </span><span class="annot"><span class="annottext">forall r a. Reader r a -&gt; r -&gt; a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">runReader</span></a></span><span>
</span><span id="line-245"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; b -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">foldrM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
(HasUnique name TermUnique, HasUnique tyname TypeUnique,
 ToBuiltinMeaning uni fun) =&gt;
BuiltinVersion fun
-&gt; a
-&gt; Binding tyname name uni fun (a, Uniques)
-&gt; Term tyname name uni fun (a, Uniques)
-&gt; Reader FloatInContext (Term tyname name uni fun (a, Uniques))
</span><a href="PlutusIR.Transform.LetFloatIn.html#floatInBinding"><span class="hs-identifier hs-var">floatInBinding</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinVersion fun
</span><a href="#local-6989586621681156200"><span class="hs-identifier hs-var">ver</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156144"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156135"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Binding tyname name uni fun (a, Uniques))
</span><a href="#local-6989586621681156138"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Usages -&gt; Bool -&gt; FloatInContext
</span><a href="PlutusIR.Transform.LetFloatIn.html#FloatInContext"><span class="hs-identifier hs-var">FloatInContext</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="annot"><span class="annottext">Usages
</span><a href="#local-6989586621681156192"><span class="hs-identifier hs-var">usgs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681156199"><span class="hs-identifier hs-var">relaxed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span>            </span><span class="annot"><a href="PlutusIR.Core.Type.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span id="local-6989586621681156132"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156132"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><span class="annottext">Recursivity
</span><a href="PlutusIR.Core.Type.html#Rec"><span class="hs-identifier hs-var">Rec</span></a></span><span> </span><span id="local-6989586621681156130"><span class="annot"><span class="annottext">NonEmpty (Binding tyname name uni fun a)
</span><a href="#local-6989586621681156130"><span class="hs-identifier hs-var">bs0</span></a></span></span><span> </span><span id="local-6989586621681156129"><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681156129"><span class="hs-identifier hs-var">body0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-248"></span><span>                </span><span class="hs-comment">-- Currently we don't move recursive bindings, so we simply descend into the body.</span><span>
</span><span id="line-249"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681156127"><span class="annot"><span class="annottext">bs :: NonEmpty (Binding tyname name uni fun (a, Uniques))
</span><a href="#local-6989586621681156127"><span class="hs-identifier hs-var hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Binding tyname name uni fun a
-&gt; Binding tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156137"><span class="hs-identifier hs-var">goBinding</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Binding tyname name uni fun a)
</span><a href="#local-6989586621681156130"><span class="hs-identifier hs-var">bs0</span></a></span><span>
</span><span id="line-250"></span><span>                    </span><span id="local-6989586621681156126"><span class="annot"><span class="annottext">body :: Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156126"><span class="hs-identifier hs-var hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a -&gt; Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156191"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681156129"><span class="hs-identifier hs-var">body0</span></a></span><span>
</span><span id="line-251"></span><span>                    </span><span id="local-6989586621681156121"><span class="annot"><span class="annottext">us :: Uniques
</span><a href="#local-6989586621681156121"><span class="hs-identifier hs-var hs-var">us</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
Term tyname name uni fun (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#termUniqs"><span class="hs-identifier hs-var">termUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156126"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">foldMap</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
Binding tyname name uni fun (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#bindingUniqs"><span class="hs-identifier hs-var">bindingUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Binding tyname name uni fun (a, Uniques))
</span><a href="#local-6989586621681156127"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-252"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a
-&gt; Recursivity
-&gt; NonEmpty (Binding tyname name uni fun a)
-&gt; Term tyname name uni fun a
-&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156132"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681156121"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Recursivity
</span><a href="PlutusIR.Core.Type.html#Rec"><span class="hs-identifier hs-var">Rec</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Binding tyname name uni fun (a, Uniques))
</span><a href="#local-6989586621681156127"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156126"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-253"></span><span>            </span><span class="annot"><a href="PlutusIR.Core.Type.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621681156117"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156117"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681156116"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681156116"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a -&gt; name -&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#Var"><span class="hs-identifier hs-var">Var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156117"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.singleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681156116"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../../../../lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall name unique. HasUnique name unique =&gt; Lens' name Unique
</span><a href="PlutusCore.Name.html#theUnique"><span class="hs-identifier hs-var">PLC.theUnique</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681156116"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-254"></span><span>            </span><span class="annot"><a href="PlutusIR.Core.Type.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span id="local-6989586621681156111"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156111"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681156110"><span class="annot"><span class="annottext">Type tyname uni a
</span><a href="#local-6989586621681156110"><span class="hs-identifier hs-var">ty0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-255"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681156109"><span class="annot"><span class="annottext">ty :: Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156109"><span class="hs-identifier hs-var hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type tyname uni a -&gt; Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156173"><span class="hs-identifier hs-var">goType</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni a
</span><a href="#local-6989586621681156110"><span class="hs-identifier hs-var">ty0</span></a></span><span>
</span><span id="line-256"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a -&gt; Type tyname uni a -&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#Error"><span class="hs-identifier hs-var">Error</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156111"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) a.
Type tyname uni (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#typeUniqs"><span class="hs-identifier hs-var">typeUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156109"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156109"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-257"></span><span>            </span><span class="annot"><a href="PlutusIR.Core.Type.html#Constant"><span class="hs-identifier hs-type">Constant</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f (a, Uniques)
</span><a href="PlutusIR.Transform.LetFloatIn.html#noUniq"><span class="hs-identifier hs-var">noUniq</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681156190"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-258"></span><span>            </span><span class="annot"><a href="PlutusIR.Core.Type.html#Builtin"><span class="hs-identifier hs-type">Builtin</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f (a, Uniques)
</span><a href="PlutusIR.Transform.LetFloatIn.html#noUniq"><span class="hs-identifier hs-var">noUniq</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681156190"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-259"></span><span>
</span><span id="line-260"></span><span>        </span><span class="hs-comment">-- Float bindings in the given `Binding` inwards, and calculate the set of</span><span>
</span><span id="line-261"></span><span>        </span><span class="hs-comment">-- `Unique`s of used variables in the result `Binding`.</span><span>
</span><span id="line-262"></span><span>        </span><span class="annot"><a href="#local-6989586621681156137"><span class="hs-identifier hs-type">goBinding</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-263"></span><span>            </span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156571"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156574"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156569"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156568"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156563"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-264"></span><span>            </span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156571"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156574"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156569"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156568"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681156563"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#Uniques"><span class="hs-identifier hs-type">Uniques</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span>        </span><span id="local-6989586621681156137"><span class="annot"><span class="annottext">goBinding :: Binding tyname name uni fun a
-&gt; Binding tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156137"><span class="hs-identifier hs-var hs-var">goBinding</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-266"></span><span>            </span><span class="annot"><a href="PlutusIR.Core.Type.html#TermBind"><span class="hs-identifier hs-type">TermBind</span></a></span><span> </span><span id="local-6989586621681156105"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156105"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681156104"><span class="annot"><span class="annottext">Strictness
</span><a href="#local-6989586621681156104"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621681156103"><span class="annot"><span class="annottext">VarDecl tyname name uni a
</span><a href="#local-6989586621681156103"><span class="hs-identifier hs-var">var0</span></a></span></span><span> </span><span id="local-6989586621681156102"><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681156102"><span class="hs-identifier hs-var">rhs0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-267"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681156101"><span class="annot"><span class="annottext">var :: VarDecl tyname name uni (a, Uniques)
</span><a href="#local-6989586621681156101"><span class="hs-identifier hs-var hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarDecl tyname name uni a -&gt; VarDecl tyname name uni (a, Uniques)
</span><a href="#local-6989586621681156100"><span class="hs-identifier hs-var">goVarDecl</span></a></span><span> </span><span class="annot"><span class="annottext">VarDecl tyname name uni a
</span><a href="#local-6989586621681156103"><span class="hs-identifier hs-var">var0</span></a></span><span>
</span><span id="line-268"></span><span>                    </span><span id="local-6989586621681156099"><span class="annot"><span class="annottext">rhs :: Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156099"><span class="hs-identifier hs-var hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a -&gt; Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156191"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681156102"><span class="hs-identifier hs-var">rhs0</span></a></span><span>
</span><span id="line-269"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a
-&gt; Strictness
-&gt; VarDecl tyname name uni a
-&gt; Term tyname name uni fun a
-&gt; Binding tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#TermBind"><span class="hs-identifier hs-var">TermBind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156105"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
Term tyname name uni fun (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#termUniqs"><span class="hs-identifier hs-var">termUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156099"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) a.
VarDecl tyname name uni (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#varDeclUniqs"><span class="hs-identifier hs-var">varDeclUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">VarDecl tyname name uni (a, Uniques)
</span><a href="#local-6989586621681156101"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Strictness
</span><a href="#local-6989586621681156104"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">VarDecl tyname name uni (a, Uniques)
</span><a href="#local-6989586621681156101"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681156099"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-270"></span><span>            </span><span class="annot"><a href="PlutusIR.Core.Type.html#TypeBind"><span class="hs-identifier hs-type">TypeBind</span></a></span><span> </span><span id="local-6989586621681156096"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156096"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681156095"><span class="annot"><span class="annottext">TyVarDecl tyname a
</span><a href="#local-6989586621681156095"><span class="hs-identifier hs-var">tvar</span></a></span></span><span> </span><span id="local-6989586621681156094"><span class="annot"><span class="annottext">Type tyname uni a
</span><a href="#local-6989586621681156094"><span class="hs-identifier hs-var">rhs0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-271"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681156093"><span class="annot"><span class="annottext">rhs :: Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156093"><span class="hs-identifier hs-var hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type tyname uni a -&gt; Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156173"><span class="hs-identifier hs-var">goType</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni a
</span><a href="#local-6989586621681156094"><span class="hs-identifier hs-var">rhs0</span></a></span><span>
</span><span id="line-272"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="hs-comment">-- A `TyVarDecl` does not use any variable, hence `noUniq`.</span><span>
</span><span id="line-273"></span><span>                    </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a
-&gt; TyVarDecl tyname a
-&gt; Type tyname uni a
-&gt; Binding tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#TypeBind"><span class="hs-identifier hs-var">TypeBind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156096"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) a.
Type tyname uni (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#typeUniqs"><span class="hs-identifier hs-var">typeUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156093"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f (a, Uniques)
</span><a href="PlutusIR.Transform.LetFloatIn.html#noUniq"><span class="hs-identifier hs-var">noUniq</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarDecl tyname a
</span><a href="#local-6989586621681156095"><span class="hs-identifier hs-var">tvar</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156093"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-274"></span><span>            </span><span class="annot"><a href="PlutusIR.Core.Type.html#DatatypeBind"><span class="hs-identifier hs-type">DatatypeBind</span></a></span><span> </span><span id="local-6989586621681156091"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156091"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Datatype"><span class="hs-identifier hs-type">Datatype</span></a></span><span> </span><span id="local-6989586621681156089"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156089"><span class="hs-identifier hs-var">a'</span></a></span></span><span> </span><span id="local-6989586621681156088"><span class="annot"><span class="annottext">TyVarDecl tyname a
</span><a href="#local-6989586621681156088"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621681156087"><span class="annot"><span class="annottext">[TyVarDecl tyname a]
</span><a href="#local-6989586621681156087"><span class="hs-identifier hs-var">tvs</span></a></span></span><span> </span><span id="local-6989586621681156086"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681156086"><span class="hs-identifier hs-var">destr</span></a></span></span><span> </span><span id="local-6989586621681156085"><span class="annot"><span class="annottext">[VarDecl tyname name uni a]
</span><a href="#local-6989586621681156085"><span class="hs-identifier hs-var">constrs0</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-275"></span><span>                </span><span class="hs-comment">-- The constructors in a `Datatype` may use type variables.</span><span>
</span><span id="line-276"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681156083"><span class="annot"><span class="annottext">constrs :: [VarDecl tyname name uni (a, Uniques)]
</span><a href="#local-6989586621681156083"><span class="hs-identifier hs-var hs-var">constrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarDecl tyname name uni a -&gt; VarDecl tyname name uni (a, Uniques)
</span><a href="#local-6989586621681156100"><span class="hs-identifier hs-var">goVarDecl</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[VarDecl tyname name uni a]
</span><a href="#local-6989586621681156085"><span class="hs-identifier hs-var">constrs0</span></a></span><span>
</span><span id="line-277"></span><span>                    </span><span id="local-6989586621681156078"><span class="annot"><span class="annottext">us :: Uniques
</span><a href="#local-6989586621681156078"><span class="hs-identifier hs-var hs-var">us</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">foldMap</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) a.
VarDecl tyname name uni (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#varDeclUniqs"><span class="hs-identifier hs-var">varDeclUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">[VarDecl tyname name uni (a, Uniques)]
</span><a href="#local-6989586621681156083"><span class="hs-identifier hs-var">constrs</span></a></span><span>
</span><span id="line-278"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a -&gt; Datatype tyname name uni a -&gt; Binding tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#DatatypeBind"><span class="hs-identifier hs-var">DatatypeBind</span></a></span><span>
</span><span id="line-279"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156091"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681156078"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) a.
a
-&gt; TyVarDecl tyname a
-&gt; [TyVarDecl tyname a]
-&gt; name
-&gt; [VarDecl tyname name uni a]
-&gt; Datatype tyname name uni a
</span><a href="PlutusIR.Core.Type.html#Datatype"><span class="hs-identifier hs-var">Datatype</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156089"><span class="hs-identifier hs-var">a'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681156078"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f (a, Uniques)
</span><a href="PlutusIR.Transform.LetFloatIn.html#noUniq"><span class="hs-identifier hs-var">noUniq</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarDecl tyname a
</span><a href="#local-6989586621681156088"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f (a, Uniques)
</span><a href="PlutusIR.Transform.LetFloatIn.html#noUniq"><span class="hs-identifier hs-var">noUniq</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarDecl tyname a]
</span><a href="#local-6989586621681156087"><span class="hs-identifier hs-var">tvs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681156086"><span class="hs-identifier hs-var">destr</span></a></span><span> </span><span class="annot"><span class="annottext">[VarDecl tyname name uni (a, Uniques)]
</span><a href="#local-6989586621681156083"><span class="hs-identifier hs-var">constrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span>        </span><span class="hs-comment">-- Calculate the set of `Unique`s of used variables in a `Type`.</span><span>
</span><span id="line-283"></span><span>        </span><span class="annot"><a href="#local-6989586621681156173"><span class="hs-identifier hs-type">goType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156571"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156569"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156563"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156571"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156569"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681156563"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#Uniques"><span class="hs-identifier hs-type">Uniques</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-284"></span><span>        </span><span id="local-6989586621681156173"><span class="annot"><span class="annottext">goType :: Type tyname uni a -&gt; Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156173"><span class="hs-identifier hs-var hs-var">goType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-285"></span><span>            </span><span class="annot"><a href="PlutusCore.Core.Type.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span id="local-6989586621681156076"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156076"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681156075"><span class="annot"><span class="annottext">tyname
</span><a href="#local-6989586621681156075"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann.
ann -&gt; tyname -&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyVar"><span class="hs-identifier hs-var">TyVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156076"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.singleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">tyname
</span><a href="#local-6989586621681156075"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../../../../lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">forall name unique. HasUnique name unique =&gt; Lens' name Unique
</span><a href="PlutusCore.Name.html#theUnique"><span class="hs-identifier hs-var">PLC.theUnique</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">tyname
</span><a href="#local-6989586621681156075"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-286"></span><span>            </span><span class="annot"><a href="PlutusCore.Core.Type.html#TyFun"><span class="hs-identifier hs-type">TyFun</span></a></span><span> </span><span id="local-6989586621681156073"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156073"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681156072"><span class="annot"><span class="annottext">Type tyname uni a
</span><a href="#local-6989586621681156072"><span class="hs-identifier hs-var">argTy0</span></a></span></span><span> </span><span id="local-6989586621681156071"><span class="annot"><span class="annottext">Type tyname uni a
</span><a href="#local-6989586621681156071"><span class="hs-identifier hs-var">resTy0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-287"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681156070"><span class="annot"><span class="annottext">argTy :: Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156070"><span class="hs-identifier hs-var hs-var">argTy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type tyname uni a -&gt; Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156173"><span class="hs-identifier hs-var">goType</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni a
</span><a href="#local-6989586621681156072"><span class="hs-identifier hs-var">argTy0</span></a></span><span>
</span><span id="line-288"></span><span>                    </span><span id="local-6989586621681156069"><span class="annot"><span class="annottext">resTy :: Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156069"><span class="hs-identifier hs-var hs-var">resTy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type tyname uni a -&gt; Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156173"><span class="hs-identifier hs-var">goType</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni a
</span><a href="#local-6989586621681156071"><span class="hs-identifier hs-var">resTy0</span></a></span><span>
</span><span id="line-289"></span><span>                    </span><span id="local-6989586621681156066"><span class="annot"><span class="annottext">us :: Uniques
</span><a href="#local-6989586621681156066"><span class="hs-identifier hs-var hs-var">us</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) a.
Type tyname uni (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#typeUniqs"><span class="hs-identifier hs-var">typeUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156070"><span class="hs-identifier hs-var">argTy</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) a.
Type tyname uni (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#typeUniqs"><span class="hs-identifier hs-var">typeUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156069"><span class="hs-identifier hs-var">resTy</span></a></span><span>
</span><span id="line-290"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann.
ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyFun"><span class="hs-identifier hs-var">TyFun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156073"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681156066"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156070"><span class="hs-identifier hs-var">argTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156069"><span class="hs-identifier hs-var">resTy</span></a></span><span>
</span><span id="line-291"></span><span>            </span><span class="annot"><a href="PlutusCore.Core.Type.html#TyIFix"><span class="hs-identifier hs-type">TyIFix</span></a></span><span> </span><span id="local-6989586621681156064"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156064"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681156063"><span class="annot"><span class="annottext">Type tyname uni a
</span><a href="#local-6989586621681156063"><span class="hs-identifier hs-var">patTy0</span></a></span></span><span> </span><span id="local-6989586621681156062"><span class="annot"><span class="annottext">Type tyname uni a
</span><a href="#local-6989586621681156062"><span class="hs-identifier hs-var">argTy0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-292"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681156061"><span class="annot"><span class="annottext">patTy :: Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156061"><span class="hs-identifier hs-var hs-var">patTy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type tyname uni a -&gt; Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156173"><span class="hs-identifier hs-var">goType</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni a
</span><a href="#local-6989586621681156063"><span class="hs-identifier hs-var">patTy0</span></a></span><span>
</span><span id="line-293"></span><span>                    </span><span id="local-6989586621681156060"><span class="annot"><span class="annottext">argTy :: Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156060"><span class="hs-identifier hs-var hs-var">argTy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type tyname uni a -&gt; Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156173"><span class="hs-identifier hs-var">goType</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni a
</span><a href="#local-6989586621681156062"><span class="hs-identifier hs-var">argTy0</span></a></span><span>
</span><span id="line-294"></span><span>                    </span><span id="local-6989586621681156057"><span class="annot"><span class="annottext">us :: Uniques
</span><a href="#local-6989586621681156057"><span class="hs-identifier hs-var hs-var">us</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) a.
Type tyname uni (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#typeUniqs"><span class="hs-identifier hs-var">typeUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156061"><span class="hs-identifier hs-var">patTy</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) a.
Type tyname uni (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#typeUniqs"><span class="hs-identifier hs-var">typeUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156060"><span class="hs-identifier hs-var">argTy</span></a></span><span>
</span><span id="line-295"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann.
ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyIFix"><span class="hs-identifier hs-var">TyIFix</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156064"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681156057"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156061"><span class="hs-identifier hs-var">patTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156060"><span class="hs-identifier hs-var">argTy</span></a></span><span>
</span><span id="line-296"></span><span>            </span><span class="annot"><a href="PlutusCore.Core.Type.html#TyForall"><span class="hs-identifier hs-type">TyForall</span></a></span><span> </span><span id="local-6989586621681156055"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156055"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681156054"><span class="annot"><span class="annottext">tyname
</span><a href="#local-6989586621681156054"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681156053"><span class="annot"><span class="annottext">Kind a
</span><a href="#local-6989586621681156053"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621681156052"><span class="annot"><span class="annottext">Type tyname uni a
</span><a href="#local-6989586621681156052"><span class="hs-identifier hs-var">bodyTy0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-297"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681156051"><span class="annot"><span class="annottext">bodyTy :: Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156051"><span class="hs-identifier hs-var hs-var">bodyTy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type tyname uni a -&gt; Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156173"><span class="hs-identifier hs-var">goType</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni a
</span><a href="#local-6989586621681156052"><span class="hs-identifier hs-var">bodyTy0</span></a></span><span>
</span><span id="line-298"></span><span>                    </span><span id="local-6989586621681156050"><span class="annot"><span class="annottext">us :: Uniques
</span><a href="#local-6989586621681156050"><span class="hs-identifier hs-var hs-var">us</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) a.
Type tyname uni (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#typeUniqs"><span class="hs-identifier hs-var">typeUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156051"><span class="hs-identifier hs-var">bodyTy</span></a></span><span>
</span><span id="line-299"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann.
ann
-&gt; tyname -&gt; Kind ann -&gt; Type tyname uni ann -&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyForall"><span class="hs-identifier hs-var">TyForall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156055"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681156050"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">tyname
</span><a href="#local-6989586621681156054"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f (a, Uniques)
</span><a href="PlutusIR.Transform.LetFloatIn.html#noUniq"><span class="hs-identifier hs-var">noUniq</span></a></span><span> </span><span class="annot"><span class="annottext">Kind a
</span><a href="#local-6989586621681156053"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156051"><span class="hs-identifier hs-var">bodyTy</span></a></span><span>
</span><span id="line-300"></span><span>            </span><span class="annot"><a href="PlutusCore.Core.Type.html#TyBuiltin"><span class="hs-identifier hs-type">TyBuiltin</span></a></span><span> </span><span id="local-6989586621681156048"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156048"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681156047"><span class="annot"><span class="annottext">SomeTypeIn uni
</span><a href="#local-6989586621681156047"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann.
ann -&gt; SomeTypeIn uni -&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyBuiltin"><span class="hs-identifier hs-var">TyBuiltin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156048"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SomeTypeIn uni
</span><a href="#local-6989586621681156047"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-301"></span><span>            </span><span class="annot"><a href="PlutusCore.Core.Type.html#TyLam"><span class="hs-identifier hs-type">TyLam</span></a></span><span> </span><span id="local-6989586621681156045"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156045"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681156044"><span class="annot"><span class="annottext">tyname
</span><a href="#local-6989586621681156044"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681156043"><span class="annot"><span class="annottext">Kind a
</span><a href="#local-6989586621681156043"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621681156042"><span class="annot"><span class="annottext">Type tyname uni a
</span><a href="#local-6989586621681156042"><span class="hs-identifier hs-var">bodyTy0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-302"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681156041"><span class="annot"><span class="annottext">bodyTy :: Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156041"><span class="hs-identifier hs-var hs-var">bodyTy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type tyname uni a -&gt; Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156173"><span class="hs-identifier hs-var">goType</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni a
</span><a href="#local-6989586621681156042"><span class="hs-identifier hs-var">bodyTy0</span></a></span><span>
</span><span id="line-303"></span><span>                    </span><span id="local-6989586621681156040"><span class="annot"><span class="annottext">us :: Uniques
</span><a href="#local-6989586621681156040"><span class="hs-identifier hs-var hs-var">us</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) a.
Type tyname uni (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#typeUniqs"><span class="hs-identifier hs-var">typeUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156041"><span class="hs-identifier hs-var">bodyTy</span></a></span><span>
</span><span id="line-304"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann.
ann
-&gt; tyname -&gt; Kind ann -&gt; Type tyname uni ann -&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyLam"><span class="hs-identifier hs-var">TyLam</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156045"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681156040"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">tyname
</span><a href="#local-6989586621681156044"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f (a, Uniques)
</span><a href="PlutusIR.Transform.LetFloatIn.html#noUniq"><span class="hs-identifier hs-var">noUniq</span></a></span><span> </span><span class="annot"><span class="annottext">Kind a
</span><a href="#local-6989586621681156043"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156041"><span class="hs-identifier hs-var">bodyTy</span></a></span><span>
</span><span id="line-305"></span><span>            </span><span class="annot"><a href="PlutusCore.Core.Type.html#TyApp"><span class="hs-identifier hs-type">TyApp</span></a></span><span> </span><span id="local-6989586621681156038"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156038"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681156037"><span class="annot"><span class="annottext">Type tyname uni a
</span><a href="#local-6989586621681156037"><span class="hs-identifier hs-var">funTy0</span></a></span></span><span> </span><span id="local-6989586621681156036"><span class="annot"><span class="annottext">Type tyname uni a
</span><a href="#local-6989586621681156036"><span class="hs-identifier hs-var">argTy0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-306"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681156035"><span class="annot"><span class="annottext">funTy :: Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156035"><span class="hs-identifier hs-var hs-var">funTy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type tyname uni a -&gt; Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156173"><span class="hs-identifier hs-var">goType</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni a
</span><a href="#local-6989586621681156037"><span class="hs-identifier hs-var">funTy0</span></a></span><span>
</span><span id="line-307"></span><span>                    </span><span id="local-6989586621681156034"><span class="annot"><span class="annottext">argTy :: Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156034"><span class="hs-identifier hs-var hs-var">argTy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type tyname uni a -&gt; Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156173"><span class="hs-identifier hs-var">goType</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni a
</span><a href="#local-6989586621681156036"><span class="hs-identifier hs-var">argTy0</span></a></span><span>
</span><span id="line-308"></span><span>                    </span><span id="local-6989586621681156031"><span class="annot"><span class="annottext">us :: Uniques
</span><a href="#local-6989586621681156031"><span class="hs-identifier hs-var hs-var">us</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) a.
Type tyname uni (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#typeUniqs"><span class="hs-identifier hs-var">typeUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156035"><span class="hs-identifier hs-var">funTy</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) a.
Type tyname uni (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#typeUniqs"><span class="hs-identifier hs-var">typeUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156034"><span class="hs-identifier hs-var">argTy</span></a></span><span>
</span><span id="line-309"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann.
ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyApp"><span class="hs-identifier hs-var">TyApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156038"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681156031"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156035"><span class="hs-identifier hs-var">funTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156034"><span class="hs-identifier hs-var">argTy</span></a></span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span>        </span><span class="hs-comment">-- Calculate the set of `Unique`s of used variables in a `VarDecl`.</span><span>
</span><span id="line-312"></span><span>        </span><span class="hs-comment">-- The type of the declared variable may use type variables.</span><span>
</span><span id="line-313"></span><span>        </span><span class="annot"><a href="#local-6989586621681156100"><span class="hs-identifier hs-type">goVarDecl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusCore.Core.Type.html#VarDecl"><span class="hs-identifier hs-type">VarDecl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156571"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156574"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156569"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156563"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Core.Type.html#VarDecl"><span class="hs-identifier hs-type">VarDecl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156571"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156574"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156569"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681156563"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#Uniques"><span class="hs-identifier hs-type">Uniques</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-314"></span><span>        </span><span id="local-6989586621681156100"><span class="annot"><span class="annottext">goVarDecl :: VarDecl tyname name uni a -&gt; VarDecl tyname name uni (a, Uniques)
</span><a href="#local-6989586621681156100"><span class="hs-identifier hs-var hs-var">goVarDecl</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#VarDecl"><span class="hs-identifier hs-type">VarDecl</span></a></span><span> </span><span id="local-6989586621681156029"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156029"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681156028"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681156028"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681156027"><span class="annot"><span class="annottext">Type tyname uni a
</span><a href="#local-6989586621681156027"><span class="hs-identifier hs-var">ty0</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) ann.
ann -&gt; name -&gt; Type tyname uni ann -&gt; VarDecl tyname name uni ann
</span><a href="PlutusCore.Core.Type.html#VarDecl"><span class="hs-identifier hs-var">VarDecl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156029"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) a.
Type tyname uni (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#typeUniqs"><span class="hs-identifier hs-var">typeUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156026"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681156028"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156026"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-315"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-316"></span><span>            </span><span id="local-6989586621681156026"><span class="annot"><span class="annottext">ty :: Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156026"><span class="hs-identifier hs-var hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type tyname uni a -&gt; Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681156173"><span class="hs-identifier hs-var">goType</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni a
</span><a href="#local-6989586621681156027"><span class="hs-identifier hs-var">ty0</span></a></span><span>
</span><span id="line-317"></span><span>
</span><span id="line-318"></span><span class="hs-comment">-- | The set of `Unique`s of used variables in a `Term`.</span><span>
</span><span id="line-319"></span><span id="local-6989586621681156507"><span id="local-6989586621681156508"><span id="local-6989586621681156509"><span id="local-6989586621681156510"><span id="local-6989586621681156511"><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#termUniqs"><span class="hs-identifier hs-type">termUniqs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156511"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156510"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156509"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156508"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681156507"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#Uniques"><span class="hs-identifier hs-type">Uniques</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#Uniques"><span class="hs-identifier hs-type">Uniques</span></a></span></span></span></span></span></span><span>
</span><span id="line-320"></span><span id="termUniqs"><span class="annot"><span class="annottext">termUniqs :: forall tyname name (uni :: * -&gt; *) fun a.
Term tyname name uni fun (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#termUniqs"><span class="hs-identifier hs-var hs-var">termUniqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
Term tyname name uni fun a -&gt; a
</span><a href="PlutusIR.Core.Type.html#termAnn"><span class="hs-identifier hs-var">termAnn</span></a></span><span>
</span><span id="line-321"></span><span>
</span><span id="line-322"></span><span class="hs-comment">-- | The set of `Unique`s of used variables in a `Type`.</span><span>
</span><span id="line-323"></span><span id="local-6989586621681156497"><span id="local-6989586621681156498"><span id="local-6989586621681156499"><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#typeUniqs"><span class="hs-identifier hs-type">typeUniqs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156499"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156498"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681156497"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#Uniques"><span class="hs-identifier hs-type">Uniques</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#Uniques"><span class="hs-identifier hs-type">Uniques</span></a></span></span></span></span><span>
</span><span id="line-324"></span><span id="typeUniqs"><span class="annot"><span class="annottext">typeUniqs :: forall tyname (uni :: * -&gt; *) a.
Type tyname uni (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#typeUniqs"><span class="hs-identifier hs-var hs-var">typeUniqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) ann. Type tyname uni ann -&gt; ann
</span><a href="PlutusCore.Core.Type.html#typeAnn"><span class="hs-identifier hs-var">PLC.typeAnn</span></a></span><span>
</span><span id="line-325"></span><span>
</span><span id="line-326"></span><span class="hs-comment">-- | The set of `Unique`s of used variables in the RHS of a `Binding`.</span><span>
</span><span id="line-327"></span><span id="local-6989586621681156470"><span id="local-6989586621681156471"><span id="local-6989586621681156472"><span id="local-6989586621681156473"><span id="local-6989586621681156474"><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#bindingUniqs"><span class="hs-identifier hs-type">bindingUniqs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156474"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156473"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156472"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156471"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681156470"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#Uniques"><span class="hs-identifier hs-type">Uniques</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#Uniques"><span class="hs-identifier hs-type">Uniques</span></a></span></span></span></span></span></span><span>
</span><span id="line-328"></span><span id="bindingUniqs"><span class="annot"><span class="annottext">bindingUniqs :: forall tyname name (uni :: * -&gt; *) fun a.
Binding tyname name uni fun (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#bindingUniqs"><span class="hs-identifier hs-var hs-var">bindingUniqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
Binding tyname name uni fun a -&gt; a
</span><a href="PlutusIR.Core.Type.html#bindingAnn"><span class="hs-identifier hs-var">bindingAnn</span></a></span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span class="hs-comment">-- | The set of `Unique`s of used variables in a `VarDecl`.</span><span>
</span><span id="line-331"></span><span id="local-6989586621681156453"><span id="local-6989586621681156454"><span id="local-6989586621681156455"><span id="local-6989586621681156456"><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#varDeclUniqs"><span class="hs-identifier hs-type">varDeclUniqs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusCore.Core.Type.html#VarDecl"><span class="hs-identifier hs-type">VarDecl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156456"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156455"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156454"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681156453"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#Uniques"><span class="hs-identifier hs-type">Uniques</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#Uniques"><span class="hs-identifier hs-type">Uniques</span></a></span></span></span></span></span><span>
</span><span id="line-332"></span><span id="varDeclUniqs"><span class="annot"><span class="annottext">varDeclUniqs :: forall tyname name (uni :: * -&gt; *) a.
VarDecl tyname name uni (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#varDeclUniqs"><span class="hs-identifier hs-var hs-var">varDeclUniqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (a, b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><a href="../../../../lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) ann.
Lens' (VarDecl tyname name uni ann) ann
</span><a href="PlutusCore.Core.Type.html#varDeclAnn"><span class="hs-identifier hs-var">PLC.varDeclAnn</span></a></span><span>
</span><span id="line-333"></span><span>
</span><span id="line-334"></span><span id="local-6989586621681156495"><span id="local-6989586621681156496"><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#noUniq"><span class="hs-identifier hs-type">noUniq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Functor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156496"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681156496"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156495"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681156496"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681156495"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#Uniques"><span class="hs-identifier hs-type">Uniques</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-335"></span><span id="noUniq"><span class="annot"><span class="annottext">noUniq :: forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f (a, Uniques)
</span><a href="PlutusIR.Transform.LetFloatIn.html#noUniq"><span class="hs-identifier hs-var hs-var">noUniq</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-336"></span><span>
</span><span id="line-337"></span><span class="hs-comment">-- See Note [Float-in] #1</span><span>
</span><span id="line-338"></span><span id="local-6989586621681156392"><span id="local-6989586621681156393"><span id="local-6989586621681156394"><span id="local-6989586621681156395"><span id="local-6989586621681156396"><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#floatable"><span class="hs-identifier hs-type">floatable</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-339"></span><span>    </span><span class="annot"><a href="PlutusCore.Builtin.Meaning.html#ToBuiltinMeaning"><span class="hs-identifier hs-type">PLC.ToBuiltinMeaning</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156396"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156395"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-340"></span><span>    </span><span class="annot"><a href="PlutusCore.Builtin.Meaning.html#BuiltinVersion"><span class="hs-identifier hs-type">PLC.BuiltinVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156395"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-341"></span><span>    </span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156394"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156393"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156396"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156395"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156392"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-342"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Bool</span></a></span></span></span></span></span></span><span>
</span><span id="line-343"></span><span id="floatable"><span class="annot"><span class="annottext">floatable :: forall (uni :: * -&gt; *) fun tyname name a.
ToBuiltinMeaning uni fun =&gt;
BuiltinVersion fun -&gt; Binding tyname name uni fun a -&gt; Bool
</span><a href="PlutusIR.Transform.LetFloatIn.html#floatable"><span class="hs-identifier hs-var hs-var">floatable</span></a></span></span><span> </span><span id="local-6989586621681156010"><span class="annot"><span class="annottext">BuiltinVersion fun
</span><a href="#local-6989586621681156010"><span class="hs-identifier hs-var">ver</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-344"></span><span>    </span><span class="annot"><a href="PlutusIR.Core.Type.html#TermBind"><span class="hs-identifier hs-type">TermBind</span></a></span><span> </span><span id="local-6989586621681156009"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156009"><span class="hs-identifier hs-var">_a</span></a></span></span><span> </span><span class="annot"><span class="annottext">Strictness
</span><a href="PlutusIR.Core.Type.html#Strict"><span class="hs-identifier hs-var">Strict</span></a></span><span> </span><span id="local-6989586621681156007"><span class="annot"><span class="annottext">VarDecl tyname name uni a
</span><a href="#local-6989586621681156007"><span class="hs-identifier hs-var">_var</span></a></span></span><span> </span><span id="local-6989586621681156006"><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681156006"><span class="hs-identifier hs-var">rhs</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) fun tyname name a.
ToBuiltinMeaning uni fun =&gt;
BuiltinVersion fun -&gt; Term tyname name uni fun a -&gt; Bool
</span><a href="PlutusIR.Transform.LetFloatIn.html#isEssentiallyWorkFree"><span class="hs-identifier hs-var">isEssentiallyWorkFree</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinVersion fun
</span><a href="#local-6989586621681156010"><span class="hs-identifier hs-var">ver</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681156006"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-345"></span><span>    </span><span class="annot"><a href="PlutusIR.Core.Type.html#TermBind"><span class="hs-identifier hs-type">TermBind</span></a></span><span> </span><span id="local-6989586621681156004"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681156004"><span class="hs-identifier hs-var">_a</span></a></span></span><span> </span><span class="annot"><span class="annottext">Strictness
</span><a href="PlutusIR.Core.Type.html#NonStrict"><span class="hs-identifier hs-var">NonStrict</span></a></span><span> </span><span id="local-6989586621681156002"><span class="annot"><span class="annottext">VarDecl tyname name uni a
</span><a href="#local-6989586621681156002"><span class="hs-identifier hs-var">_var</span></a></span></span><span> </span><span id="local-6989586621681156001"><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681156001"><span class="hs-identifier hs-var">_rhs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-346"></span><span>    </span><span class="hs-comment">-- See Note [Float-in] #2</span><span>
</span><span id="line-347"></span><span>    </span><span class="annot"><a href="PlutusIR.Core.Type.html#TypeBind"><span class="hs-identifier hs-type">TypeBind</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-348"></span><span>    </span><span class="hs-comment">-- See Note [Float-in] #2</span><span>
</span><span id="line-349"></span><span>    </span><span class="annot"><a href="PlutusIR.Core.Type.html#DatatypeBind"><span class="hs-identifier hs-type">DatatypeBind</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span class="hs-comment">{- | Whether evaluating a given `Term` is essentially work-free (barring the CEK machine overhead).

 See Note [Float-in] #1
-}</span><span>
</span><span id="line-355"></span><span id="local-6989586621681156382"><span id="local-6989586621681156383"><span id="local-6989586621681156384"><span id="local-6989586621681156385"><span id="local-6989586621681156386"><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#isEssentiallyWorkFree"><span class="hs-identifier hs-type">isEssentiallyWorkFree</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-356"></span><span>    </span><span class="annot"><a href="PlutusCore.Builtin.Meaning.html#ToBuiltinMeaning"><span class="hs-identifier hs-type">PLC.ToBuiltinMeaning</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156386"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156385"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Meaning.html#BuiltinVersion"><span class="hs-identifier hs-type">PLC.BuiltinVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156385"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156384"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156383"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156386"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156385"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156382"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Bool</span></a></span></span></span></span></span></span><span>
</span><span id="line-357"></span><span id="isEssentiallyWorkFree"><span class="annot"><span class="annottext">isEssentiallyWorkFree :: forall (uni :: * -&gt; *) fun tyname name a.
ToBuiltinMeaning uni fun =&gt;
BuiltinVersion fun -&gt; Term tyname name uni fun a -&gt; Bool
</span><a href="PlutusIR.Transform.LetFloatIn.html#isEssentiallyWorkFree"><span class="hs-identifier hs-var hs-var">isEssentiallyWorkFree</span></a></span></span><span> </span><span id="local-6989586621681155999"><span class="annot"><span class="annottext">BuiltinVersion fun
</span><a href="#local-6989586621681155999"><span class="hs-identifier hs-var">ver</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {tyname} {name} {a}. Term tyname name uni fun a -&gt; Bool
</span><a href="#local-6989586621681155998"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-358"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-359"></span><span>    </span><span id="local-6989586621681155998"><span class="annot"><span class="annottext">go :: Term tyname name uni fun a -&gt; Bool
</span><a href="#local-6989586621681155998"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-360"></span><span>        </span><span class="annot"><a href="PlutusIR.Core.Type.html#LamAbs"><span class="hs-identifier hs-type">LamAbs</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-361"></span><span>        </span><span class="annot"><a href="PlutusIR.Core.Type.html#TyAbs"><span class="hs-identifier hs-type">TyAbs</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-362"></span><span>        </span><span class="annot"><a href="PlutusIR.Core.Type.html#Constant"><span class="hs-identifier hs-type">Constant</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-363"></span><span>        </span><span id="local-6989586621681155995"><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681155995"><span class="hs-identifier hs-var">x</span></a></span></span><span>
</span><span id="line-364"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681155994"><span class="annot"><span class="annottext">bapp :: BuiltinApp tyname name uni fun a
</span><a href="#local-6989586621681155994"><span class="hs-identifier hs-var">bapp</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Purity.html#BuiltinApp"><span class="hs-identifier hs-type">BuiltinApp</span></a></span><span> </span><span class="annot"><span class="annottext">fun
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681155992"><span class="annot"><span class="annottext">[Arg tyname name uni fun a]
</span><a href="#local-6989586621681155992"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
Term tyname name uni fun a
-&gt; Maybe (BuiltinApp tyname name uni fun a)
</span><a href="PlutusIR.Purity.html#asBuiltinApp"><span class="hs-identifier hs-var">asBuiltinApp</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681155995"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-365"></span><span>                </span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
ToBuiltinMeaning uni fun =&gt;
BuiltinVersion fun
-&gt; BuiltinApp tyname name uni fun a -&gt; Maybe Bool
</span><a href="PlutusIR.Purity.html#isSaturated"><span class="hs-identifier hs-var">isSaturated</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinVersion fun
</span><a href="#local-6989586621681155999"><span class="hs-identifier hs-var">ver</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinApp tyname name uni fun a
</span><a href="#local-6989586621681155994"><span class="hs-identifier hs-var">bapp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-366"></span><span>                    </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span> </span><span class="annot"><a href="PlutusIR.Purity.html#TermArg"><span class="hs-identifier hs-type">TermArg</span></a></span><span> </span><span id="local-6989586621681155984"><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681155984"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a -&gt; Bool
</span><a href="#local-6989586621681155998"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681155984"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><a href="PlutusIR.Purity.html#TypeArg"><span class="hs-identifier hs-type">TypeArg</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Arg tyname name uni fun a]
</span><a href="#local-6989586621681155992"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-367"></span><span>        </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-368"></span><span>
</span><span id="line-369"></span><span class="hs-comment">{- | Given a `Term` and a `Binding`, determine whether the `Binding` can be
 placed somewhere inside the `Term`.

 If yes, return the result `Term`. Otherwise, return a `Let` constructed from
 the given `Binding` and `Term`.
-}</span><span>
</span><span id="line-375"></span><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#floatInBinding"><span class="hs-identifier hs-type">floatInBinding</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-376"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681156481"><span class="annot"><a href="#local-6989586621681156481"><span class="hs-identifier hs-type">tyname</span></a></span></span><span> </span><span id="local-6989586621681156482"><span class="annot"><a href="#local-6989586621681156482"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span id="local-6989586621681156480"><span class="annot"><a href="#local-6989586621681156480"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681156479"><span class="annot"><a href="#local-6989586621681156479"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621681156478"><span class="annot"><a href="#local-6989586621681156478"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-377"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="PlutusCore.Name.html#HasUnique"><span class="hs-identifier hs-type">PLC.HasUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156482"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TermUnique"><span class="hs-identifier hs-type">PLC.TermUnique</span></a></span><span>
</span><span id="line-378"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Name.html#HasUnique"><span class="hs-identifier hs-type">PLC.HasUnique</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156481"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TypeUnique"><span class="hs-identifier hs-type">PLC.TypeUnique</span></a></span><span>
</span><span id="line-379"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Meaning.html#ToBuiltinMeaning"><span class="hs-identifier hs-type">PLC.ToBuiltinMeaning</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156480"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156479"><span class="hs-identifier hs-type">fun</span></a></span><span>
</span><span id="line-380"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-381"></span><span>    </span><span class="annot"><a href="PlutusCore.Builtin.Meaning.html#BuiltinVersion"><span class="hs-identifier hs-type">PLC.BuiltinVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156479"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-382"></span><span>    </span><span class="hs-comment">-- | Annotation to be attached to the constructed `Let`.</span><span>
</span><span id="line-383"></span><span>    </span><span class="annot"><a href="#local-6989586621681156478"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-384"></span><span>    </span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156481"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156482"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156480"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156479"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681156478"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#Uniques"><span class="hs-identifier hs-type">Uniques</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-385"></span><span>    </span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156481"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156482"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156480"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156479"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681156478"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#Uniques"><span class="hs-identifier hs-type">Uniques</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-386"></span><span>    </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">Reader</span></a></span><span> </span><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#FloatInContext"><span class="hs-identifier hs-type">FloatInContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156481"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156482"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156480"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156479"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681156478"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#Uniques"><span class="hs-identifier hs-type">Uniques</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-387"></span><span id="floatInBinding"><span class="annot"><span class="annottext">floatInBinding :: forall tyname name (uni :: * -&gt; *) fun a.
(HasUnique name TermUnique, HasUnique tyname TypeUnique,
 ToBuiltinMeaning uni fun) =&gt;
BuiltinVersion fun
-&gt; a
-&gt; Binding tyname name uni fun (a, Uniques)
-&gt; Term tyname name uni fun (a, Uniques)
-&gt; Reader FloatInContext (Term tyname name uni fun (a, Uniques))
</span><a href="PlutusIR.Transform.LetFloatIn.html#floatInBinding"><span class="hs-identifier hs-var hs-var">floatInBinding</span></a></span></span><span> </span><span id="local-6989586621681155907"><span class="annot"><span class="annottext">BuiltinVersion fun
</span><a href="#local-6989586621681155907"><span class="hs-identifier hs-var">ver</span></a></span></span><span> </span><span id="local-6989586621681155906"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681155906"><span class="hs-identifier hs-var">letAnn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681155905"><span class="annot"><span class="annottext">Binding tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155905"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-388"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) fun tyname name a.
ToBuiltinMeaning uni fun =&gt;
BuiltinVersion fun -&gt; Binding tyname name uni fun a -&gt; Bool
</span><a href="PlutusIR.Transform.LetFloatIn.html#floatable"><span class="hs-identifier hs-var">floatable</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinVersion fun
</span><a href="#local-6989586621681155907"><span class="hs-identifier hs-var">ver</span></a></span><span> </span><span class="annot"><span class="annottext">Binding tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155905"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-389"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Binding tyname name uni fun (a, Uniques)
-&gt; Term tyname name uni fun (a, Uniques)
-&gt; Reader FloatInContext (Term tyname name uni fun (a, Uniques))
</span><a href="#local-6989586621681155904"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Binding tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155905"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-390"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681155903"><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155903"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-391"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681155900"><span class="annot"><span class="annottext">us :: Uniques
</span><a href="#local-6989586621681155900"><span class="hs-identifier hs-var hs-var">us</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
Term tyname name uni fun (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#termUniqs"><span class="hs-identifier hs-var">termUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155903"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
Binding tyname name uni fun (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#bindingUniqs"><span class="hs-identifier hs-var">bindingUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Binding tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155905"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-392"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a
-&gt; Recursivity
-&gt; NonEmpty (Binding tyname name uni fun a)
-&gt; Term tyname name uni fun a
-&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681155906"><span class="hs-identifier hs-var">letAnn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155900"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Recursivity
</span><a href="PlutusIR.Core.Type.html#NonRec"><span class="hs-identifier hs-var">NonRec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Binding tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155905"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155903"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-393"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-394"></span><span>    </span><span class="annot"><a href="#local-6989586621681155904"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-395"></span><span>        </span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156481"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156482"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156480"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156479"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681156478"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#Uniques"><span class="hs-identifier hs-type">Uniques</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-396"></span><span>        </span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156481"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156482"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156480"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156479"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681156478"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#Uniques"><span class="hs-identifier hs-type">Uniques</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-397"></span><span>        </span><span class="annot"><a href="../../../../transformers/html/src"><span class="hs-identifier hs-type">Reader</span></a></span><span> </span><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#FloatInContext"><span class="hs-identifier hs-type">FloatInContext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156481"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156482"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156480"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156479"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681156478"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#Uniques"><span class="hs-identifier hs-type">Uniques</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-398"></span><span>    </span><span id="local-6989586621681155904"><span class="annot"><span class="annottext">go :: Binding tyname name uni fun (a, Uniques)
-&gt; Term tyname name uni fun (a, Uniques)
-&gt; Reader FloatInContext (Term tyname name uni fun (a, Uniques))
</span><a href="#local-6989586621681155904"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621681155899"><span class="annot"><span class="annottext">Binding tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155899"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681155898"><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155898"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155898"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-399"></span><span>        </span><span class="annot"><a href="PlutusIR.Core.Type.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681155897"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681155897"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681155896"><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155896"><span class="hs-identifier hs-var">usBody</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681155895"><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155895"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621681155894"><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155894"><span class="hs-identifier hs-var">arg</span></a></span></span><span>
</span><span id="line-400"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.disjoint</span></a></span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155892"><span class="hs-identifier hs-var">declaredUniqs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
Term tyname name uni fun (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#termUniqs"><span class="hs-identifier hs-var">termUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155895"><span class="hs-identifier hs-var">fun</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-401"></span><span>                </span><span class="hs-comment">-- `fun` does not mention the binding, so we can place the binding</span><span>
</span><span id="line-402"></span><span>                </span><span class="hs-comment">-- inside `arg`.</span><span>
</span><span id="line-403"></span><span>                </span><span class="hs-comment">-- See Note [Float-in] #4</span><span>
</span><span id="line-404"></span><span>                </span><span id="local-6989586621681155891"><span class="annot"><span class="annottext">Usages
</span><a href="#local-6989586621681155891"><span class="hs-identifier hs-var">usgs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r a. Monad m =&gt; (r -&gt; a) -&gt; ReaderT r m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">asks</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><a href="../../../../lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' FloatInContext Usages
</span><a href="PlutusIR.Transform.LetFloatIn.html#ctxtUsages"><span class="hs-identifier hs-var">ctxtUsages</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-405"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681155884"><span class="annot"><span class="annottext">inManyOccRhs :: Bool
</span><a href="#local-6989586621681155884"><span class="hs-identifier hs-var hs-var">inManyOccRhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155895"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-406"></span><span>                        </span><span class="annot"><a href="PlutusIR.Core.Type.html#LamAbs"><span class="hs-identifier hs-type">LamAbs</span></a></span><span> </span><span class="annot"><span class="annottext">(a, Uniques)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681155883"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681155883"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-407"></span><span>                            </span><span class="annot"><span class="annottext">forall n unique. HasUnique n unique =&gt; n -&gt; Usages -&gt; Int
</span><a href="PlutusIR.Analysis.Usages.html#getUsageCount"><span class="hs-identifier hs-var">Usages.getUsageCount</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681155883"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Usages
</span><a href="#local-6989586621681155891"><span class="hs-identifier hs-var">usgs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-408"></span><span>                        </span><span class="annot"><a href="PlutusIR.Core.Type.html#Builtin"><span class="hs-identifier hs-type">Builtin</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-409"></span><span>                        </span><span class="hs-comment">-- We need to be conservative here, this could be something</span><span>
</span><span id="line-410"></span><span>                        </span><span class="hs-comment">-- that computes to a function that uses its argument repeatedly.</span><span>
</span><span id="line-411"></span><span>                        </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-412"></span><span>                </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a
-&gt; Term tyname name uni fun a
-&gt; Term tyname name uni fun a
-&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681155897"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155880"><span class="hs-identifier hs-var">usBind</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155896"><span class="hs-identifier hs-var">usBody</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155895"><span class="hs-identifier hs-var">fun</span></a></span><span>
</span><span id="line-413"></span><span>                    </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *) a.
(r -&gt; r) -&gt; ReaderT r m a -&gt; ReaderT r m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">local</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="../../../../lens/html/src"><span class="hs-identifier hs-var">over</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' FloatInContext Bool
</span><a href="PlutusIR.Transform.LetFloatIn.html#ctxtInManyOccRhs"><span class="hs-identifier hs-var">ctxtInManyOccRhs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681155884"><span class="hs-identifier hs-var">inManyOccRhs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Binding tyname name uni fun (a, Uniques)
-&gt; Term tyname name uni fun (a, Uniques)
-&gt; Reader FloatInContext (Term tyname name uni fun (a, Uniques))
</span><a href="#local-6989586621681155904"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Binding tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155899"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155894"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-414"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.disjoint</span></a></span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155892"><span class="hs-identifier hs-var">declaredUniqs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
Term tyname name uni fun (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#termUniqs"><span class="hs-identifier hs-var">termUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155894"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-415"></span><span>                </span><span class="hs-comment">-- `arg` does not mention the binding, so we can place the binding</span><span>
</span><span id="line-416"></span><span>                </span><span class="hs-comment">-- inside `fun`.</span><span>
</span><span id="line-417"></span><span>                </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a
-&gt; Term tyname name uni fun a
-&gt; Term tyname name uni fun a
-&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#Apply"><span class="hs-identifier hs-var">Apply</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681155897"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155880"><span class="hs-identifier hs-var">usBind</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155896"><span class="hs-identifier hs-var">usBody</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Binding tyname name uni fun (a, Uniques)
-&gt; Term tyname name uni fun (a, Uniques)
-&gt; Reader FloatInContext (Term tyname name uni fun (a, Uniques))
</span><a href="#local-6989586621681155904"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Binding tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155899"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155895"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155894"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-418"></span><span>        </span><span class="annot"><a href="PlutusIR.Core.Type.html#LamAbs"><span class="hs-identifier hs-type">LamAbs</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681155876"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681155876"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681155875"><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155875"><span class="hs-identifier hs-var">usBody</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681155874"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681155874"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681155873"><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681155873"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621681155872"><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155872"><span class="hs-identifier hs-var">lamAbsBody</span></a></span></span><span>
</span><span id="line-419"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.disjoint</span></a></span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155892"><span class="hs-identifier hs-var">declaredUniqs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) a.
Type tyname uni (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#typeUniqs"><span class="hs-identifier hs-var">typeUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681155873"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-420"></span><span>                </span><span class="hs-comment">-- See Note [Float-in] #6</span><span>
</span><span id="line-421"></span><span>                </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; m Bool -&gt; m a -&gt; m a -&gt; m a
</span><a href="../../../../extra/html/src"><span class="hs-identifier hs-var">ifM</span></a></span><span>
</span><span id="line-422"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r a. Monad m =&gt; (r -&gt; a) -&gt; ReaderT r m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">asks</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><a href="../../../../lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' FloatInContext Bool
</span><a href="PlutusIR.Transform.LetFloatIn.html#ctxtInManyOccRhs"><span class="hs-identifier hs-var">ctxtInManyOccRhs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m Bool -&gt; m Bool
</span><a href="../../../../extra/html/src"><span class="hs-operator hs-var">&amp;&amp;^</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Functor m =&gt; m Bool -&gt; m Bool
</span><a href="../../../../extra/html/src"><span class="hs-identifier hs-var">notM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r a. Monad m =&gt; (r -&gt; a) -&gt; ReaderT r m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">asks</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><a href="../../../../lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' FloatInContext Bool
</span><a href="PlutusIR.Transform.LetFloatIn.html#ctxtRelaxed"><span class="hs-identifier hs-var">ctxtRelaxed</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-423"></span><span>                    </span><span class="annot"><span class="annottext">Reader FloatInContext (Term tyname name uni fun (a, Uniques))
</span><a href="#local-6989586621681155868"><span class="hs-identifier hs-var">giveup</span></a></span><span>
</span><span id="line-424"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a
-&gt; name
-&gt; Type tyname uni a
-&gt; Term tyname name uni fun a
-&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#LamAbs"><span class="hs-identifier hs-var">LamAbs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681155876"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155880"><span class="hs-identifier hs-var">usBind</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155875"><span class="hs-identifier hs-var">usBody</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681155874"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681155873"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Binding tyname name uni fun (a, Uniques)
-&gt; Term tyname name uni fun (a, Uniques)
-&gt; Reader FloatInContext (Term tyname name uni fun (a, Uniques))
</span><a href="#local-6989586621681155904"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Binding tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155899"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155872"><span class="hs-identifier hs-var">lamAbsBody</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-425"></span><span>        </span><span class="annot"><a href="PlutusIR.Core.Type.html#TyAbs"><span class="hs-identifier hs-type">TyAbs</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681155867"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681155867"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681155866"><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155866"><span class="hs-identifier hs-var">usBody</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681155865"><span class="annot"><span class="annottext">tyname
</span><a href="#local-6989586621681155865"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681155864"><span class="annot"><span class="annottext">Kind (a, Uniques)
</span><a href="#local-6989586621681155864"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621681155863"><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155863"><span class="hs-identifier hs-var">tyAbsBody</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-426"></span><span>            </span><span class="hs-comment">-- See Note [Float-in] #6</span><span>
</span><span id="line-427"></span><span>            </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; m Bool -&gt; m a -&gt; m a -&gt; m a
</span><a href="../../../../extra/html/src"><span class="hs-identifier hs-var">ifM</span></a></span><span>
</span><span id="line-428"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r a. Monad m =&gt; (r -&gt; a) -&gt; ReaderT r m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">asks</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><a href="../../../../lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' FloatInContext Bool
</span><a href="PlutusIR.Transform.LetFloatIn.html#ctxtInManyOccRhs"><span class="hs-identifier hs-var">ctxtInManyOccRhs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m Bool -&gt; m Bool
</span><a href="../../../../extra/html/src"><span class="hs-operator hs-var">&amp;&amp;^</span></a></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *). Functor m =&gt; m Bool -&gt; m Bool
</span><a href="../../../../extra/html/src"><span class="hs-identifier hs-var">notM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r a. Monad m =&gt; (r -&gt; a) -&gt; ReaderT r m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">asks</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><a href="../../../../lens/html/src"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' FloatInContext Bool
</span><a href="PlutusIR.Transform.LetFloatIn.html#ctxtRelaxed"><span class="hs-identifier hs-var">ctxtRelaxed</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-429"></span><span>                </span><span class="annot"><span class="annottext">Reader FloatInContext (Term tyname name uni fun (a, Uniques))
</span><a href="#local-6989586621681155868"><span class="hs-identifier hs-var">giveup</span></a></span><span>
</span><span id="line-430"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a
-&gt; tyname
-&gt; Kind a
-&gt; Term tyname name uni fun a
-&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#TyAbs"><span class="hs-identifier hs-var">TyAbs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681155867"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155880"><span class="hs-identifier hs-var">usBind</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155866"><span class="hs-identifier hs-var">usBody</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">tyname
</span><a href="#local-6989586621681155865"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Kind (a, Uniques)
</span><a href="#local-6989586621681155864"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Binding tyname name uni fun (a, Uniques)
-&gt; Term tyname name uni fun (a, Uniques)
-&gt; Reader FloatInContext (Term tyname name uni fun (a, Uniques))
</span><a href="#local-6989586621681155904"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Binding tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155899"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155863"><span class="hs-identifier hs-var">tyAbsBody</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-431"></span><span>        </span><span class="annot"><a href="PlutusIR.Core.Type.html#TyInst"><span class="hs-identifier hs-type">TyInst</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681155862"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681155862"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681155861"><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155861"><span class="hs-identifier hs-var">usBody</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681155860"><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155860"><span class="hs-identifier hs-var">tyInstBody</span></a></span></span><span> </span><span id="local-6989586621681155859"><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681155859"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-432"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.disjoint</span></a></span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155892"><span class="hs-identifier hs-var">declaredUniqs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) a.
Type tyname uni (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#typeUniqs"><span class="hs-identifier hs-var">typeUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681155859"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-433"></span><span>                </span><span class="hs-comment">-- A binding can always be placed inside the body a `TyInst` if `ty`</span><span>
</span><span id="line-434"></span><span>                </span><span class="hs-comment">-- doesn't use any of the `declaredUniqs`.</span><span>
</span><span id="line-435"></span><span>                </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a
-&gt; Term tyname name uni fun a
-&gt; Type tyname uni a
-&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#TyInst"><span class="hs-identifier hs-var">TyInst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681155862"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155880"><span class="hs-identifier hs-var">usBind</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155861"><span class="hs-identifier hs-var">usBody</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Binding tyname name uni fun (a, Uniques)
-&gt; Term tyname name uni fun (a, Uniques)
-&gt; Reader FloatInContext (Term tyname name uni fun (a, Uniques))
</span><a href="#local-6989586621681155904"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Binding tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155899"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155860"><span class="hs-identifier hs-var">tyInstBody</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681155859"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-436"></span><span>        </span><span class="annot"><a href="PlutusIR.Core.Type.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681155858"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681155858"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681155857"><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155857"><span class="hs-identifier hs-var">usBody</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Recursivity
</span><a href="PlutusIR.Core.Type.html#NonRec"><span class="hs-identifier hs-var">NonRec</span></a></span><span> </span><span id="local-6989586621681155856"><span class="annot"><span class="annottext">NonEmpty (Binding tyname name uni fun (a, Uniques))
</span><a href="#local-6989586621681155856"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span id="local-6989586621681155855"><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155855"><span class="hs-identifier hs-var">letBody</span></a></span></span><span>
</span><span id="line-437"></span><span>            </span><span class="hs-comment">-- The binding can be placed inside a `Let`, if the right hand sides of the</span><span>
</span><span id="line-438"></span><span>            </span><span class="hs-comment">-- bindings of the `Let` do not mention `var`.</span><span>
</span><span id="line-439"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.disjoint</span></a></span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155892"><span class="hs-identifier hs-var">declaredUniqs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">foldMap</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
Binding tyname name uni fun (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#bindingUniqs"><span class="hs-identifier hs-var">bindingUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Binding tyname name uni fun (a, Uniques))
</span><a href="#local-6989586621681155856"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-440"></span><span>                </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a
-&gt; Recursivity
-&gt; NonEmpty (Binding tyname name uni fun a)
-&gt; Term tyname name uni fun a
-&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681155858"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155880"><span class="hs-identifier hs-var">usBind</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155857"><span class="hs-identifier hs-var">usBody</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Recursivity
</span><a href="PlutusIR.Core.Type.html#NonRec"><span class="hs-identifier hs-var">NonRec</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Binding tyname name uni fun (a, Uniques))
</span><a href="#local-6989586621681155856"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Binding tyname name uni fun (a, Uniques)
-&gt; Term tyname name uni fun (a, Uniques)
-&gt; Reader FloatInContext (Term tyname name uni fun (a, Uniques))
</span><a href="#local-6989586621681155904"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Binding tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155899"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155855"><span class="hs-identifier hs-var">letBody</span></a></span><span>
</span><span id="line-441"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.disjoint</span></a></span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155892"><span class="hs-identifier hs-var">declaredUniqs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
Term tyname name uni fun (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#termUniqs"><span class="hs-identifier hs-var">termUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155855"><span class="hs-identifier hs-var">letBody</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-442"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681155854"><span class="annot"><span class="annottext">[Binding tyname name uni fun (a, Uniques)]
</span><a href="#local-6989586621681155854"><span class="hs-identifier hs-var">before</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#TermBind"><span class="hs-identifier hs-type">TermBind</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681155853"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681155853"><span class="hs-identifier hs-var">a'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681155852"><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155852"><span class="hs-identifier hs-var">usBind'</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681155851"><span class="annot"><span class="annottext">Strictness
</span><a href="#local-6989586621681155851"><span class="hs-identifier hs-var">s'</span></a></span></span><span> </span><span id="local-6989586621681155850"><span class="annot"><span class="annottext">VarDecl tyname name uni (a, Uniques)
</span><a href="#local-6989586621681155850"><span class="hs-identifier hs-var">var'</span></a></span></span><span> </span><span id="local-6989586621681155849"><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155849"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681155848"><span class="annot"><span class="annottext">[Binding tyname name uni fun (a, Uniques)]
</span><a href="#local-6989586621681155848"><span class="hs-identifier hs-var">after</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-443"></span><span>                </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
Uniques
-&gt; [Binding tyname name uni fun (a, Uniques)]
-&gt; Maybe
     ([Binding tyname name uni fun (a, Uniques)],
      Binding tyname name uni fun (a, Uniques),
      [Binding tyname name uni fun (a, Uniques)])
</span><a href="PlutusIR.Transform.LetFloatIn.html#splitBindings"><span class="hs-identifier hs-var">splitBindings</span></a></span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155892"><span class="hs-identifier hs-var">declaredUniqs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. NonEmpty a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">NonEmpty.toList</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Binding tyname name uni fun (a, Uniques))
</span><a href="#local-6989586621681155856"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-444"></span><span>                </span><span class="hs-comment">-- `letBody` does not mention `var`, and there is exactly one</span><span>
</span><span id="line-445"></span><span>                </span><span class="hs-comment">-- RHS in `bs` that mentions `var`, so we can place `b`</span><span>
</span><span id="line-446"></span><span>                </span><span class="hs-comment">-- inside one of the RHSs in `bs`.</span><span>
</span><span id="line-447"></span><span>                </span><span id="local-6989586621681155845"><span class="annot"><span class="annottext">FloatInContext
</span><a href="#local-6989586621681155845"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) r. Monad m =&gt; ReaderT r m r
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">ask</span></a></span><span>
</span><span id="line-448"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681155839"><span class="annot"><span class="annottext">usageCnt :: Int
</span><a href="#local-6989586621681155839"><span class="hs-identifier hs-var hs-var">usageCnt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall n unique. HasUnique n unique =&gt; n -&gt; Usages -&gt; Int
</span><a href="PlutusIR.Analysis.Usages.html#getUsageCount"><span class="hs-identifier hs-var">Usages.getUsageCount</span></a></span><span> </span><span class="annot"><span class="annottext">VarDecl tyname name uni (a, Uniques)
</span><a href="#local-6989586621681155850"><span class="hs-identifier hs-var">var'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FloatInContext
</span><a href="#local-6989586621681155845"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../../../../lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' FloatInContext Usages
</span><a href="PlutusIR.Transform.LetFloatIn.html#ctxtUsages"><span class="hs-identifier hs-var">ctxtUsages</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-449"></span><span>                    </span><span id="local-6989586621681155835"><span class="annot"><span class="annottext">safe :: Bool
</span><a href="#local-6989586621681155835"><span class="hs-keyword hs-var hs-var">safe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Strictness
</span><a href="#local-6989586621681155851"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-450"></span><span>                        </span><span class="annot"><span class="annottext">Strictness
</span><a href="PlutusIR.Core.Type.html#Strict"><span class="hs-identifier hs-var">Strict</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-451"></span><span>                        </span><span class="annot"><span class="annottext">Strictness
</span><a href="PlutusIR.Core.Type.html#NonStrict"><span class="hs-identifier hs-var">NonStrict</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-452"></span><span>                            </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FloatInContext
</span><a href="#local-6989586621681155845"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../../../../lens/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' FloatInContext Bool
</span><a href="PlutusIR.Transform.LetFloatIn.html#ctxtInManyOccRhs"><span class="hs-identifier hs-var">ctxtInManyOccRhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-453"></span><span>                                </span><span class="hs-comment">-- Descending into a non-strict binding whose LHS is used</span><span>
</span><span id="line-454"></span><span>                                </span><span class="hs-comment">-- more than once should be avoided, regardless of</span><span>
</span><span id="line-455"></span><span>                                </span><span class="hs-comment">-- `ctxtInManyOccRhs`.</span><span>
</span><span id="line-456"></span><span>                                </span><span class="hs-comment">-- See Note [Float-in] #4</span><span>
</span><span id="line-457"></span><span>                                </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681155839"><span class="hs-identifier hs-var">usageCnt</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-458"></span><span>                    </span><span id="local-6989586621681155831"><span class="annot"><span class="annottext">inManyOccRhs :: Bool
</span><a href="#local-6989586621681155831"><span class="hs-identifier hs-var hs-var">inManyOccRhs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681155839"><span class="hs-identifier hs-var">usageCnt</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-459"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681155835"><span class="hs-keyword hs-var">safe</span></a></span><span>
</span><span id="line-460"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-461"></span><span>                        </span><span id="local-6989586621681155830"><span class="annot"><span class="annottext">Binding tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155830"><span class="hs-identifier hs-var">b''</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-462"></span><span>                            </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a
-&gt; Strictness
-&gt; VarDecl tyname name uni a
-&gt; Term tyname name uni fun a
-&gt; Binding tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#TermBind"><span class="hs-identifier hs-var">TermBind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681155853"><span class="hs-identifier hs-var">a'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155880"><span class="hs-identifier hs-var">usBind</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155852"><span class="hs-identifier hs-var">usBind'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Strictness
</span><a href="#local-6989586621681155851"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="annot"><span class="annottext">VarDecl tyname name uni (a, Uniques)
</span><a href="#local-6989586621681155850"><span class="hs-identifier hs-var">var'</span></a></span><span>
</span><span id="line-463"></span><span>                                </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall r (m :: * -&gt; *) a.
(r -&gt; r) -&gt; ReaderT r m a -&gt; ReaderT r m a
</span><a href="../../../../transformers/html/src"><span class="hs-identifier hs-var">local</span></a></span><span>
</span><span id="line-464"></span><span>                                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="../../../../lens/html/src"><span class="hs-identifier hs-var">over</span></a></span><span> </span><span class="annot"><span class="annottext">Lens' FloatInContext Bool
</span><a href="PlutusIR.Transform.LetFloatIn.html#ctxtInManyOccRhs"><span class="hs-identifier hs-var">ctxtInManyOccRhs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681155831"><span class="hs-identifier hs-var">inManyOccRhs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-465"></span><span>                                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Binding tyname name uni fun (a, Uniques)
-&gt; Term tyname name uni fun (a, Uniques)
-&gt; Reader FloatInContext (Term tyname name uni fun (a, Uniques))
</span><a href="#local-6989586621681155904"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Binding tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155899"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155849"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-466"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681155829"><span class="annot"><span class="annottext">bs' :: NonEmpty (Binding tyname name uni fun (a, Uniques))
</span><a href="#local-6989586621681155829"><span class="hs-identifier hs-var hs-var">bs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; NonEmpty a -&gt; NonEmpty a
</span><a href="../../../../extra/html/src"><span class="hs-identifier hs-var">NonEmpty.appendr</span></a></span><span> </span><span class="annot"><span class="annottext">[Binding tyname name uni fun (a, Uniques)]
</span><a href="#local-6989586621681155854"><span class="hs-identifier hs-var">before</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Binding tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155830"><span class="hs-identifier hs-var">b''</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; NonEmpty a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">:|</span></a></span><span> </span><span class="annot"><span class="annottext">[Binding tyname name uni fun (a, Uniques)]
</span><a href="#local-6989586621681155848"><span class="hs-identifier hs-var">after</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-467"></span><span>                        </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a
-&gt; Recursivity
-&gt; NonEmpty (Binding tyname name uni fun a)
-&gt; Term tyname name uni fun a
-&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681155858"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155880"><span class="hs-identifier hs-var">usBind</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155857"><span class="hs-identifier hs-var">usBody</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Recursivity
</span><a href="PlutusIR.Core.Type.html#NonRec"><span class="hs-identifier hs-var">NonRec</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Binding tyname name uni fun (a, Uniques))
</span><a href="#local-6989586621681155829"><span class="hs-identifier hs-var">bs'</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155855"><span class="hs-identifier hs-var">letBody</span></a></span><span>
</span><span id="line-468"></span><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Reader FloatInContext (Term tyname name uni fun (a, Uniques))
</span><a href="#local-6989586621681155868"><span class="hs-identifier hs-var">giveup</span></a></span><span>
</span><span id="line-469"></span><span>        </span><span class="annot"><a href="PlutusIR.Core.Type.html#IWrap"><span class="hs-identifier hs-type">IWrap</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681155827"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681155827"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681155826"><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155826"><span class="hs-identifier hs-var">usBody</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681155825"><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681155825"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621681155824"><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681155824"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span id="local-6989586621681155823"><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155823"><span class="hs-identifier hs-var">iwrapBody</span></a></span></span><span>
</span><span id="line-470"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.disjoint</span></a></span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155892"><span class="hs-identifier hs-var">declaredUniqs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) a.
Type tyname uni (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#typeUniqs"><span class="hs-identifier hs-var">typeUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681155825"><span class="hs-identifier hs-var">ty1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-471"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.disjoint</span></a></span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155892"><span class="hs-identifier hs-var">declaredUniqs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) a.
Type tyname uni (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#typeUniqs"><span class="hs-identifier hs-var">typeUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681155824"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-472"></span><span>                </span><span class="hs-comment">-- A binding can be placed inside an `IWrap`, if `ty1` and `ty2`</span><span>
</span><span id="line-473"></span><span>                </span><span class="hs-comment">-- do not use any of the `declaredUniqs`.</span><span>
</span><span id="line-474"></span><span>                </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a
-&gt; Type tyname uni a
-&gt; Type tyname uni a
-&gt; Term tyname name uni fun a
-&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#IWrap"><span class="hs-identifier hs-var">IWrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681155827"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155880"><span class="hs-identifier hs-var">usBind</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155826"><span class="hs-identifier hs-var">usBody</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681155825"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681155824"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Binding tyname name uni fun (a, Uniques)
-&gt; Term tyname name uni fun (a, Uniques)
-&gt; Reader FloatInContext (Term tyname name uni fun (a, Uniques))
</span><a href="#local-6989586621681155904"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Binding tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155899"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155823"><span class="hs-identifier hs-var">iwrapBody</span></a></span><span>
</span><span id="line-475"></span><span>        </span><span class="annot"><a href="PlutusIR.Core.Type.html#Unwrap"><span class="hs-identifier hs-type">Unwrap</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681155822"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681155822"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681155821"><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155821"><span class="hs-identifier hs-var">usBody</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681155820"><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155820"><span class="hs-identifier hs-var">unwrapBody</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-476"></span><span>            </span><span class="hs-comment">-- A binding can always be placed inside an `Unwrap`.</span><span>
</span><span id="line-477"></span><span>            </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a -&gt; Term tyname name uni fun a -&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#Unwrap"><span class="hs-identifier hs-var">Unwrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681155822"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155880"><span class="hs-identifier hs-var">usBind</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155821"><span class="hs-identifier hs-var">usBody</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Binding tyname name uni fun (a, Uniques)
-&gt; Term tyname name uni fun (a, Uniques)
-&gt; Reader FloatInContext (Term tyname name uni fun (a, Uniques))
</span><a href="#local-6989586621681155904"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Binding tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155899"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155820"><span class="hs-identifier hs-var">unwrapBody</span></a></span><span>
</span><span id="line-478"></span><span>        </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Reader FloatInContext (Term tyname name uni fun (a, Uniques))
</span><a href="#local-6989586621681155868"><span class="hs-identifier hs-var">giveup</span></a></span><span>
</span><span id="line-479"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-480"></span><span>        </span><span id="local-6989586621681155868"><span class="annot"><span class="annottext">giveup :: Reader FloatInContext (Term tyname name uni fun (a, Uniques))
</span><a href="#local-6989586621681155868"><span class="hs-identifier hs-var hs-var">giveup</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-481"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681155815"><span class="annot"><span class="annottext">us :: Uniques
</span><a href="#local-6989586621681155815"><span class="hs-identifier hs-var hs-var">us</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
Term tyname name uni fun (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#termUniqs"><span class="hs-identifier hs-var">termUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155898"><span class="hs-identifier hs-var">body</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
Binding tyname name uni fun (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#bindingUniqs"><span class="hs-identifier hs-var">bindingUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Binding tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155899"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-482"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
a
-&gt; Recursivity
-&gt; NonEmpty (Binding tyname name uni fun a)
-&gt; Term tyname name uni fun a
-&gt; Term tyname name uni fun a
</span><a href="PlutusIR.Core.Type.html#Let"><span class="hs-identifier hs-var">Let</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681155906"><span class="hs-identifier hs-var">letAnn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155815"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Recursivity
</span><a href="PlutusIR.Core.Type.html#NonRec"><span class="hs-identifier hs-var">NonRec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Binding tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155899"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155898"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-483"></span><span>        </span><span id="local-6989586621681155892"><span class="annot"><span class="annottext">declaredUniqs :: Uniques
</span><a href="#local-6989586621681155892"><span class="hs-identifier hs-var hs-var">declaredUniqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Binding tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155899"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">forall s a. s -&gt; Getting (Endo [a]) s a -&gt; [a]
</span><a href="../../../../lens/html/src"><span class="hs-operator hs-var">^..</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
(HasUnique tyname TypeUnique, HasUnique name TermUnique) =&gt;
Traversal1' (Binding tyname name uni fun a) Unique
</span><a href="PlutusIR.Core.Plated.html#bindingIds"><span class="hs-identifier hs-var">bindingIds</span></a></span><span>
</span><span id="line-484"></span><span>        </span><span id="local-6989586621681155880"><span class="annot"><span class="annottext">usBind :: Uniques
</span><a href="#local-6989586621681155880"><span class="hs-identifier hs-var hs-var">usBind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
Binding tyname name uni fun (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#bindingUniqs"><span class="hs-identifier hs-var">bindingUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Binding tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155899"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-485"></span><span>
</span><span id="line-486"></span><span class="hs-comment">{- | Split the given list of bindings, if possible.
 If the input contains exactly one `TermBind` @b@ whose RHS uses one or more of the uniques
 in the given `Uniques`, return @Just (before_b, b, after_b)@.
 Otherwise, return `Nothing`.
-}</span><span>
</span><span id="line-491"></span><span id="local-6989586621681156326"><span id="local-6989586621681156327"><span id="local-6989586621681156328"><span id="local-6989586621681156329"><span id="local-6989586621681156330"><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#splitBindings"><span class="hs-identifier hs-type">splitBindings</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-492"></span><span>    </span><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#Uniques"><span class="hs-identifier hs-type">Uniques</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-493"></span><span>    </span><span class="hs-special">[</span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156330"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156329"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156328"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156327"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681156326"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#Uniques"><span class="hs-identifier hs-type">Uniques</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-494"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span>
</span><span id="line-495"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156330"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156329"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156328"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156327"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681156326"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#Uniques"><span class="hs-identifier hs-type">Uniques</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-496"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156330"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156329"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156328"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156327"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681156326"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#Uniques"><span class="hs-identifier hs-type">Uniques</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-497"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156330"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156329"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156328"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681156327"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681156326"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.Transform.LetFloatIn.html#Uniques"><span class="hs-identifier hs-type">Uniques</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-498"></span><span>        </span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-499"></span><span id="splitBindings"><span class="annot"><span class="annottext">splitBindings :: forall tyname name (uni :: * -&gt; *) fun a.
Uniques
-&gt; [Binding tyname name uni fun (a, Uniques)]
-&gt; Maybe
     ([Binding tyname name uni fun (a, Uniques)],
      Binding tyname name uni fun (a, Uniques),
      [Binding tyname name uni fun (a, Uniques)])
</span><a href="PlutusIR.Transform.LetFloatIn.html#splitBindings"><span class="hs-identifier hs-var hs-var">splitBindings</span></a></span></span><span> </span><span id="local-6989586621681155801"><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155801"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span id="local-6989586621681155800"><span class="annot"><span class="annottext">[Binding tyname name uni fun (a, Uniques)]
</span><a href="#local-6989586621681155800"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[(Binding tyname name uni fun (a, Uniques), Int)]
</span><a href="#local-6989586621681155799"><span class="hs-identifier hs-var">is</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-500"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#TermBind"><span class="hs-identifier hs-type">TermBind</span></a></span><span> </span><span class="annot"><span class="annottext">(a, Uniques)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Strictness
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681155798"><span class="annot"><span class="annottext">VarDecl tyname name uni (a, Uniques)
</span><a href="#local-6989586621681155798"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681155797"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681155797"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-501"></span><span>        </span><span class="hs-comment">-- The LHS (declared variable) must not use any uniques in `us`. Only the RHS is</span><span>
</span><span id="line-502"></span><span>        </span><span class="hs-comment">-- allowed to use them. Otherwise we cannot float a binding whose unique set is `us`</span><span>
</span><span id="line-503"></span><span>        </span><span class="hs-comment">-- into the RHS of this `TermBind`.</span><span>
</span><span id="line-504"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.disjoint</span></a></span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155801"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) a.
VarDecl tyname name uni (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#varDeclUniqs"><span class="hs-identifier hs-var">varDeclUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">VarDecl tyname name uni (a, Uniques)
</span><a href="#local-6989586621681155798"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Int -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">take</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681155797"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">[Binding tyname name uni fun (a, Uniques)]
</span><a href="#local-6989586621681155800"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Binding tyname name uni fun (a, Uniques)]
</span><a href="#local-6989586621681155800"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; Int -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">!!</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681155797"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Int -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">drop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681155797"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Binding tyname name uni fun (a, Uniques)]
</span><a href="#local-6989586621681155800"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-505"></span><span>    </span><span class="annot"><span class="annottext">[(Binding tyname name uni fun (a, Uniques), Int)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-506"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-507"></span><span>    </span><span id="local-6989586621681155799"><span class="annot"><span class="annottext">is :: [(Binding tyname name uni fun (a, Uniques), Int)]
</span><a href="#local-6989586621681155799"><span class="hs-identifier hs-var hs-var">is</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">List.filter</span></a></span><span> </span><span class="annot"><span class="annottext">forall {tyname} {name} {uni :: * -&gt; *} {fun} {a} {b}.
(Binding tyname name uni fun (a, Uniques), b) -&gt; Bool
</span><a href="#local-6989586621681155789"><span class="hs-identifier hs-var">usesUniqs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Binding tyname name uni fun (a, Uniques)]
</span><a href="#local-6989586621681155800"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">`zip`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-508"></span><span>    </span><span id="local-6989586621681155789"><span class="annot"><span class="annottext">usesUniqs :: (Binding tyname name uni fun (a, Uniques), b) -&gt; Bool
</span><a href="#local-6989586621681155789"><span class="hs-identifier hs-var hs-var">usesUniqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-509"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#TermBind"><span class="hs-identifier hs-type">TermBind</span></a></span><span> </span><span class="annot"><span class="annottext">(a, Uniques)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Strictness
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681155782"><span class="annot"><span class="annottext">VarDecl tyname name uni (a, Uniques)
</span><a href="#local-6989586621681155782"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span id="local-6989586621681155781"><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155781"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.disjoint</span></a></span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155801"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) a.
VarDecl tyname name uni (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#varDeclUniqs"><span class="hs-identifier hs-var">varDeclUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">VarDecl tyname name uni (a, Uniques)
</span><a href="#local-6989586621681155782"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
Term tyname name uni fun (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#termUniqs"><span class="hs-identifier hs-var">termUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun (a, Uniques)
</span><a href="#local-6989586621681155781"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-510"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#TypeBind"><span class="hs-identifier hs-type">TypeBind</span></a></span><span> </span><span class="annot"><span class="annottext">(a, Uniques)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TyVarDecl tyname (a, Uniques)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681155780"><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681155780"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.disjoint</span></a></span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155801"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tyname (uni :: * -&gt; *) a.
Type tyname uni (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#typeUniqs"><span class="hs-identifier hs-var">typeUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni (a, Uniques)
</span><a href="#local-6989586621681155780"><span class="hs-identifier hs-var">rhs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-511"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#DatatypeBind"><span class="hs-identifier hs-type">DatatypeBind</span></a></span><span> </span><span class="annot"><span class="annottext">(a, Uniques)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Datatype"><span class="hs-identifier hs-type">Datatype</span></a></span><span> </span><span class="annot"><span class="annottext">(a, Uniques)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TyVarDecl tyname (a, Uniques)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[TyVarDecl tyname (a, Uniques)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681155779"><span class="annot"><span class="annottext">[VarDecl tyname name uni (a, Uniques)]
</span><a href="#local-6989586621681155779"><span class="hs-identifier hs-var">constrs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-512"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Bool
</span><a href="../../../../containers/html/src"><span class="hs-identifier hs-var">Set.disjoint</span></a></span><span> </span><span class="annot"><span class="annottext">Uniques
</span><a href="#local-6989586621681155801"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">foldMap</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) a.
VarDecl tyname name uni (a, Uniques) -&gt; Uniques
</span><a href="PlutusIR.Transform.LetFloatIn.html#varDeclUniqs"><span class="hs-identifier hs-var">varDeclUniqs</span></a></span><span> </span><span class="annot"><span class="annottext">[VarDecl tyname name uni (a, Uniques)]
</span><a href="#local-6989586621681155779"><span class="hs-identifier hs-var">constrs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-513"></span></pre></body></html>