<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE GADTs               #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase          #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications    #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">PlutusIR.Purity</span><span>
</span><span id="line-7"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="PlutusIR.Purity.html#isPure"><span class="hs-identifier">isPure</span></a></span><span>
</span><span id="line-8"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.Purity.html#firstEffectfulTerm"><span class="hs-identifier">firstEffectfulTerm</span></a></span><span>
</span><span id="line-9"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.Purity.html#asBuiltinApp"><span class="hs-identifier">asBuiltinApp</span></a></span><span>
</span><span id="line-10"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.Purity.html#isSaturated"><span class="hs-identifier">isSaturated</span></a></span><span>
</span><span id="line-11"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.Purity.html#BuiltinApp"><span class="hs-identifier">BuiltinApp</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.Purity.html#Arg"><span class="hs-identifier">Arg</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusIR.html"><span class="hs-identifier">PlutusIR</span></a></span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NE</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.html"><span class="hs-identifier">PlutusCore.Builtin</span></a></span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-comment">-- | An argument taken by a builtin: could be a term of a type.</span><span>
</span><span id="line-21"></span><span class="hs-keyword">data</span><span> </span><span id="Arg"><span class="annot"><a href="PlutusIR.Purity.html#Arg"><span class="hs-identifier hs-var">Arg</span></a></span></span><span> </span><span id="local-6989586621681145278"><span class="annot"><a href="#local-6989586621681145278"><span class="hs-identifier hs-type">tyname</span></a></span></span><span> </span><span id="local-6989586621681145277"><span class="annot"><a href="#local-6989586621681145277"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span id="local-6989586621681145276"><span class="annot"><a href="#local-6989586621681145276"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681145275"><span class="annot"><a href="#local-6989586621681145275"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621681145274"><span class="annot"><a href="#local-6989586621681145274"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TypeArg"><span class="annot"><a href="PlutusIR.Purity.html#TypeArg"><span class="hs-identifier hs-var">TypeArg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145278"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145276"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145274"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="TermArg"><span class="annot"><a href="PlutusIR.Purity.html#TermArg"><span class="hs-identifier hs-var">TermArg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145278"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145277"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145276"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145275"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145274"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-comment">-- | A (not necessarily saturated) builtin application,</span><span>
</span><span id="line-24"></span><span class="hs-comment">-- consisting of the builtin and the arguments it has been applied to.</span><span>
</span><span id="line-25"></span><span class="hs-keyword">data</span><span> </span><span id="BuiltinApp"><span class="annot"><a href="PlutusIR.Purity.html#BuiltinApp"><span class="hs-identifier hs-var">BuiltinApp</span></a></span></span><span> </span><span id="local-6989586621681145269"><span class="annot"><a href="#local-6989586621681145269"><span class="hs-identifier hs-type">tyname</span></a></span></span><span> </span><span id="local-6989586621681145268"><span class="annot"><a href="#local-6989586621681145268"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span id="local-6989586621681145267"><span class="annot"><a href="#local-6989586621681145267"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681145270"><span class="annot"><a href="#local-6989586621681145270"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621681145266"><span class="annot"><a href="#local-6989586621681145266"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="BuiltinApp"><span class="annot"><a href="PlutusIR.Purity.html#BuiltinApp"><span class="hs-identifier hs-var">BuiltinApp</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621681145270"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PlutusIR.Purity.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145269"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145268"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145267"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145270"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145266"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span id="local-6989586621681145359"><span id="local-6989586621681145360"><span id="local-6989586621681145361"><span id="local-6989586621681145363"><span id="local-6989586621681145364"><span id="local-6989586621681145365"><span id="local-6989586621681145366"><span id="local-6989586621681145367"><span class="annot"><a href="PlutusIR.Purity.html#saturatesScheme"><span class="hs-identifier hs-type">saturatesScheme</span></a></span><span> </span><span class="hs-glyph">::</span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="PlutusIR.Purity.html#Arg"><span class="hs-identifier hs-type">Arg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145367"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145366"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145365"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145364"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145363"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.TypeScheme.html#TypeScheme"><span class="hs-identifier hs-type">TypeScheme</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145361"><span class="hs-identifier hs-type">val</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145360"><span class="hs-identifier hs-type">args</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145359"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Bool</span></a></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-28"></span><span class="hs-comment">-- We've passed enough arguments that the builtin will reduce.</span><span>
</span><span id="line-29"></span><span class="hs-comment">-- Note that this also accepts over-applied builtins.</span><span>
</span><span id="line-30"></span><span id="saturatesScheme"><span class="annot"><span class="annottext">saturatesScheme :: forall tyname name (uni :: * -&gt; *) fun a val (args :: [*]) res.
[Arg tyname name uni fun a]
-&gt; TypeScheme val args res -&gt; Maybe Bool
</span><a href="PlutusIR.Purity.html#saturatesScheme"><span class="hs-identifier hs-var hs-var">saturatesScheme</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Arg tyname name uni fun a]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="PlutusCore.Builtin.TypeScheme.html#TypeSchemeResult"><span class="hs-identifier hs-type">TypeSchemeResult</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-31"></span><span class="hs-comment">-- Consume one argument</span><span>
</span><span id="line-32"></span><span class="annot"><a href="PlutusIR.Purity.html#saturatesScheme"><span class="hs-identifier hs-var">saturatesScheme</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Purity.html#TermArg"><span class="hs-identifier hs-type">TermArg</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span id="local-6989586621681145213"><span class="annot"><span class="annottext">[Arg tyname name uni fun a]
</span><a href="#local-6989586621681145213"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Builtin.TypeScheme.html#TypeSchemeArrow"><span class="hs-identifier hs-type">TypeSchemeArrow</span></a></span><span> </span><span id="local-6989586621681145206"><span class="annot"><span class="annottext">TypeScheme val args1 res
</span><a href="#local-6989586621681145206"><span class="hs-identifier hs-var">sch</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a val (args :: [*]) res.
[Arg tyname name uni fun a]
-&gt; TypeScheme val args res -&gt; Maybe Bool
</span><a href="PlutusIR.Purity.html#saturatesScheme"><span class="hs-identifier hs-var">saturatesScheme</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg tyname name uni fun a]
</span><a href="#local-6989586621681145213"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">TypeScheme val args1 res
</span><a href="#local-6989586621681145206"><span class="hs-identifier hs-var">sch</span></a></span><span>
</span><span id="line-33"></span><span class="annot"><a href="PlutusIR.Purity.html#saturatesScheme"><span class="hs-identifier hs-var">saturatesScheme</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Purity.html#TypeArg"><span class="hs-identifier hs-type">TypeArg</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span id="local-6989586621681145205"><span class="annot"><span class="annottext">[Arg tyname name uni fun a]
</span><a href="#local-6989586621681145205"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Builtin.TypeScheme.html#TypeSchemeAll"><span class="hs-identifier hs-type">TypeSchemeAll</span></a></span><span> </span><span class="annot"><span class="annottext">Proxy '(text, uniq, kind)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681145200"><span class="annot"><span class="annottext">TypeScheme val args res
</span><a href="#local-6989586621681145200"><span class="hs-identifier hs-var">sch</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a val (args :: [*]) res.
[Arg tyname name uni fun a]
-&gt; TypeScheme val args res -&gt; Maybe Bool
</span><a href="PlutusIR.Purity.html#saturatesScheme"><span class="hs-identifier hs-var">saturatesScheme</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg tyname name uni fun a]
</span><a href="#local-6989586621681145205"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">TypeScheme val args res
</span><a href="#local-6989586621681145200"><span class="hs-identifier hs-var">sch</span></a></span><span>
</span><span id="line-34"></span><span class="hs-comment">-- Under-applied, not saturated</span><span>
</span><span id="line-35"></span><span class="annot"><a href="PlutusIR.Purity.html#saturatesScheme"><span class="hs-identifier hs-var">saturatesScheme</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.TypeScheme.html#TypeSchemeArrow"><span class="hs-identifier hs-type">TypeSchemeArrow</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-36"></span><span class="annot"><a href="PlutusIR.Purity.html#saturatesScheme"><span class="hs-identifier hs-var">saturatesScheme</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.TypeScheme.html#TypeSchemeAll"><span class="hs-identifier hs-type">TypeSchemeAll</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-37"></span><span class="hs-comment">-- These cases are only possible in case we have an ill-typed builtin application,</span><span>
</span><span id="line-38"></span><span class="hs-comment">-- so we can't give an answer.</span><span>
</span><span id="line-39"></span><span class="annot"><a href="PlutusIR.Purity.html#saturatesScheme"><span class="hs-identifier hs-var">saturatesScheme</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Purity.html#TypeArg"><span class="hs-identifier hs-type">TypeArg</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg tyname name uni fun a]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.TypeScheme.html#TypeSchemeArrow"><span class="hs-identifier hs-type">TypeSchemeArrow</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-40"></span><span class="annot"><a href="PlutusIR.Purity.html#saturatesScheme"><span class="hs-identifier hs-var">saturatesScheme</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Purity.html#TermArg"><span class="hs-identifier hs-type">TermArg</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-glyph hs-type">:</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg tyname name uni fun a]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.TypeScheme.html#TypeSchemeAll"><span class="hs-identifier hs-type">TypeSchemeAll</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="hs-comment">-- | Is the given 'BuiltinApp' saturated?</span><span>
</span><span id="line-43"></span><span class="hs-comment">-- Returns 'Nothing' if something is badly wrong and we can't tell.</span><span>
</span><span id="line-44"></span><span class="annot"><a href="PlutusIR.Purity.html#isSaturated"><span class="hs-identifier hs-type">isSaturated</span></a></span><span>
</span><span id="line-45"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681145320"><span class="annot"><a href="#local-6989586621681145320"><span class="hs-identifier hs-type">tyname</span></a></span></span><span> </span><span id="local-6989586621681145319"><span class="annot"><a href="#local-6989586621681145319"><span class="hs-identifier hs-type">name</span></a></span></span><span> </span><span id="local-6989586621681145324"><span class="annot"><a href="#local-6989586621681145324"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621681145323"><span class="annot"><a href="#local-6989586621681145323"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621681145318"><span class="annot"><a href="#local-6989586621681145318"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-46"></span><span>    </span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Meaning.html#ToBuiltinMeaning"><span class="hs-identifier hs-type">ToBuiltinMeaning</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145324"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145323"><span class="hs-identifier hs-type">fun</span></a></span><span>
</span><span id="line-47"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.Meaning.html#BuiltinVersion"><span class="hs-identifier hs-type">BuiltinVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145323"><span class="hs-identifier hs-type">fun</span></a></span><span>
</span><span id="line-48"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Purity.html#BuiltinApp"><span class="hs-identifier hs-type">BuiltinApp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145320"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145319"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145324"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145323"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145318"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-49"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-50"></span><span id="isSaturated"><span class="annot"><span class="annottext">isSaturated :: forall tyname name (uni :: * -&gt; *) fun a.
ToBuiltinMeaning uni fun =&gt;
BuiltinVersion fun
-&gt; BuiltinApp tyname name uni fun a -&gt; Maybe Bool
</span><a href="PlutusIR.Purity.html#isSaturated"><span class="hs-identifier hs-var hs-var">isSaturated</span></a></span></span><span> </span><span id="local-6989586621681145160"><span class="annot"><span class="annottext">BuiltinVersion fun
</span><a href="#local-6989586621681145160"><span class="hs-identifier hs-var">ver</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Purity.html#BuiltinApp"><span class="hs-identifier hs-type">BuiltinApp</span></a></span><span> </span><span id="local-6989586621681145159"><span class="annot"><span class="annottext">fun
</span><a href="#local-6989586621681145159"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621681145158"><span class="annot"><span class="annottext">[Arg tyname name uni fun a]
</span><a href="#local-6989586621681145158"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-51"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall (uni :: * -&gt; *) fun val.
(ToBuiltinMeaning uni fun, HasMeaningIn uni val) =&gt;
BuiltinVersion fun
-&gt; fun -&gt; BuiltinMeaning val (CostingPart uni fun)
</span><a href="PlutusCore.Builtin.Meaning.html#toBuiltinMeaning"><span class="hs-identifier hs-var">toBuiltinMeaning</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621681145324"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621681145323"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145324"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145323"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BuiltinVersion fun
</span><a href="#local-6989586621681145160"><span class="hs-identifier hs-var">ver</span></a></span><span> </span><span class="annot"><span class="annottext">fun
</span><a href="#local-6989586621681145159"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-52"></span><span>        </span><span class="annot"><a href="PlutusCore.Builtin.Meaning.html#BuiltinMeaning"><span class="hs-identifier hs-type">BuiltinMeaning</span></a></span><span> </span><span id="local-6989586621681145155"><span class="annot"><span class="annottext">TypeScheme (Term TyName Name uni fun ()) args res
</span><a href="#local-6989586621681145155"><span class="hs-identifier hs-var">sch</span></a></span></span><span> </span><span class="annot"><span class="annottext">FoldArgs args res
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">CostingPart uni fun -&gt; BuiltinRuntime (Term TyName Name uni fun ())
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a val (args :: [*]) res.
[Arg tyname name uni fun a]
-&gt; TypeScheme val args res -&gt; Maybe Bool
</span><a href="PlutusIR.Purity.html#saturatesScheme"><span class="hs-identifier hs-var">saturatesScheme</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg tyname name uni fun a]
</span><a href="#local-6989586621681145158"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">TypeScheme (Term TyName Name uni fun ()) args res
</span><a href="#local-6989586621681145155"><span class="hs-identifier hs-var">sch</span></a></span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="hs-comment">-- | View a 'Term' as a 'BuiltinApp' if possible.</span><span>
</span><span id="line-55"></span><span id="local-6989586621681145284"><span id="local-6989586621681145285"><span id="local-6989586621681145286"><span id="local-6989586621681145287"><span id="local-6989586621681145288"><span class="annot"><a href="PlutusIR.Purity.html#asBuiltinApp"><span class="hs-identifier hs-type">asBuiltinApp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145288"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145287"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145286"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145285"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145284"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Purity.html#BuiltinApp"><span class="hs-identifier hs-type">BuiltinApp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145288"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145287"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145286"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145285"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145284"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-56"></span><span id="asBuiltinApp"><span class="annot"><span class="annottext">asBuiltinApp :: forall tyname name (uni :: * -&gt; *) fun a.
Term tyname name uni fun a
-&gt; Maybe (BuiltinApp tyname name uni fun a)
</span><a href="PlutusIR.Purity.html#asBuiltinApp"><span class="hs-identifier hs-var hs-var">asBuiltinApp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall {tyname} {name} {uni :: * -&gt; *} {fun} {a}.
[Arg tyname name uni fun a]
-&gt; Term tyname name uni fun a
-&gt; Maybe (BuiltinApp tyname name uni fun a)
</span><a href="#local-6989586621681145154"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-58"></span><span>        </span><span id="local-6989586621681145154"><span class="annot"><span class="annottext">go :: [Arg tyname name uni fun a]
-&gt; Term tyname name uni fun a
-&gt; Maybe (BuiltinApp tyname name uni fun a)
</span><a href="#local-6989586621681145154"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621681145153"><span class="annot"><span class="annottext">[Arg tyname name uni fun a]
</span><a href="#local-6989586621681145153"><span class="hs-identifier hs-var">argsSoFar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-59"></span><span>            </span><span class="annot"><a href="PlutusIR.Core.Type.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681145151"><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681145151"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621681145150"><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681145150"><span class="hs-identifier hs-var">arg</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Arg tyname name uni fun a]
-&gt; Term tyname name uni fun a
-&gt; Maybe (BuiltinApp tyname name uni fun a)
</span><a href="#local-6989586621681145154"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
Term tyname name uni fun a -&gt; Arg tyname name uni fun a
</span><a href="PlutusIR.Purity.html#TermArg"><span class="hs-identifier hs-var">TermArg</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681145150"><span class="hs-identifier hs-var">arg</span></a></span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-glyph hs-var">:</span></a></span><span class="annot"><span class="annottext">[Arg tyname name uni fun a]
</span><a href="#local-6989586621681145153"><span class="hs-identifier hs-var">argsSoFar</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681145151"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-60"></span><span>            </span><span class="annot"><a href="PlutusIR.Core.Type.html#TyInst"><span class="hs-identifier hs-type">TyInst</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681145148"><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681145148"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621681145147"><span class="annot"><span class="annottext">Type tyname uni a
</span><a href="#local-6989586621681145147"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Arg tyname name uni fun a]
-&gt; Term tyname name uni fun a
-&gt; Maybe (BuiltinApp tyname name uni fun a)
</span><a href="#local-6989586621681145154"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
Type tyname uni a -&gt; Arg tyname name uni fun a
</span><a href="PlutusIR.Purity.html#TypeArg"><span class="hs-identifier hs-var">TypeArg</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni a
</span><a href="#local-6989586621681145147"><span class="hs-identifier hs-var">arg</span></a></span><span class="annot"><span class="annottext">forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-glyph hs-var">:</span></a></span><span class="annot"><span class="annottext">[Arg tyname name uni fun a]
</span><a href="#local-6989586621681145153"><span class="hs-identifier hs-var">argsSoFar</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681145148"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-61"></span><span>            </span><span class="annot"><a href="PlutusIR.Core.Type.html#Builtin"><span class="hs-identifier hs-type">Builtin</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681145145"><span class="annot"><span class="annottext">fun
</span><a href="#local-6989586621681145145"><span class="hs-identifier hs-var">b</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
fun
-&gt; [Arg tyname name uni fun a] -&gt; BuiltinApp tyname name uni fun a
</span><a href="PlutusIR.Purity.html#BuiltinApp"><span class="hs-identifier hs-var">BuiltinApp</span></a></span><span> </span><span class="annot"><span class="annottext">fun
</span><a href="#local-6989586621681145145"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">[Arg tyname name uni fun a]
</span><a href="#local-6989586621681145153"><span class="hs-identifier hs-var">argsSoFar</span></a></span><span>
</span><span id="line-62"></span><span>            </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><span class="hs-identifier">_</span></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-comment">{- Note [Purity, strictness, and variables]
Variables in PLC won't have effects: they can have something else substituted for them,
but those will be fully evaluated already.
However, in PIR we have non-strict variable bindings.
References to non-strict variables *can* have effects - after all,
they compile into an application.

So we need to take this into account in our purity calculation.
We require the user to tell us which variables are strict, this
must be *conservative* (i.e. if you don't know, it's non-strict).
-}</span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="hs-comment">-- | Will evaluating this term have side effects (looping or error)?</span><span>
</span><span id="line-77"></span><span class="hs-comment">-- This is slightly wider than the definition of a value, as</span><span>
</span><span id="line-78"></span><span class="hs-comment">-- it includes applications that are known to be pure, as well as</span><span>
</span><span id="line-79"></span><span class="hs-comment">-- things that can't be returned from the machine (as they'd be ill-scoped).</span><span>
</span><span id="line-80"></span><span id="local-6989586621681145260"><span id="local-6989586621681145261"><span id="local-6989586621681145263"><span id="local-6989586621681145264"><span id="local-6989586621681145265"><span class="annot"><a href="PlutusIR.Purity.html#isPure"><span class="hs-identifier hs-type">isPure</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-81"></span><span>    </span><span class="annot"><a href="PlutusCore.Builtin.Meaning.html#ToBuiltinMeaning"><span class="hs-identifier hs-type">ToBuiltinMeaning</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145265"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145264"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-82"></span><span>    </span><span class="annot"><a href="PlutusCore.Builtin.Meaning.html#BuiltinVersion"><span class="hs-identifier hs-type">BuiltinVersion</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145264"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-83"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681145263"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Strictness"><span class="hs-identifier hs-type">Strictness</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-84"></span><span>    </span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145261"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145263"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145265"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145264"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145260"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-85"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Bool</span></a></span></span></span></span></span></span><span>
</span><span id="line-86"></span><span id="isPure"><span class="annot"><span class="annottext">isPure :: forall (uni :: * -&gt; *) fun name tyname a.
ToBuiltinMeaning uni fun =&gt;
BuiltinVersion fun
-&gt; (name -&gt; Strictness) -&gt; Term tyname name uni fun a -&gt; Bool
</span><a href="PlutusIR.Purity.html#isPure"><span class="hs-identifier hs-var hs-var">isPure</span></a></span></span><span> </span><span id="local-6989586621681145138"><span class="annot"><span class="annottext">BuiltinVersion fun
</span><a href="#local-6989586621681145138"><span class="hs-identifier hs-var">ver</span></a></span></span><span> </span><span id="local-6989586621681145137"><span class="annot"><span class="annottext">name -&gt; Strictness
</span><a href="#local-6989586621681145137"><span class="hs-identifier hs-var">varStrictness</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a -&gt; Bool
</span><a href="#local-6989586621681145136"><span class="hs-identifier hs-var">go</span></a></span><span>
</span><span id="line-87"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-88"></span><span>        </span><span id="local-6989586621681145136"><span class="annot"><span class="annottext">go :: Term tyname name uni fun a -&gt; Bool
</span><a href="#local-6989586621681145136"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-89"></span><span>            </span><span class="hs-comment">-- See Note [Purity, strictness, and variables]</span><span>
</span><span id="line-90"></span><span>            </span><span class="annot"><a href="PlutusIR.Core.Type.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681145134"><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681145134"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">name -&gt; Strictness
</span><a href="#local-6989586621681145137"><span class="hs-identifier hs-var">varStrictness</span></a></span><span> </span><span class="annot"><span class="annottext">name
</span><a href="#local-6989586621681145134"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-91"></span><span>                </span><span class="annot"><span class="annottext">Strictness
</span><a href="PlutusIR.Core.Type.html#Strict"><span class="hs-identifier hs-var">Strict</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-92"></span><span>                </span><span class="annot"><span class="annottext">Strictness
</span><a href="PlutusIR.Core.Type.html#NonStrict"><span class="hs-identifier hs-var">NonStrict</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-93"></span><span>            </span><span class="hs-comment">-- These are syntactically values that won't reduce further</span><span>
</span><span id="line-94"></span><span>            </span><span class="annot"><a href="PlutusIR.Core.Type.html#LamAbs"><span class="hs-identifier hs-type">LamAbs</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-95"></span><span>            </span><span class="annot"><a href="PlutusIR.Core.Type.html#TyAbs"><span class="hs-identifier hs-type">TyAbs</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-96"></span><span>            </span><span class="annot"><a href="PlutusIR.Core.Type.html#Constant"><span class="hs-identifier hs-type">Constant</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-97"></span><span>            </span><span class="annot"><a href="PlutusIR.Core.Type.html#IWrap"><span class="hs-identifier hs-type">IWrap</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type tyname uni a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type tyname uni a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681145127"><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681145127"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a -&gt; Bool
</span><a href="#local-6989586621681145136"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681145127"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-98"></span><span>            </span><span class="hs-comment">-- A non-recursive `Let` is pure if all bindings are pure and the body is pure.</span><span>
</span><span id="line-99"></span><span>            </span><span class="hs-comment">-- A recursive `Let` may loop, so we consider it non-pure.</span><span>
</span><span id="line-100"></span><span>            </span><span class="annot"><a href="PlutusIR.Core.Type.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Recursivity
</span><a href="PlutusIR.Core.Type.html#NonRec"><span class="hs-identifier hs-var">NonRec</span></a></span><span> </span><span id="local-6989586621681145124"><span class="annot"><span class="annottext">NonEmpty (Binding tyname name uni fun a)
</span><a href="#local-6989586621681145124"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span id="local-6989586621681145123"><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681145123"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="annot"><span class="annottext">Binding tyname name uni fun a -&gt; Bool
</span><a href="#local-6989586621681145121"><span class="hs-identifier hs-var">isPureBinding</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Binding tyname name uni fun a)
</span><a href="#local-6989586621681145124"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a -&gt; Bool
</span><a href="#local-6989586621681145136"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681145123"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span>            </span><span id="local-6989586621681145119"><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681145119"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681145118"><span class="annot"><span class="annottext">bapp :: BuiltinApp tyname name uni fun a
</span><a href="#local-6989586621681145118"><span class="hs-identifier hs-var">bapp</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Purity.html#BuiltinApp"><span class="hs-identifier hs-type">BuiltinApp</span></a></span><span> </span><span class="annot"><span class="annottext">fun
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681145117"><span class="annot"><span class="annottext">[Arg tyname name uni fun a]
</span><a href="#local-6989586621681145117"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
Term tyname name uni fun a
-&gt; Maybe (BuiltinApp tyname name uni fun a)
</span><a href="PlutusIR.Purity.html#asBuiltinApp"><span class="hs-identifier hs-var">asBuiltinApp</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681145119"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-103"></span><span>                </span><span class="hs-comment">-- Pure only if we can tell that the builtin application is not saturated</span><span>
</span><span id="line-104"></span><span>                </span><span class="annot"><span class="annottext">forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
ToBuiltinMeaning uni fun =&gt;
BuiltinVersion fun
-&gt; BuiltinApp tyname name uni fun a -&gt; Maybe Bool
</span><a href="PlutusIR.Purity.html#isSaturated"><span class="hs-identifier hs-var">isSaturated</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinVersion fun
</span><a href="#local-6989586621681145138"><span class="hs-identifier hs-var">ver</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinApp tyname name uni fun a
</span><a href="#local-6989586621681145118"><span class="hs-identifier hs-var">bapp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>                </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span>
</span><span id="line-106"></span><span>                </span><span class="hs-comment">-- But all the arguments need to also be effect-free, since they will be evaluated</span><span>
</span><span id="line-107"></span><span>                </span><span class="hs-comment">-- when we evaluate the application.</span><span>
</span><span id="line-108"></span><span>                </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="PlutusIR.Purity.html#TermArg"><span class="hs-identifier hs-type">TermArg</span></a></span><span> </span><span id="local-6989586621681145114"><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681145114"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a -&gt; Bool
</span><a href="#local-6989586621681145136"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681145114"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><a href="PlutusIR.Purity.html#TypeArg"><span class="hs-identifier hs-type">TypeArg</span></a></span><span> </span><span class="annot"><span class="annottext">Type tyname uni a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Arg tyname name uni fun a]
</span><a href="#local-6989586621681145117"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span>            </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span>        </span><span id="local-6989586621681145121"><span class="annot"><span class="annottext">isPureBinding :: Binding tyname name uni fun a -&gt; Bool
</span><a href="#local-6989586621681145121"><span class="hs-identifier hs-var hs-var">isPureBinding</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-113"></span><span>            </span><span class="annot"><a href="PlutusIR.Core.Type.html#TermBind"><span class="hs-identifier hs-type">TermBind</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Strictness
</span><a href="PlutusIR.Core.Type.html#Strict"><span class="hs-identifier hs-var">Strict</span></a></span><span> </span><span class="annot"><span class="annottext">VarDecl tyname name uni a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681145112"><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681145112"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a -&gt; Bool
</span><a href="#local-6989586621681145136"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681145112"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-114"></span><span>            </span><span class="annot"><span class="annottext">Binding tyname name uni fun a
</span><span class="hs-identifier">_</span></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span class="hs-comment">{- |
Try to identify the first sub term which will be evaluated in the given term and
which could have an effect. 'Nothing' indicates that we don't know, this function
is conservative.
-}</span><span>
</span><span id="line-121"></span><span id="local-6989586621681145243"><span id="local-6989586621681145244"><span id="local-6989586621681145245"><span id="local-6989586621681145246"><span id="local-6989586621681145247"><span class="annot"><a href="PlutusIR.Purity.html#firstEffectfulTerm"><span class="hs-identifier hs-type">firstEffectfulTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145247"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145246"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145245"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145244"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145243"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145247"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145246"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145245"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145244"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145243"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-122"></span><span id="firstEffectfulTerm"><span class="annot"><span class="annottext">firstEffectfulTerm :: forall tyname name (uni :: * -&gt; *) fun a.
Term tyname name uni fun a -&gt; Maybe (Term tyname name uni fun a)
</span><a href="PlutusIR.Purity.html#firstEffectfulTerm"><span class="hs-identifier hs-var hs-var">firstEffectfulTerm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
Term tyname name uni fun a -&gt; Maybe (Term tyname name uni fun a)
</span><a href="#local-6989586621681145111"><span class="hs-identifier hs-var">goTerm</span></a></span><span>
</span><span id="line-123"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-124"></span><span>      </span><span id="local-6989586621681145111"><span class="annot"><span class="annottext">goTerm :: Term tyname name uni fun a -&gt; Maybe (Term tyname name uni fun a)
</span><a href="#local-6989586621681145111"><span class="hs-identifier hs-var hs-var">goTerm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-125"></span><span>        </span><span class="annot"><a href="PlutusIR.Core.Type.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Recursivity
</span><a href="PlutusIR.Core.Type.html#NonRec"><span class="hs-identifier hs-var">NonRec</span></a></span><span> </span><span id="local-6989586621681145110"><span class="annot"><span class="annottext">NonEmpty (Binding tyname name uni fun a)
</span><a href="#local-6989586621681145110"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span id="local-6989586621681145109"><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681145109"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
[Binding tyname name uni fun a]
-&gt; Maybe (Term tyname name uni fun a)
</span><a href="#local-6989586621681145108"><span class="hs-identifier hs-var">goBindings</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. NonEmpty a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">NE.toList</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Binding tyname name uni fun a)
</span><a href="#local-6989586621681145110"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-126"></span><span>            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681145106"><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681145106"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681145106"><span class="hs-identifier hs-var">t'</span></a></span><span>
</span><span id="line-127"></span><span>            </span><span class="annot"><span class="annottext">Maybe (Term tyname name uni fun a)
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a -&gt; Maybe (Term tyname name uni fun a)
</span><a href="#local-6989586621681145111"><span class="hs-identifier hs-var">goTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681145109"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span>        </span><span class="annot"><a href="PlutusIR.Core.Type.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681145105"><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681145105"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a -&gt; Maybe (Term tyname name uni fun a)
</span><a href="#local-6989586621681145111"><span class="hs-identifier hs-var">goTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681145105"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-130"></span><span>        </span><span class="annot"><a href="PlutusIR.Core.Type.html#TyInst"><span class="hs-identifier hs-type">TyInst</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681145104"><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681145104"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type tyname uni a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a -&gt; Maybe (Term tyname name uni fun a)
</span><a href="#local-6989586621681145111"><span class="hs-identifier hs-var">goTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681145104"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-131"></span><span>        </span><span class="annot"><a href="PlutusIR.Core.Type.html#IWrap"><span class="hs-identifier hs-type">IWrap</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type tyname uni a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type tyname uni a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681145103"><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681145103"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a -&gt; Maybe (Term tyname name uni fun a)
</span><a href="#local-6989586621681145111"><span class="hs-identifier hs-var">goTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681145103"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-132"></span><span>        </span><span class="annot"><a href="PlutusIR.Core.Type.html#Unwrap"><span class="hs-identifier hs-type">Unwrap</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681145101"><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681145101"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a -&gt; Maybe (Term tyname name uni fun a)
</span><a href="#local-6989586621681145111"><span class="hs-identifier hs-var">goTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681145101"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span>        </span><span id="local-6989586621681145100"><span class="annot"><span class="annottext">t :: Term tyname name uni fun a
</span><a href="#local-6989586621681145100"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="PlutusIR.Core.Type.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681145100"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-135"></span><span>        </span><span id="local-6989586621681145099"><span class="annot"><span class="annottext">t :: Term tyname name uni fun a
</span><a href="#local-6989586621681145099"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="PlutusIR.Core.Type.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681145099"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-136"></span><span>        </span><span id="local-6989586621681145097"><span class="annot"><span class="annottext">t :: Term tyname name uni fun a
</span><a href="#local-6989586621681145097"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="PlutusIR.Core.Type.html#Builtin"><span class="hs-identifier hs-type">Builtin</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681145097"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span>        </span><span class="hs-comment">-- Hard to know what gets evaluated first in a recursive let-binding,</span><span>
</span><span id="line-139"></span><span>        </span><span class="hs-comment">-- just give up and say nothing</span><span>
</span><span id="line-140"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Recursivity
</span><a href="PlutusIR.Core.Type.html#Rec"><span class="hs-identifier hs-var">Rec</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Binding tyname name uni fun a)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-141"></span><span>        </span><span class="annot"><a href="PlutusIR.Core.Type.html#TyAbs"><span class="hs-identifier hs-type">TyAbs</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-142"></span><span>        </span><span class="annot"><a href="PlutusIR.Core.Type.html#LamAbs"><span class="hs-identifier hs-type">LamAbs</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-143"></span><span>        </span><span class="annot"><a href="PlutusIR.Core.Type.html#Constant"><span class="hs-identifier hs-type">Constant</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span>      </span><span id="local-6989586621681145233"><span id="local-6989586621681145234"><span id="local-6989586621681145235"><span id="local-6989586621681145236"><span id="local-6989586621681145237"><span class="annot"><a href="#local-6989586621681145108"><span class="hs-identifier hs-type">goBindings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145237"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145236"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145235"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145234"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145233"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145237"><span class="hs-identifier hs-type">tyname</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145236"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145235"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145234"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681145233"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-146"></span><span>      </span><span id="local-6989586621681145108"><span class="annot"><span class="annottext">goBindings :: forall tyname name (uni :: * -&gt; *) fun a.
[Binding tyname name uni fun a]
-&gt; Maybe (Term tyname name uni fun a)
</span><a href="#local-6989586621681145108"><span class="hs-identifier hs-var hs-var">goBindings</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-147"></span><span>      </span><span class="annot"><a href="#local-6989586621681145108"><span class="hs-identifier hs-var">goBindings</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681145095"><span class="annot"><span class="annottext">Binding tyname name uni fun a
</span><a href="#local-6989586621681145095"><span class="hs-identifier hs-var">b</span></a></span></span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.8.0/src"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621681145094"><span class="annot"><span class="annottext">[Binding tyname name uni fun a]
</span><a href="#local-6989586621681145094"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Binding tyname name uni fun a
</span><a href="#local-6989586621681145095"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-148"></span><span>        </span><span class="hs-comment">-- Only strict term bindings can cause effects</span><span>
</span><span id="line-149"></span><span>        </span><span class="annot"><a href="PlutusIR.Core.Type.html#TermBind"><span class="hs-identifier hs-type">TermBind</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Strictness
</span><a href="PlutusIR.Core.Type.html#Strict"><span class="hs-identifier hs-var">Strict</span></a></span><span> </span><span class="annot"><span class="annottext">VarDecl tyname name uni a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681145093"><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681145093"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
Term tyname name uni fun a -&gt; Maybe (Term tyname name uni fun a)
</span><a href="#local-6989586621681145111"><span class="hs-identifier hs-var">goTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Term tyname name uni fun a
</span><a href="#local-6989586621681145093"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-150"></span><span>        </span><span class="annot"><span class="annottext">Binding tyname name uni fun a
</span><span class="hs-identifier">_</span></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall tyname name (uni :: * -&gt; *) fun a.
[Binding tyname name uni fun a]
-&gt; Maybe (Term tyname name uni fun a)
</span><a href="#local-6989586621681145108"><span class="hs-identifier hs-var">goBindings</span></a></span><span> </span><span class="annot"><span class="annottext">[Binding tyname name uni fun a]
</span><a href="#local-6989586621681145094"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-151"></span></pre></body></html>